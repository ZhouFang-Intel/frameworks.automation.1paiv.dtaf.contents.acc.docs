<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <!-- Generated with Sphinx 7.1.2 and Furo 2023.09.10 -->
        <title>lib.accelerator - ACC-DTAF-APIs documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=362ab14a" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">ACC-DTAF-APIs  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">ACC-DTAF-APIs  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../lib.html">lib package</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of lib package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../modules.html">lib</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of lib</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../lib.html">lib package</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of lib package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for lib.accelerator</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="c1">#from exsi import *</span>
<span class="kn">from</span> <span class="nn">dtaf_core.lib.tklib.basic.log</span> <span class="kn">import</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">dtaf_core.lib.tklib.basic.testcase</span> <span class="kn">import</span> <span class="n">Case</span>
<span class="kn">from</span> <span class="nn">dtaf_core.lib.tklib.basic.const</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">dtaf_core.lib.tklib.steps_lib.os_scene</span> <span class="kn">import</span> <span class="n">OperationSystem</span>
<span class="kn">from</span> <span class="nn">dtaf_core.lib.tklib.basic.config</span> <span class="kn">import</span> <span class="n">LOG_PATH</span>
<span class="kn">from</span> <span class="nn">src.virtualization.lib.rich_virtual</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1"># from tkconfig import sut_tool</span>
<span class="kn">from</span> <span class="nn">dtaf_core.lib.tklib.auto_api</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">QATZIP_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;QATZIP_H&#39;</span><span class="p">)</span>
<span class="n">QATZIP_SCRIPT_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;QATZIP_SCRIPT_H&#39;</span><span class="p">)</span>
<span class="n">OPENSSL_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;OPENSSL_H&#39;</span><span class="p">)</span>
<span class="n">QAT_ENGINE_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;QAT_ENGINE_H&#39;</span><span class="p">)</span>
<span class="n">LINPACK_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;LINPACK_H&#39;</span><span class="p">)</span>
<span class="n">QAT_DRIVER_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;QAT_DRIVER_H&#39;</span><span class="p">)</span>
<span class="n">DLB_DRIVER_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;DLB_DRIVER_H&#39;</span><span class="p">)</span>
<span class="n">DPDK_DRIVER_H</span> <span class="o">=</span><span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;DPDK_DRIVER_H&#39;</span><span class="p">)</span>
<span class="n">DSA_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;DSA_H&#39;</span><span class="p">)</span>
<span class="n">STRESSAPPTEST_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;STRESSAPPTEST_H&#39;</span><span class="p">)</span>
<span class="n">QAT_ASYM_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;QAT_ASYM_H&#39;</span><span class="p">)</span>
<span class="n">QAT_SYM_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;QAT_SYM_H&#39;</span><span class="p">)</span>
<span class="n">QAT_TEST_SCRIPT_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;QAT_TEST_SCRIPT_H&#39;</span><span class="p">)</span>
<span class="n">PTU_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;PTU_H&#39;</span><span class="p">)</span>
<span class="n">MLC_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;MLC_H&#39;</span><span class="p">)</span>
<span class="n">SAMPLE_CODE_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;SAMPLE_CODE_H&#39;</span><span class="p">)</span>
<span class="n">MEGA_CONF_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;MEGA_CONF_H&#39;</span><span class="p">)</span>
<span class="n">MEGA_SCRIPT_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;MEGA_SCRIPT_H&#39;</span><span class="p">)</span>
<span class="n">KERNEL_HEADER_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;KERNEL_HEADER_H&#39;</span><span class="p">)</span>
<span class="n">KERNEL_DEVEL_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;KERNEL_DEVEL_H&#39;</span><span class="p">)</span>
<span class="n">KERNEL_INTERNAL_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;KERNEL_INTERNAL_H&#39;</span><span class="p">)</span>
<span class="n">PPEXPECT_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;PPEXPECT_H&#39;</span><span class="p">)</span>
<span class="n">OVMF_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;OVMF_H&#39;</span><span class="p">)</span>
<span class="n">PRIME95_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;PRIME95_H&#39;</span><span class="p">)</span>
<span class="n">PRIME95_SCRIPT_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;PRIME95_SCRIPT_H&#39;</span><span class="p">)</span>
<span class="n">TDX_SEAM_LOADER_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;TDX_SEAM_LOADER_H&#39;</span><span class="p">)</span>
<span class="n">TDX_SEAM_MODULE_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;TDX_SEAM_MODULE_H&#39;</span><span class="p">)</span>
<span class="n">SGX_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;SGX_H&#39;</span><span class="p">)</span>
<span class="n">SGXHYDRA_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;SGXHYDRA_H&#39;</span><span class="p">)</span>
<span class="n">SGXSDK_SCRIPT_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;SGXSDK_SCRIPT_H&#39;</span><span class="p">)</span>
<span class="n">SRC_SCRIPT_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;SRC_SCRIPT_H&#39;</span><span class="p">)</span>
<span class="n">IDXD_KTEST_MASTER_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;IDXD_KTEST_MASTER_H&#39;</span><span class="p">)</span>
<span class="n">SPR_ACCE_RANDOM_CONFIG_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;SPR_ACCE_RANDOM_CONFIG_H&#39;</span><span class="p">)</span>
<span class="n">SOCWATCH_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;SOCWATCH_H&#39;</span><span class="p">)</span>
<span class="n">CPUID_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;CPUID_H&#39;</span><span class="p">)</span>
<span class="n">SOCWATCH_SCRIPT_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;SOCWATCH_SCRIPT_H&#39;</span><span class="p">)</span>
<span class="n">BASHRC_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;BASHRC_H&#39;</span><span class="p">)</span>
<span class="n">MSR_tool_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;MSR_tool_H&#39;</span><span class="p">)</span>
<span class="n">QAT_DRIVER_V_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;QAT_DRIVER_V_H&#39;</span><span class="p">)</span>
<span class="n">DLB_DRIVER_V_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;DLB_DRIVER_V_H&#39;</span><span class="p">)</span>
<span class="n">DSA_DRIVER_V_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;DSA_DRIVER_V_H&#39;</span><span class="p">)</span>
<span class="n">IAX_WB_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;IAX_WB_H&#39;</span><span class="p">)</span>
<span class="n">XMLCLI_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;XMLCLI_H&#39;</span><span class="p">)</span>
<span class="n">EFIXMLCLI_H</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;EFIXMLCLI_H&#39;</span><span class="p">)</span>


<span class="n">QAT_DRIVER_NAME</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;QAT_DRIVER_NAME&#39;</span><span class="p">)</span>
<span class="n">DLB_DRIVER_NAME</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;DLB_DRIVER_NAME&#39;</span><span class="p">)</span>
<span class="n">KERNEL_HEADER_NAME</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;KERNEL_HEADER_NAME&#39;</span><span class="p">)</span>
<span class="n">KERNEL_DEVEL_NAME</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;KERNEL_DEVEL_NAME&#39;</span><span class="p">)</span>
<span class="n">KERNEL_INTERNAL_NAME</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;KERNEL_INTERNAL_NAME&#39;</span><span class="p">)</span>
<span class="n">DPDK_DRIVER_NAME</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;DPDK_DRIVER_NAME&#39;</span><span class="p">)</span>
<span class="n">DSA_ACCEL_CONFIG_NAME</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;DSA_ACCEL_CONFIG_NAME&#39;</span><span class="p">)</span>
<span class="n">IDXD_KTEST_MASTER_NAME</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;IDXD_KTEST_MASTER_NAME&#39;</span><span class="p">)</span>
<span class="n">SPR_ACCE_RANDOM_CONFIG_NAME</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;SPR_ACCE_RANDOM_CONFIG_NAME&#39;</span><span class="p">)</span>
<span class="n">IMAGE_NAME</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;IMAGE_NAME&#39;</span><span class="p">)</span>
<span class="n">CLEAN_IMAGE_NAME</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;CLEAN_IMAGE_NAME&#39;</span><span class="p">)</span>
<span class="n">IMAGE_NAME_DLB</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;IMAGE_NAME_DLB&#39;</span><span class="p">)</span>
<span class="n">IMAGE_BASE_NAME</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;IMAGE_BASE_NAME&#39;</span><span class="p">)</span>
<span class="n">SAMPLE_CODE_NAME</span>  <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;SAMPLE_CODE_NAME&#39;</span><span class="p">)</span>
<span class="n">MEGA_SCRIPT_NAME</span>  <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;MEGA_SCRIPT_NAME&#39;</span><span class="p">)</span>
<span class="n">PPEXPECT_NAME</span>  <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;PPEXPECT_NAME&#39;</span><span class="p">)</span>
<span class="n">TDX_SEAM_RPMS_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;TDX_SEAM_RPMS_PATH_L&#39;</span><span class="p">)</span>
<span class="n">QATZIP_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;QATZIP_PATH_L&#39;</span><span class="p">)</span>
<span class="n">QATZIP_SCRIPT_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;QATZIP_SCRIPT_PATH_L&#39;</span><span class="p">)</span>
<span class="n">OPENSSL_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;OPENSSL_PATH_L&#39;</span><span class="p">)</span>
<span class="n">QAT_ENGINE_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;QAT_ENGINE_PATH_L&#39;</span><span class="p">)</span>
<span class="n">LINPACK_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;LINPACK_PATH_L&#39;</span><span class="p">)</span>
<span class="n">QAT_DRIVER_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;QAT_DRIVER_PATH_L&#39;</span><span class="p">)</span>
<span class="n">DLB_DRIVER_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;DLB_DRIVER_PATH_L&#39;</span><span class="p">)</span>
<span class="n">DPDK_DRIVER_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;DPDK_DRIVER_PATH_L&#39;</span><span class="p">)</span>
<span class="n">DSA_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;DSA_PATH_L&#39;</span><span class="p">)</span>
<span class="n">STRESSAPPTEST_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;STRESSAPPTEST_PATH_L&#39;</span><span class="p">)</span>
<span class="n">QAT_ASYM_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;QAT_ASYM_PATH_L&#39;</span><span class="p">)</span>
<span class="n">QAT_SYM_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;QAT_SYM_PATH_L&#39;</span><span class="p">)</span>
<span class="n">QAT_TEST_SCRIPT_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;QAT_TEST_SCRIPT_PATH_L&#39;</span><span class="p">)</span>
<span class="n">PTU_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;PTU_PATH_L&#39;</span><span class="p">)</span>
<span class="n">MLC_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;MLC_PATH_L&#39;</span><span class="p">)</span>
<span class="n">SAMPLE_CODE_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;SAMPLE_CODE_PATH_L&#39;</span><span class="p">)</span>
<span class="n">MEGA_CONF_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;MEGA_CONF_PATH_L&#39;</span><span class="p">)</span>
<span class="n">MEGA_SCRIPT_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;MEGA_SCRIPT_PATH_L&#39;</span><span class="p">)</span>
<span class="n">KERNEL_HEADER_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;KERNEL_HEADER_PATH_L&#39;</span><span class="p">)</span>
<span class="n">KERNEL_DEVEL_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;KERNEL_DEVEL_PATH_L&#39;</span><span class="p">)</span>
<span class="n">KERNEL_INTERNAL_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;KERNEL_INTERNAL_PATH_L&#39;</span><span class="p">)</span>
<span class="n">PPEXPECT_MEGA_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;PPEXPECT_MEGA_PATH_L&#39;</span><span class="p">)</span>
<span class="n">PPEXPECT_prime95_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;PPEXPECT_prime95_PATH_L&#39;</span><span class="p">)</span>
<span class="n">PPEXPECT_SOCWATCH_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;PPEXPECT_SOCWATCH_PATH_L&#39;</span><span class="p">)</span>
<span class="n">VM_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;VM_PATH_L&#39;</span><span class="p">)</span>
<span class="n">ISO_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;ISO_PATH_L&#39;</span><span class="p">)</span>
<span class="n">OVMF_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;OVMF_PATH_L&#39;</span><span class="p">)</span>
<span class="n">PRIME95_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;PRIME95_PATH_L&#39;</span><span class="p">)</span>
<span class="n">PRIME95_SCRIPT_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;PRIME95_SCRIPT_PATH_L&#39;</span><span class="p">)</span>
<span class="n">TDX_SEAM_LOADER_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;TDX_SEAM_LOADER_PATH_L&#39;</span><span class="p">)</span>
<span class="n">TDX_SEAM_MODULE_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;TDX_SEAM_MODULE_PATH_L&#39;</span><span class="p">)</span>
<span class="n">PPEXPECT_SGXSDK_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;PPEXPECT_SGXSDK_PATH_L&#39;</span><span class="p">)</span>
<span class="n">SGX_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;SGX_PATH_L&#39;</span><span class="p">)</span>
<span class="n">SGXHYDRA_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;SGXHYDRA_PATH_L&#39;</span><span class="p">)</span>
<span class="n">SGXSDK_SCRIPT_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;SGXSDK_SCRIPT_PATH_L&#39;</span><span class="p">)</span>
<span class="n">SRC_SCRIPT_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;SRC_SCRIPT_PATH_L&#39;</span><span class="p">)</span>
<span class="n">IDXD_KTEST_MASTER_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;IDXD_KTEST_MASTER_PATH_L&#39;</span><span class="p">)</span>
<span class="n">SPR_ACCE_RANDOM_CONFIG_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;SPR_ACCE_RANDOM_CONFIG_PATH_L&#39;</span><span class="p">)</span>
<span class="n">IMAGE_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;IMAGE_PATH_L&#39;</span><span class="p">)</span>
<span class="n">TDX_SEAM_MODULE_RPM_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;TDX_SEAM_MODULE_RPM_PATH_L&#39;</span><span class="p">)</span>
<span class="n">TDX_SEAM_MODULE_COMMON_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;TDX_SEAM_MODULE_COMMON_PATH_L&#39;</span><span class="p">)</span>
<span class="n">TDX_SEAM_MODULE_NON_PRODUCTION_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;TDX_SEAM_MODULE_NON_PRODUCTION_PATH_L&#39;</span><span class="p">)</span>
<span class="n">PPEXPECT_TDX_LOADER_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;PPEXPECT_TDX_LOADER_PATH_L&#39;</span><span class="p">)</span>
<span class="n">SOCWATCH_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;SOCWATCH_PATH_L&#39;</span><span class="p">)</span>
<span class="n">CPUID_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;CPUID_PATH_L&#39;</span><span class="p">)</span>
<span class="n">SOCWATCH_SCRIPT_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;SOCWATCH_SCRIPT_PATH_L&#39;</span><span class="p">)</span>
<span class="n">BASHRC_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;BASHRC_PATH_L&#39;</span><span class="p">)</span>
<span class="n">MSR_TOOL_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;MSR_TOOL_PATH_L&#39;</span><span class="p">)</span>
<span class="n">PPEXPECT_IAX_WB_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;PPEXPECT_IAX_WB_PATH_L&#39;</span><span class="p">)</span>
<span class="n">IAX_WB_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;IAX_WB_PATH_L&#39;</span><span class="p">)</span>
<span class="n">XMLCLI_TOOL_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;XMLCLI_TOOL_PATH_L&#39;</span><span class="p">)</span>
<span class="n">EFIXMLCLI_TOOL_PATH_L</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;EFIXMLCLI_TOOL_PATH_L&#39;</span><span class="p">)</span>
<span class="n">QAT_DRIVER_PATH_V</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;QAT_DRIVER_PATH_V&#39;</span><span class="p">)</span>
<span class="n">DLB_DRIVER_PATH_V</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;DLB_DRIVER_PATH_V&#39;</span><span class="p">)</span>
<span class="n">DSA_DRIVER_PATH_V</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;DSA_DRIVER_PATH_V&#39;</span><span class="p">)</span>
<span class="n">ESXI_VM_TOOL_PATH_V</span> <span class="o">=</span> <span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;ESXI_VM_TOOL_PATH_V&#39;</span><span class="p">)</span>



<div class="viewcode-block" id="Accelerator"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator">[docs]</a><span class="k">class</span> <span class="nc">Accelerator</span><span class="p">:</span>
    <span class="n">BKC_FILES_DIRECTORY</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Users\Administrator\Desktop\Accelerator\BKC_files</span><span class="se">\\</span><span class="s1">&#39;</span>
    <span class="n">CENTOS_INTEL_NEXT_KERNEL</span> <span class="o">=</span> <span class="s1">&#39;5.12.0&#39;</span>
    <span class="n">CENTOS_STREAM_KERNEL</span> <span class="o">=</span> <span class="s1">&#39;5.15.0&#39;</span>
    <span class="n">IFWI_VERSION</span> <span class="o">=</span> <span class="s1">&#39;0076.D27&#39;</span>
    <span class="n">DEVICE_ID</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;SPR&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;QAT_DEVICE_ID&#39;</span><span class="p">:</span> <span class="s1">&#39;4940&#39;</span><span class="p">,</span>
            <span class="s1">&#39;DLB_DEVICE_ID&#39;</span><span class="p">:</span> <span class="s1">&#39;2710&#39;</span><span class="p">,</span>
            <span class="s1">&#39;DSA_DEVICE_ID&#39;</span><span class="p">:</span> <span class="s1">&#39;0b25&#39;</span><span class="p">,</span>
            <span class="s1">&#39;IAX_DEVICE_ID&#39;</span><span class="p">:</span> <span class="s1">&#39;0cfe&#39;</span><span class="p">,</span>
            <span class="s1">&#39;QAT_VF_DEVICE_ID&#39;</span><span class="p">:</span> <span class="s1">&#39;4941&#39;</span><span class="p">,</span>
            <span class="s1">&#39;DLB_VF_DEVICE_ID&#39;</span><span class="p">:</span> <span class="s1">&#39;2711&#39;</span><span class="p">,</span>
            <span class="s1">&#39;DSA_MDEV_DEVICE_ID&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;IAX_MDEV_DEVICE_ID&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;QAT_MDEV_DEVICE_ID&#39;</span><span class="p">:</span> <span class="s1">&#39;0da5&#39;</span><span class="p">,</span>
            <span class="s1">&#39;DLB_MDEV_DEVICE_ID&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;GNR&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;QAT_DEVICE_ID&#39;</span><span class="p">:</span> <span class="s1">&#39;4944&#39;</span><span class="p">,</span>
            <span class="s1">&#39;DLB_DEVICE_ID&#39;</span><span class="p">:</span> <span class="s1">&#39;2714&#39;</span><span class="p">,</span>
            <span class="s1">&#39;DSA_DEVICE_ID&#39;</span><span class="p">:</span> <span class="s1">&#39;0b25&#39;</span><span class="p">,</span>
            <span class="s1">&#39;IAX_DEVICE_ID&#39;</span><span class="p">:</span> <span class="s1">&#39;0cfe&#39;</span><span class="p">,</span>
            <span class="s1">&#39;QAT_VF_DEVICE_ID&#39;</span><span class="p">:</span> <span class="s1">&#39;4945&#39;</span><span class="p">,</span>
            <span class="s1">&#39;DLB_VF_DEVICE_ID&#39;</span><span class="p">:</span> <span class="s1">&#39;2715&#39;</span><span class="p">,</span>
            <span class="s1">&#39;DSA_MDEV_DEVICE_ID&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;IAX_MDEV_DEVICE_ID&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;QAT_MDEV_DEVICE_ID&#39;</span><span class="p">:</span> <span class="s1">&#39;0da5&#39;</span><span class="p">,</span>
            <span class="s1">&#39;DLB_MDEV_DEVICE_ID&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sut</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span> <span class="o">=</span> <span class="n">sut</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Case</span> <span class="o">=</span> <span class="n">Case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">my_os</span> <span class="o">=</span> <span class="n">OperationSystem</span><span class="p">[</span><span class="n">OS</span><span class="o">.</span><span class="n">get_os_family</span><span class="p">(</span><span class="n">sut</span><span class="o">.</span><span class="n">default_os</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">socket_name</span>
        <span class="c1"># self.platform = str(sut.cfg[&#39;defaults&#39;].get(&#39;platform&#39;)).lower()</span>
        <span class="c1"># self.platform = sut.cfg[&quot;defaults&quot;][&quot;platform&quot;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qat_id</span> <span class="o">=</span> <span class="n">Accelerator</span><span class="o">.</span><span class="n">DEVICE_ID</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QAT_DEVICE_ID&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlb_id</span> <span class="o">=</span> <span class="n">Accelerator</span><span class="o">.</span><span class="n">DEVICE_ID</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DLB_DEVICE_ID&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dsa_id</span> <span class="o">=</span> <span class="n">Accelerator</span><span class="o">.</span><span class="n">DEVICE_ID</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DSA_DEVICE_ID&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iax_id</span> <span class="o">=</span> <span class="n">Accelerator</span><span class="o">.</span><span class="n">DEVICE_ID</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;IAX_DEVICE_ID&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qat_vf_id</span> <span class="o">=</span> <span class="n">Accelerator</span><span class="o">.</span><span class="n">DEVICE_ID</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QAT_VF_DEVICE_ID&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlb_vf_id</span> <span class="o">=</span> <span class="n">Accelerator</span><span class="o">.</span><span class="n">DEVICE_ID</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DLB_VF_DEVICE_ID&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qat_mdev_id</span> <span class="o">=</span> <span class="n">Accelerator</span><span class="o">.</span><span class="n">DEVICE_ID</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QAT_MDEV_DEVICE_ID&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlb_mdev_id</span> <span class="o">=</span> <span class="n">Accelerator</span><span class="o">.</span><span class="n">DEVICE_ID</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DLB_MDEV_DEVICE_ID&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dsa_mdev_id</span> <span class="o">=</span> <span class="n">Accelerator</span><span class="o">.</span><span class="n">DEVICE_ID</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DSA_MDEV_DEVICE_ID&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iax_mdev_id</span> <span class="o">=</span> <span class="n">Accelerator</span><span class="o">.</span><span class="n">DEVICE_ID</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;IAX_MDEV_DEVICE_ID&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">QAT_DEVICE_NUM</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sut</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;accelerator&#39;</span><span class="p">][</span><span class="s1">&#39;qat_device_num&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DLB_DEVICE_NUM</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sut</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;accelerator&#39;</span><span class="p">][</span><span class="s1">&#39;dlb_device_num&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DSA_DEVICE_NUM</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sut</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;accelerator&#39;</span><span class="p">][</span><span class="s1">&#39;dsa_device_num&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IAX_DEVICE_NUM</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sut</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;accelerator&#39;</span><span class="p">][</span><span class="s1">&#39;iax_device_num&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qat_device_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sut</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;accelerator&#39;</span><span class="p">][</span><span class="s1">&#39;qat_device_num&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlb_device_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sut</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;accelerator&#39;</span><span class="p">][</span><span class="s1">&#39;dlb_device_num&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dsa_device_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sut</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;accelerator&#39;</span><span class="p">][</span><span class="s1">&#39;dsa_device_num&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iax_device_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sut</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;accelerator&#39;</span><span class="p">][</span><span class="s1">&#39;iax_device_num&#39;</span><span class="p">])</span>

    <span class="c1"># CentOS-APIs</span>
<span class="c1">###########################################################################################################</span>

<div class="viewcode-block" id="Accelerator.dsa_modify"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.dsa_modify">[docs]</a>    <span class="k">def</span> <span class="nf">dsa_modify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># 1. current file abs path</span>
        <span class="n">cur_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
        <span class="c1"># 2. get configureation path</span>
        <span class="n">src_path</span> <span class="o">=</span> <span class="n">cur_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;src&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">conf_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">src_path</span><span class="p">,</span> <span class="s2">&quot;src&quot;</span><span class="p">,</span> <span class="s2">&quot;configuration&quot;</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;platform&quot;</span><span class="p">])</span>
        <span class="c1"># 3. sut_tools.py path</span>
        <span class="c1"># 4. open sut_tools.py</span>
        <span class="c1"># 5. search DSA_H line</span>
        <span class="c1"># 6. replace with new line</span>
        <span class="c1"># 7. close file</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Accelerator.accel_config_check"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.accel_config_check">[docs]</a>    <span class="k">def</span> <span class="nf">accel_config_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_num</span><span class="p">,</span> <span class="n">acce_ip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">             Purpose: Check accel-config list result</span>
<span class="sd">             Args:</span>
<span class="sd">                 device_num: The number of enabled device in work-queues</span>
<span class="sd">                 acce_ip: Which device need to check the device status, such as: &#39;DSA&#39; or &#39;IAX&#39;</span>
<span class="sd">             Returns:</span>
<span class="sd">                 No</span>
<span class="sd">             Raises:</span>
<span class="sd">                 RuntimeError: If any errors</span>
<span class="sd">             Example:</span>
<span class="sd">                 Simplest usage: Check accel-config list result</span>
<span class="sd">                     accel_config_check(device_num, &#39;IAX&#39;)</span>
<span class="sd">       &quot;&quot;&quot;</span>
        <span class="n">cpu_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_num</span><span class="p">()</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;accel-config list&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">acce_ip</span> <span class="o">==</span> <span class="s1">&#39;qat&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">device_num</span> <span class="o">==</span> <span class="n">cpu_num</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">qat_device_num</span><span class="p">:</span>
                <span class="c1"># self.__check_all_device_wq(cpu_num, self.qat_device_num, out)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__check_all_device_wq</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">device_num</span><span class="p">,</span> <span class="n">acce_ip</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__check_random_device_wq</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">device_num</span><span class="p">,</span> <span class="n">acce_ip</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">acce_ip</span> <span class="o">==</span> <span class="s1">&#39;dlb&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">device_num</span> <span class="o">==</span> <span class="n">cpu_num</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlb_device_num</span><span class="p">:</span>
                <span class="c1"># self.__check_all_device_wq(cpu_num, self.dlb_device_num, out)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__check_all_device_wq</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">device_num</span><span class="p">,</span> <span class="n">acce_ip</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__check_random_device_wq</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">device_num</span><span class="p">,</span> <span class="n">acce_ip</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">acce_ip</span> <span class="o">==</span> <span class="s1">&#39;dsa&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">device_num</span> <span class="o">==</span> <span class="n">cpu_num</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsa_device_num</span><span class="p">:</span>
                <span class="c1"># self.__check_all_device_wq(cpu_num, self.dsa_device_num, out)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__check_all_device_wq</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">device_num</span><span class="p">,</span> <span class="n">acce_ip</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__check_random_device_wq</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">device_num</span><span class="p">,</span> <span class="n">acce_ip</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">acce_ip</span> <span class="o">==</span> <span class="s1">&#39;iax&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">device_num</span> <span class="o">==</span> <span class="n">cpu_num</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">iax_device_num</span><span class="p">:</span>
                <span class="c1"># self.__check_all_device_wq(cpu_num, self.iax_device_num, out)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__check_all_device_wq</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">device_num</span><span class="p">,</span> <span class="n">acce_ip</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__check_random_device_wq</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">device_num</span><span class="p">,</span> <span class="n">acce_ip</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.accel_config_install"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.accel_config_install">[docs]</a>    <span class="k">def</span> <span class="nf">accel_config_install</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Install DSA SIOV accel_config</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Install DSA SIOV accel_config</span>
<span class="sd">                      accel_config_install()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ker_ver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_version</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ker_ver</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CENTOS_INTEL_NEXT_KERNEL</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modify_kernel_grub</span><span class="p">(</span><span class="s1">&#39;intel_iommu=on,sm_on,iova_sl idxd.legacy_cdev_load=1 modprobe.blacklist=idxd_uacce&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DSA_PATH_L</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">DSA_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">DSA_PATH_L</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;ls&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/sys/bus/dsa/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;devices&#39;</span><span class="p">,</span> <span class="s1">&#39;drivers&#39;</span><span class="p">,</span> <span class="s1">&#39;drivers_autoprobe&#39;</span><span class="p">,</span> <span class="s1">&#39;drivers_probe&#39;</span><span class="p">,</span> <span class="s1">&#39;uevent&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span>
                               <span class="s1">&#39;all driver exist&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;devices&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;all driver exist&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;ls |grep dsa&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/sys/bus/dsa/devices/&#39;</span><span class="p">)</span>
            <span class="c1"># self.check_keyword([&#39;dsa0&#39;, &#39;dsa10&#39;, &#39;dsa12&#39;, &#39;dsa14&#39;, &#39;dsa2&#39;, &#39;dsa4&#39;, &#39;dsa6&#39;, &#39;dsa8&#39;], out, &#39;Not recognize all dsa device&#39;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;dsa&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Not recognize all dsa device&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;unzip *.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DSA_PATH_L</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;./autogen.sh&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">20</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
            <span class="c1"># self.__check_error(err)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="s2">&quot;./configure CFLAGS=&#39;-g -O2&#39; --prefix=/usr --sysconfdir=/etc --libdir=/usr/lib64 --enable-test=yes&quot;</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
            <span class="c1"># self.__check_error(err)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">20</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make check&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">40</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make install&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">20</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;accel-config --list-cmds&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">(</span>
                <span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;load-config&#39;</span><span class="p">,</span> <span class="s1">&#39;save-config&#39;</span><span class="p">,</span> <span class="s1">&#39;help&#39;</span><span class="p">,</span> <span class="s1">&#39;disable-device&#39;</span><span class="p">,</span> <span class="s1">&#39;enable-device&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;disable-wq&#39;</span><span class="p">,</span> <span class="s1">&#39;enable-wq&#39;</span><span class="p">,</span> <span class="s1">&#39;config-device&#39;</span><span class="p">,</span> <span class="s1">&#39;config-group&#39;</span><span class="p">,</span> <span class="s1">&#39;config-wq&#39;</span><span class="p">,</span> <span class="s1">&#39;config-engine&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;create-mdev&#39;</span><span class="p">,</span> <span class="s1">&#39;remove-mdev&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;accel-config show fail&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;accel-config list -i&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
            <span class="c1"># self.check_keyword([&#39;dsa0&#39;, &#39;dsa10&#39;, &#39;dsa12&#39;, &#39;dsa14&#39;, &#39;dsa2&#39;, &#39;dsa4&#39;, &#39;dsa6&#39;, &#39;dsa8&#39;], out, &#39;Not all DSA device are detected&#39;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;dsa&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;No DSA device are detected&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modify_kernel_grub</span><span class="p">(</span><span class="s1">&#39;intel_iommu=on,sm_on,iova_sl&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">SPR_ACCE_RANDOM_CONFIG_PATH_L</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">SPR_ACCE_RANDOM_CONFIG_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">SPR_ACCE_RANDOM_CONFIG_PATH_L</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;unzip *.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">SPR_ACCE_RANDOM_CONFIG_PATH_L</span><span class="p">)</span></div>


<div class="viewcode-block" id="Accelerator.acce_random_test"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.acce_random_test">[docs]</a>    <span class="k">def</span> <span class="nf">acce_random_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">             Purpose: Configure work-queues</span>
<span class="sd">             Args:</span>
<span class="sd">                 command: execute command</span>
<span class="sd">             Returns:</span>
<span class="sd">                 No</span>
<span class="sd">             Raises:</span>
<span class="sd">                 RuntimeError: If any errors</span>
<span class="sd">             Example:</span>
<span class="sd">                 Simplest usage: Configure work-queues</span>
<span class="sd">                     acce_random_test(&#39;Setup_Randomize_DSA_Conf.sh -au -F 1&#39;)</span>
<span class="sd">       &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">SPR_ACCE_RANDOM_CONFIG_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">SPR_ACCE_RANDOM_CONFIG_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">SPR_ACCE_RANDOM_CONFIG_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;unzip *.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">SPR_ACCE_RANDOM_CONFIG_PATH_L</span><span class="p">)</span>
        <span class="n">cpu_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_num</span><span class="p">()</span>
        <span class="n">device_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">cmd_list</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_Conf&#39;</span><span class="p">)</span>
        <span class="n">acce_ip</span> <span class="o">=</span> <span class="n">cmd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>   <span class="c1">#&#39;DSA&#39;, &#39;IAX&#39;</span>
        <span class="k">if</span> <span class="n">acce_ip</span> <span class="o">==</span> <span class="s1">&#39;QAT&#39;</span><span class="p">:</span>
            <span class="n">device_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qat_device_num</span>
        <span class="k">elif</span> <span class="n">acce_ip</span> <span class="o">==</span> <span class="s1">&#39;DLB&#39;</span><span class="p">:</span>
            <span class="n">device_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlb_device_num</span>
        <span class="k">elif</span> <span class="n">acce_ip</span> <span class="o">==</span> <span class="s1">&#39;DSA&#39;</span><span class="p">:</span>
            <span class="n">device_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsa_device_num</span>
        <span class="k">elif</span> <span class="n">acce_ip</span> <span class="o">==</span> <span class="s1">&#39;IAX&#39;</span><span class="p">:</span>
            <span class="n">device_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iax_device_num</span>
        <span class="n">comm_list</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;a&#39;</span> <span class="ow">in</span> <span class="n">comm_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__choose_run_folder</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">enabled_device_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_enabled_device_num</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="n">enabled_wq_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__check_enabled_wq_num</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">enabled_device_num</span> <span class="o">!=</span> <span class="n">cpu_num</span> <span class="o">*</span> <span class="n">device_num</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Not all device detected&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not all device detected&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;enabled </span><span class="si">{</span><span class="n">enabled_device_num</span><span class="si">}</span><span class="s1"> device(s) out of </span><span class="si">{</span><span class="n">enabled_device_num</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;enabled </span><span class="si">{</span><span class="n">enabled_wq_num</span><span class="si">}</span><span class="s1"> wq(s) out of </span><span class="si">{</span><span class="n">enabled_wq_num</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Device random test fail&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;c&#39;</span> <span class="ow">in</span> <span class="n">comm_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;a&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">comm_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__choose_run_folder</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">enabled_device_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_enabled_device_num</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="n">enabled_wq_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__check_enabled_wq_num</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;enabled </span><span class="si">{</span><span class="n">enabled_device_num</span><span class="si">}</span><span class="s1"> device(s) out of </span><span class="si">{</span><span class="n">enabled_device_num</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;enabled </span><span class="si">{</span><span class="n">enabled_wq_num</span><span class="si">}</span><span class="s1"> wq(s) out of </span><span class="si">{</span><span class="n">enabled_wq_num</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Device random test fail&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;w&#39;</span> <span class="ow">in</span> <span class="n">comm_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;b&#39;</span> <span class="ow">in</span> <span class="n">comm_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__choose_run_folder</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;No errors found. Test pass&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Device random test fail&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="Accelerator.add_environment_to_file"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.add_environment_to_file">[docs]</a>    <span class="k">def</span> <span class="nf">add_environment_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">check_key</span><span class="p">,</span> <span class="n">add_command</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: to check all keys in /root/.bashrc file, if not add environments variable to /root/.bashrc file</span>
<span class="sd">              Args:</span>
<span class="sd">                  check_key: the name of environments variable</span>
<span class="sd">                  add_command: add environments variable to /root/.bashrc file</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: check key &#39;end&#39; in /root/.bashrc file</span>
<span class="sd">                        add_environment_to_file(&#39;end&#39;, &#39;end=$((SECONDS+110))&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;cat /root/.bashrc&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">check_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;echo &#39;</span><span class="si">{</span><span class="n">add_command</span><span class="si">}</span><span class="s2">&#39; &gt;&gt; /root/.bashrc&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;source /root/.bashrc&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span></div>


<div class="viewcode-block" id="Accelerator.attach_mdev_to_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.attach_mdev_to_vm">[docs]</a>    <span class="k">def</span> <span class="nf">attach_mdev_to_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kvm</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="n">mdev_uuid_list</span><span class="p">):</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;attach acc mdev to </span><span class="si">{</span><span class="n">vm_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf xml&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">IMAGE_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;mkdir xml&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">IMAGE_PATH_L</span><span class="p">)</span>
        <span class="n">is_vm_running</span> <span class="o">=</span> <span class="n">kvm</span><span class="o">.</span><span class="n">is_vm_running</span><span class="p">(</span><span class="n">vm_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_vm_running</span><span class="p">:</span>
            <span class="n">kvm</span><span class="o">.</span><span class="n">shutdown_vm</span><span class="p">(</span><span class="n">vm_name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">mdev_uuid</span> <span class="ow">in</span> <span class="n">mdev_uuid_list</span><span class="p">:</span>
            <span class="n">xml_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_mdev_xml_on_sut</span><span class="p">(</span><span class="n">kvm</span><span class="o">.</span><span class="n">sut</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="n">mdev_uuid</span><span class="p">)</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;virsh attach-device </span><span class="si">{</span><span class="n">vm_name</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">xml_path</span><span class="si">}</span><span class="s1"> --config&#39;</span>
            <span class="n">rcode</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">kvm</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rcode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">std_err</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">vm_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kvm</span><span class="o">.</span><span class="n">attached_device_list</span><span class="p">:</span>
                <span class="n">kvm</span><span class="o">.</span><span class="n">attached_device_list</span><span class="p">[</span><span class="n">vm_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">xml_path</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">kvm</span><span class="o">.</span><span class="n">attached_device_list</span><span class="p">[</span><span class="n">vm_name</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">xml_path</span><span class="p">]</span></div>


<div class="viewcode-block" id="Accelerator.change_xmlcli_file"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.change_xmlcli_file">[docs]</a>    <span class="k">def</span> <span class="nf">change_xmlcli_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                Purpose: To install DSA driver</span>
<span class="sd">                Args:</span>
<span class="sd">                    No</span>
<span class="sd">                Returns:</span>
<span class="sd">                    No</span>
<span class="sd">                Raises:</span>
<span class="sd">                    RuntimeError: If any errors</span>
<span class="sd">                Example:</span>
<span class="sd">                    Simplest usage: change xmlcli file</span>
<span class="sd">                        change_xmlcli_file()</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">XMLCLI_TOOL_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">XMLCLI_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">XMLCLI_TOOL_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;unzip *.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">XMLCLI_TOOL_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">EFIXMLCLI_TOOL_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">EFIXMLCLI_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">EFIXMLCLI_TOOL_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;unzip *.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">EFIXMLCLI_TOOL_PATH_L</span><span class="p">)</span>
        <span class="c1"># self.sut.execute_shell_cmd(&#39;reboot&#39;, timeout=30 * 60)</span>
        <span class="c1"># self.Case.sleep(60)</span>
        <span class="c1"># self.Case.wait_and_expect(f&#39;SUT in OS&#39;, 30 * 60, self.sut.check_system_in_os)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">my_os</span><span class="o">.</span><span class="n">warm_reset_cycle_step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Case</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.check_acce_device_status"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.check_acce_device_status">[docs]</a>    <span class="k">def</span> <span class="nf">check_acce_device_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acce_ip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Check all device in output file</span>
<span class="sd">              Args:</span>
<span class="sd">                  acce_ip : Which device need to check the device status, such as &#39;qat&#39;,&#39;dlb&#39;,&#39;dsa&#39;</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Check all QAT device</span>
<span class="sd">                        check_acce_device_status(&#39;qat&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">cpu_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_num</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">acce_ip</span> <span class="o">==</span> <span class="s1">&#39;qat&#39;</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lspci |grep </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">device_num</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_id</span><span class="si">}</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">device_num</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">device_num</span> <span class="o">!=</span> <span class="n">cpu_num</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">qat_device_num</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Not detect all device&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not detect all device&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">acce_ip</span> <span class="o">==</span> <span class="s1">&#39;dlb&#39;</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lspci |grep </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dlb_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">device_num</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dlb_id</span><span class="si">}</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">device_num</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">device_num</span> <span class="o">!=</span> <span class="n">cpu_num</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlb_device_num</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Not detect all device&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not detect all device&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">acce_ip</span> <span class="o">==</span> <span class="s1">&#39;dsa&#39;</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lspci |grep </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dsa_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">device_num</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dsa_id</span><span class="si">}</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">device_num</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">device_num</span> <span class="o">!=</span> <span class="n">cpu_num</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsa_device_num</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Not detect all device&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not detect all device&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">acce_ip</span> <span class="o">==</span> <span class="s1">&#39;iax&#39;</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lspci |grep </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iax_id</span><span class="w"> </span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">device_num</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iax_id</span><span class="w"> </span><span class="si">}</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">device_num</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">device_num</span> <span class="o">!=</span> <span class="n">cpu_num</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">iax_device_num</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Not detect all device&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not detect all device&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.check_enabled_device_num"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.check_enabled_device_num">[docs]</a>    <span class="k">def</span> <span class="nf">check_enabled_device_num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">             Purpose: Check the number of enabled device in work-queues</span>
<span class="sd">             Args:</span>
<span class="sd">                 out: Configure work-queues result</span>
<span class="sd">             Returns:</span>
<span class="sd">                 No</span>
<span class="sd">             Raises:</span>
<span class="sd">                 RuntimeError: If any errors</span>
<span class="sd">             Example:</span>
<span class="sd">                 Simplest usage: Check the number of enabled device in work-queues</span>
<span class="sd">                     check_enabled_device_num(out)</span>
<span class="sd">       &quot;&quot;&quot;</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;Enabling&#39;</span><span class="p">)</span>
        <span class="n">device_list</span> <span class="o">=</span> <span class="n">line_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;enabled&#39;</span><span class="p">)</span>
        <span class="n">device_word_list</span> <span class="o">=</span> <span class="n">device_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">device_word_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="Accelerator.check_keyword"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.check_keyword">[docs]</a>    <span class="k">def</span> <span class="nf">check_keyword</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_list</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err_msg</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: to check all keys in out file, if not return error messages</span>
<span class="sd">              Args:</span>
<span class="sd">                  key_list: All keys need to check</span>
<span class="sd">                  out: command execute out put file</span>
<span class="sd">                  err_msg: if there is one key doesn&#39;t in out file, return an error message</span>
<span class="sd">              Returns:</span>
<span class="sd">                  Yes</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: check all keys &quot;dsa_list&quot; in out file</span>
<span class="sd">                        _, out, err = self.sut.execute_shell_cmd(&#39;accel-config list -i&#39;, timeout=60)</span>
<span class="sd">                        dsa_list = [&#39;dsa10&#39;, &#39;dsa12&#39;, &#39;dsa14&#39;, &#39;dsa2&#39;, &#39;dsa4&#39;, &#39;dsa6&#39;, &#39;dsa8&#39;]</span>
<span class="sd">                        err_msg = &#39;Issue - Not All DSA device recognized&#39;</span>
<span class="sd">                        check_keyword(dsa_list, out, err_msg)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">key_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.check_python_environment"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.check_python_environment">[docs]</a>    <span class="k">def</span> <span class="nf">check_python_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;ln -s /usr/bin/python3 /usr/bin/python | wc -l&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;File exists&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;*************************************************************&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;*************************************************************&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="Accelerator.check_qat_service_status"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.check_qat_service_status">[docs]</a>    <span class="k">def</span> <span class="nf">check_qat_service_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_vf</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Check all QAT device status in output file</span>
<span class="sd">              Args:</span>
<span class="sd">                  vf: Check QAT vf status or pf status</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Check all QAT device status in output file</span>
<span class="sd">                        check_all_device_status(True)--&gt;check qat vf status</span>
<span class="sd">                        check_all_device_status(False)--&gt;check qat pf status</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cpu_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_num</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qat_service_status</span><span class="p">()</span>
        <span class="n">str_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">status_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">is_vf</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">str_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;state: up&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">status_num</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">status_num</span> <span class="o">!=</span> <span class="n">cpu_num</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_device_num</span><span class="o">*</span><span class="mi">17</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Not all QAT device status up or Not Recognize all QAT device&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not all QAT device status up or Not Recognize all QAT device&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">str_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;state: up&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">status_num</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">status_num</span> <span class="o">!=</span> <span class="n">cpu_num</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_device_num</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Not all QAT device status up or Not Recognize all QAT device&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not all QAT device status up or Not Recognize all QAT device&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.clear_qat_config_file"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.clear_qat_config_file">[docs]</a>    <span class="k">def</span> <span class="nf">clear_qat_config_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Clear QAT config files</span>
<span class="sd">              Args:</span>
<span class="sd">                  config_key : Which function (asym, mdev, shim) config files need to modify</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Clear QAT asymmetric encrypted config files</span>
<span class="sd">                        clear_qat_config_file(&#39;asym&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">config_key</span> <span class="o">==</span> <span class="s1">&#39;mdev&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__qat_mdev_config_clr</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">config_key</span> <span class="o">==</span> <span class="s1">&#39;asym&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__qat_asym_config_clr</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">config_key</span> <span class="o">==</span> <span class="s1">&#39;shim&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__qat_shim_config_clr</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Input correct config keyword&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Input correct config keyword&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.cpuid_check"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.cpuid_check">[docs]</a>    <span class="k">def</span> <span class="nf">cpuid_check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">             Purpose: Check SGX &quot;cpuid&quot; value</span>
<span class="sd">             Args:</span>
<span class="sd">                 No</span>
<span class="sd">             Returns:</span>
<span class="sd">                 No</span>
<span class="sd">             Raises:</span>
<span class="sd">                 RuntimeError: If any errors</span>
<span class="sd">             Example:</span>
<span class="sd">                 Simplest usage: Check SGX &quot;cpuid 0x12&quot; value</span>
<span class="sd">                     cpuid_check()</span>
<span class="sd">       &quot;&quot;&quot;</span>
        <span class="n">thread_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_thread_num</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">CPUID_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">CPUID_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">CPUID_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;chmod 777 *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">CPUID_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;./cpuid -l 0x12 &gt; cpuid_0x12.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">CPUID_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">download_to_local</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">CPUID_PATH_L</span><span class="si">}</span><span class="s1">cpuid_0x12.log&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LOG_PATH</span><span class="p">,</span> <span class="s1">&#39;Logs&#39;</span><span class="p">))</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;cat cpuid_0x12.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">CPUID_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;CPU&#39;</span><span class="p">)</span>
        <span class="n">sgx_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">sgx_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">thread_num</span><span class="p">):</span>
            <span class="n">l1</span> <span class="o">=</span> <span class="n">sgx_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">sgx1_line_list</span> <span class="o">=</span> <span class="n">l1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
            <span class="n">sgx2_line_list</span> <span class="o">=</span> <span class="n">l1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
            <span class="n">sgx1_value</span> <span class="o">=</span> <span class="n">sgx1_line_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">sgx2_value</span> <span class="o">=</span> <span class="n">sgx2_line_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">sgx1_value</span> <span class="o">!=</span> <span class="s1">&#39;true&#39;</span> <span class="ow">or</span> <span class="n">sgx2_value</span> <span class="o">!=</span> <span class="s1">&#39;true&#39;</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;SGX cpuid value is incorrect&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;SGX cpuid value is incorrect&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.cpuid_check_uefi"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.cpuid_check_uefi">[docs]</a>    <span class="k">def</span> <span class="nf">cpuid_check_uefi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">             Purpose: Check SGX &quot;cpuid&quot; value</span>
<span class="sd">             Args:</span>
<span class="sd">                 No</span>
<span class="sd">             Returns:</span>
<span class="sd">                 No</span>
<span class="sd">             Raises:</span>
<span class="sd">                 RuntimeError: If any errors</span>
<span class="sd">             Example:</span>
<span class="sd">                 Simplest usage: Check SGX &quot;cpuid 0x12&quot; value</span>
<span class="sd">                     cpuid_check()</span>
<span class="sd">       &quot;&quot;&quot;</span>
        <span class="n">usb_device_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__usb_device_detact</span><span class="p">()</span>
        <span class="n">uefi_cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;fs</span><span class="si">{</span><span class="n">usb_device_id</span><span class="si">}</span><span class="s1">:</span><span class="se">\\</span><span class="s1">cpuidd</span><span class="se">\\</span><span class="s1">Cpuid.efi&#39;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_uefi_cmd</span><span class="p">(</span><span class="n">uefi_cmd</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;SGX1: 1&#39;</span><span class="p">,</span> <span class="s1">&#39;SGX2: 1&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;SGX enable failed&#39;</span><span class="p">)</span></div>
    <span class="c1"># ##API 15</span>
    <span class="c1"># def create_dlb_mdev(self, dlb_device_index):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#           Purpose: Create DLB SRIOV config</span>
    <span class="c1">#           Args:</span>
    <span class="c1">#               dlb_dev: DLB device id number, device id number begin from 0</span>
    <span class="c1">#           Returns:</span>
    <span class="c1">#               No</span>
    <span class="c1">#           Raises:</span>
    <span class="c1">#               RuntimeError: If any errors</span>
    <span class="c1">#           Example:</span>
    <span class="c1">#               Simplest usage: Create DLB SRIOV config</span>
    <span class="c1">#                   creat_dlb_mdev(0)</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     self.add_environment_to_file(&#39;SYSFS_PATH&#39;, f&#39;export SYSFS_PATH=/sys/class/dlb2/dlb{dlb_device_index}&#39;)</span>
    <span class="c1">#     self.add_environment_to_file(&#39;UUID1&#39;, &quot;export UUID1=`uuidgen`&quot;)</span>
    <span class="c1">#     self.add_environment_to_file(&#39;MDEV_PATH&#39;, &#39;export MDEV_PATH=/sys/bus/mdev/devices/$UUID1/dlb2_mdev&#39;)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;echo $UUID1 &gt; $SYSFS_PATH/device/mdev_supported_types/dlb2-dlb/create &#39;, timeout=60, cwd=&#39;/root&#39;)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;echo 2048 &gt; $MDEV_PATH/num_atomic_inflights&#39;, timeout=60, cwd=&#39;/root&#39;)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;echo 4096 &gt; $MDEV_PATH/num_dir_credits&#39;, timeout=60, cwd=&#39;/root&#39;)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;echo 64 &gt; $MDEV_PATH/num_dir_ports&#39;, timeout=60, cwd=&#39;/root&#39;)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;echo 2048 &gt; $MDEV_PATH/num_hist_list_entries&#39;, timeout=60, cwd=&#39;/root&#39;)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;echo 8192 &gt; $MDEV_PATH/num_ldb_credits&#39;, timeout=60, cwd=&#39;/root&#39;)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;echo 64 &gt; $MDEV_PATH/num_ldb_ports&#39;, timeout=60, cwd=&#39;/root&#39;)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;echo 32 &gt; $MDEV_PATH/num_ldb_queues&#39;, timeout=60, cwd=&#39;/root&#39;)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;echo 32 &gt; $MDEV_PATH/num_sched_domains&#39;, timeout=60, cwd=&#39;/root&#39;)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;echo 16 &gt; $MDEV_PATH/num_sn0_slots&#39;, timeout=60, cwd=&#39;/root&#39;)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;echo 16 &gt; $MDEV_PATH/num_sn1_slots&#39;, timeout=60, cwd=&#39;/root&#39;)</span>

    <span class="k">def</span> <span class="nf">__create_dlb_mdev_egs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MDEV_PATH</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 2048 &gt; </span><span class="si">{</span><span class="n">MDEV_PATH</span><span class="si">}</span><span class="s1">/num_atomic_inflights&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 4096 &gt; </span><span class="si">{</span><span class="n">MDEV_PATH</span><span class="si">}</span><span class="s1">/num_dir_credits&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 64 &gt; </span><span class="si">{</span><span class="n">MDEV_PATH</span><span class="si">}</span><span class="s1">/num_dir_ports&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 2048 &gt;  </span><span class="si">{</span><span class="n">MDEV_PATH</span><span class="si">}</span><span class="s1">/num_hist_list_entries&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 8192 &gt;  </span><span class="si">{</span><span class="n">MDEV_PATH</span><span class="si">}</span><span class="s1">/num_ldb_credits&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 64 &gt;  </span><span class="si">{</span><span class="n">MDEV_PATH</span><span class="si">}</span><span class="s1">/num_ldb_ports&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 32 &gt;  </span><span class="si">{</span><span class="n">MDEV_PATH</span><span class="si">}</span><span class="s1">/num_ldb_queues&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 32 &gt;  </span><span class="si">{</span><span class="n">MDEV_PATH</span><span class="si">}</span><span class="s1">/num_sched_domains&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 16 &gt;  </span><span class="si">{</span><span class="n">MDEV_PATH</span><span class="si">}</span><span class="s1">/num_sn0_slots&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 16 &gt;  </span><span class="si">{</span><span class="n">MDEV_PATH</span><span class="si">}</span><span class="s1">/num_sn1_slots&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__create_dlb_mdev_bhs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MDEV_PATH</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 2048 &gt; </span><span class="si">{</span><span class="n">MDEV_PATH</span><span class="si">}</span><span class="s1">/num_atomic_inflights&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 96 &gt; </span><span class="si">{</span><span class="n">MDEV_PATH</span><span class="si">}</span><span class="s1">/num_dir_ports&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 2048 &gt;  </span><span class="si">{</span><span class="n">MDEV_PATH</span><span class="si">}</span><span class="s1">/num_hist_list_entries&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 16384 &gt;  </span><span class="si">{</span><span class="n">MDEV_PATH</span><span class="si">}</span><span class="s1">/num_ldb_credits&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 64 &gt;  </span><span class="si">{</span><span class="n">MDEV_PATH</span><span class="si">}</span><span class="s1">/num_ldb_ports&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 32 &gt;  </span><span class="si">{</span><span class="n">MDEV_PATH</span><span class="si">}</span><span class="s1">/num_ldb_queues&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 32 &gt;  </span><span class="si">{</span><span class="n">MDEV_PATH</span><span class="si">}</span><span class="s1">/num_sched_domains&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 16 &gt;  </span><span class="si">{</span><span class="n">MDEV_PATH</span><span class="si">}</span><span class="s1">/num_sn0_slots&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 16 &gt;  </span><span class="si">{</span><span class="n">MDEV_PATH</span><span class="si">}</span><span class="s1">/num_sn1_slots&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root&#39;</span><span class="p">)</span>

    <span class="c1">##API 15</span>
<div class="viewcode-block" id="Accelerator.create_dlb_mdev"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.create_dlb_mdev">[docs]</a>    <span class="k">def</span> <span class="nf">create_dlb_mdev</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dlb_device_index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Create DLB SRIOV config</span>
<span class="sd">              Args:</span>
<span class="sd">                  dlb_dev: DLB device id number, device id number begin from 0</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Create DLB SRIOV config</span>
<span class="sd">                      creat_dlb_mdev(0)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file</span><span class="p">(</span><span class="s1">&#39;SYSFS_PATH&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;export SYSFS_PATH=/sys/class/dlb2/dlb</span><span class="si">{</span><span class="n">dlb_device_index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;uuidgen &gt; uuidgen.txt&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root/&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;cat uuidgen.txt&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root/&#39;</span><span class="p">)</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">uuidgen</span> <span class="o">=</span> <span class="n">line_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">MDEV_PATH</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;/sys/bus/mdev/devices/</span><span class="si">{</span><span class="n">uuidgen</span><span class="si">}</span><span class="s1">/dlb2_mdev&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="n">uuidgen</span><span class="si">}</span><span class="s1"> &gt; $SYSFS_PATH/device/mdev_supported_types/dlb2-dlb/create &#39;</span><span class="p">,</span>
                                   <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__create_dlb_mdev_egs</span><span class="p">(</span><span class="n">MDEV_PATH</span><span class="p">)</span></div>


<div class="viewcode-block" id="Accelerator.create_mdev_xml_on_sut"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.create_mdev_xml_on_sut">[docs]</a>    <span class="k">def</span> <span class="nf">create_mdev_xml_on_sut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sut</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="n">mdev_uuid</span><span class="p">):</span>
        <span class="n">xml_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;pci_device_</span><span class="si">{</span><span class="n">vm_name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">mdev_uuid</span><span class="si">}</span><span class="s1">.xml&#39;</span>
        <span class="n">xml_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mdev_xml_content</span><span class="p">(</span><span class="n">mdev_uuid</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">xml_filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">xml_file</span><span class="p">:</span>
            <span class="n">xml_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">xml_content</span><span class="p">)</span>

        <span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">xml_filename</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;IMAGE_PATH_L&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">/xml&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">xml_filename</span><span class="p">)</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sut_tool</span><span class="p">(</span><span class="s1">&#39;IMAGE_PATH_L&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">/xml/</span><span class="si">{</span><span class="n">xml_filename</span><span class="si">}</span><span class="s2">&quot;</span></div>


<div class="viewcode-block" id="Accelerator.delete_environment"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.delete_environment">[docs]</a>    <span class="k">def</span> <span class="nf">delete_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">check_key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: to check and delete all keys in /root/.bashrc file, if already add environments variable delete it in /root/.bashrc file</span>
<span class="sd">              Args:</span>
<span class="sd">                  check_key: the name of environments variable</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: check if key &#39;end&#39; in /root/.bashrc file and delete it</span>
<span class="sd">                        delete_environment(&#39;end&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;cat /root/.bashrc&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">check_key</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="c1"># self.sut.execute_shell_cmd(f&#39;sed -i &quot;s/.*{check_key}.*//g&quot; /root/.bashrc&#39;, timeout=60)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sed &#39;/</span><span class="si">{</span><span class="n">check_key</span><span class="si">}</span><span class="s2">/d&#39; /root/.bashrc &gt; /root/.bashrc1&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mv -f /root/.bashrc1 /root/.bashrc&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;source /root/.bashrc&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.device_mode_test"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.device_mode_test">[docs]</a>    <span class="k">def</span> <span class="nf">device_mode_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acce_ip</span><span class="p">,</span> <span class="n">is_random</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">             Purpose: Run acce_ip user mode test</span>
<span class="sd">             Args:</span>
<span class="sd">                 acce_ip: Which device need to check the device status, such as: &#39;DSA&#39; or &#39;IAX&#39;</span>
<span class="sd">                 is_random: Run value is random or not</span>
<span class="sd">             Returns:</span>
<span class="sd">                 No</span>
<span class="sd">             Raises:</span>
<span class="sd">                 RuntimeError: If any errors</span>
<span class="sd">             Example:</span>
<span class="sd">                 Simplest usage: Run acce_ip user mode test</span>
<span class="sd">                     device_mode_test(&#39;IAX&#39;, False)</span>
<span class="sd">       &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;./Setup_Randomize_</span><span class="si">{</span><span class="n">acce_ip</span><span class="si">}</span><span class="s1">_Conf.sh -r&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SPR_ACCE_RANDOM_CONFIG_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
        <span class="n">cpu_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_num</span><span class="p">()</span>
        <span class="n">device_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">acce_ip</span> <span class="o">==</span> <span class="s1">&#39;QAT&#39;</span><span class="p">:</span>
            <span class="n">device_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qat_device_num</span> <span class="o">*</span> <span class="n">cpu_num</span> <span class="o">*</span> <span class="mi">8</span>
        <span class="k">elif</span> <span class="n">acce_ip</span> <span class="o">==</span> <span class="s1">&#39;DLB&#39;</span><span class="p">:</span>
            <span class="n">device_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlb_device_num</span> <span class="o">*</span> <span class="n">cpu_num</span> <span class="o">*</span> <span class="mi">8</span>
        <span class="k">elif</span> <span class="n">acce_ip</span> <span class="o">==</span> <span class="s1">&#39;DSA&#39;</span><span class="p">:</span>
            <span class="n">device_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsa_device_num</span> <span class="o">*</span> <span class="n">cpu_num</span> <span class="o">*</span> <span class="mi">8</span>
        <span class="k">elif</span> <span class="n">acce_ip</span> <span class="o">==</span> <span class="s1">&#39;IAX&#39;</span><span class="p">:</span>
            <span class="n">device_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iax_device_num</span> <span class="o">*</span> <span class="n">cpu_num</span> <span class="o">*</span> <span class="mi">8</span>
        <span class="n">device_wq</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;WQs:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">device_wq</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">thread_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">device_wq</span><span class="p">)</span> <span class="o">*</span> <span class="mi">24</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">device_wq</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">thread_num</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_random</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">thread_num</span><span class="si">}</span><span class="s1"> of </span><span class="si">{</span><span class="n">thread_num</span><span class="si">}</span><span class="s1"> tests passed&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Device mode test failed&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">device_num</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">device_wq</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Not all WQ are detected&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not all WQ are detected&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">thread_num</span><span class="si">}</span><span class="s1"> of </span><span class="si">{</span><span class="n">thread_num</span><span class="si">}</span><span class="s1"> tests passed&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Device mode test failed&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.device_opcodes_stress"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.device_opcodes_stress">[docs]</a>    <span class="k">def</span> <span class="nf">device_opcodes_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">test_index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">             Purpose: Run acce_ip test with available OpCodes</span>
<span class="sd">             Args:</span>
<span class="sd">                 command: execute command</span>
<span class="sd">                 test_index: Which OpCode need to run</span>
<span class="sd">             Returns:</span>
<span class="sd">                 No</span>
<span class="sd">             Raises:</span>
<span class="sd">                 RuntimeError: If any errors</span>
<span class="sd">             Example:</span>
<span class="sd">                 Simplest usage: Run acce_ip test with available OpCodes</span>
<span class="sd">                     device_opcodes_stress(&#39;Setup_Randomize_DSA_Conf.sh -o&#39;, 3)</span>
<span class="sd">       &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;./</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s1"> 0x</span><span class="si">{</span><span class="n">test_index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SPR_ACCE_RANDOM_CONFIG_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">test_index</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">actual_wq</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">total_wq</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;work queues&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">word_list</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;of&#39;</span><span class="p">)</span>
                    <span class="n">actual_wq</span> <span class="o">=</span> <span class="n">word_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">total_wq</span> <span class="o">=</span> <span class="n">word_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;work&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">actual_wq</span><span class="si">}</span><span class="s1"> of </span><span class="si">{</span><span class="n">total_wq</span><span class="si">}</span><span class="s1"> work queues logged completion records&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Not all work queues logged completion records&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.disable_device_conf"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.disable_device_conf">[docs]</a>    <span class="k">def</span> <span class="nf">disable_device_conf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disable_num</span><span class="p">,</span> <span class="n">acce_ip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">             Purpose: Disable work-queues</span>
<span class="sd">             Args:</span>
<span class="sd">                 device_num: The number of enabled device in work-queues</span>
<span class="sd">                 acce_ip: Which device need to check the device status, such as: &#39;DSA&#39; or &#39;IAX&#39;</span>
<span class="sd">             Returns:</span>
<span class="sd">                 No</span>
<span class="sd">             Raises:</span>
<span class="sd">                 RuntimeError: If any errors</span>
<span class="sd">             Example:</span>
<span class="sd">                 Simplest usage: Disable work-queues</span>
<span class="sd">                     disable_device_conf(device_num, &#39;DSA&#39;)</span>
<span class="sd">       &quot;&quot;&quot;</span>
        <span class="n">Case</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="s1">&#39;Disable dsa config&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;./Setup_Randomize_</span><span class="si">{</span><span class="n">acce_ip</span><span class="si">}</span><span class="s1">_Conf.sh -d&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SPR_ACCE_RANDOM_CONFIG_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">dsa_disable_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;disabled 1 device(s) out of 1&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">dsa_disable_num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">dsa_disable_num</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">disable_num</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Not all dsa device are disabled&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not all dsa device are disabled&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.dlb_install"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.dlb_install">[docs]</a>    <span class="k">def</span> <span class="nf">dlb_install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ch_makefile</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: To install DLB driver</span>
<span class="sd">              Args:</span>
<span class="sd">                  ch_makefile: If need to modify DLB make file</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Install DLB driver need modify Makefile</span>
<span class="sd">                      dlb_install(True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DLB_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">DLB_DRIVER_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">DLB_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="c1"># If driver is in txz format extract it, if it is in zip format unzip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;if [ -e *.txz ]; then tar xvf *.txz; fi&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DLB_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;if [ -e *.zip ]; then unzip *.zip; fi&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DLB_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;mv dlb/* .&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DLB_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf dlb&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DLB_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ch_makefile</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sed -i &#39;s/ccflags-y += -DCONFIG_INTEL_DLB2_SIOV/#  iccflags-y += -DCONFIG_INTEL_DLB2_SIOV/g&#39; </span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s2">driver/dlb2/Makefile&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">driver/dlb2/&#39;</span><span class="p">)</span>
        <span class="c1"># self.__check_error(err)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rmmod dlb2&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">driver/dlb2/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;insmod ./dlb2.ko&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">driver/dlb2/&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;lsmod | grep dlb2&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;dlb2&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Issue - dlb driver install fail&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">libdlb/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file</span><span class="p">(</span><span class="s1">&#39;LD_LIBRARY_PATH&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;export LD_LIBRARY_PATH=</span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">libdlb/&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.dlb_stress"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.dlb_stress">[docs]</a>    <span class="k">def</span> <span class="nf">dlb_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run dlb stress overnight</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run dlb stress overnight</span>
<span class="sd">                        dlb_stress()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf dlb.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root/&#39;</span><span class="p">)</span>
        <span class="c1"># self.add_environment_to_file(&#39;end&#39;, &#39;end=$((SECONDS+300))&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;while [ $SECONDS -lt 300 ]; do /home/BKCPkg/domains/accelerator/dlb/libdlb/examples/ldb_traffic -n 1024 ;done | tee /root/dlb.log&#39;</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mi">500000</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;cat /root/dlb.log&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;[tx_traffic()] Sent 1024 events&#39;</span><span class="p">,</span> <span class="s1">&#39;[rx_traffic()] Received 1024 events&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Run DLB stress fail&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">download_to_local</span><span class="p">(</span><span class="n">remotepath</span><span class="o">=</span><span class="s1">&#39;/root/dlb.log&#39;</span><span class="p">,</span> <span class="n">localpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LOG_PATH</span><span class="p">,</span> <span class="s1">&#39;Logs&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_environment</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.dlb_uninstall"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.dlb_uninstall">[docs]</a>    <span class="k">def</span> <span class="nf">dlb_uninstall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">             Purpose: to uninstall dlb driver</span>
<span class="sd">             Args:</span>
<span class="sd">                 No</span>
<span class="sd">             Returns:</span>
<span class="sd">                 No</span>
<span class="sd">             Raises:</span>
<span class="sd">                 RuntimeError: If any errors</span>
<span class="sd">             Example:</span>
<span class="sd">                 Simplest usage: uninstall dlb driver</span>
<span class="sd">                     dlb_uninstall()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rmmod dlb2&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">driver/dlb2/&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.dmatest_check"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.dmatest_check">[docs]</a>    <span class="k">def</span> <span class="nf">dmatest_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acce_ip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">             Purpose: Run dmatest</span>
<span class="sd">             Args:</span>
<span class="sd">                 acce_ip: Which device need to check the device status, such as: &#39;DSA&#39; or &#39;IAX&#39;</span>
<span class="sd">             Returns:</span>
<span class="sd">                 No</span>
<span class="sd">             Raises:</span>
<span class="sd">                 RuntimeError: If any errors</span>
<span class="sd">             Example:</span>
<span class="sd">                 Simplest usage: Run dmatest</span>
<span class="sd">                     dmatest_check(device_num, &#39;DSA&#39;)</span>
<span class="sd">       &quot;&quot;&quot;</span>
        <span class="n">ker_ver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_version</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ker_ver</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CENTOS_INTEL_NEXT_KERNEL</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;./Setup_Randomize_</span><span class="si">{</span><span class="n">acce_ip</span><span class="si">}</span><span class="s1">_Conf.sh -x -i 1000 -j 10&#39;</span><span class="p">,</span>
                                                     <span class="n">timeout</span><span class="o">=</span><span class="mi">50</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SPR_ACCE_RANDOM_CONFIG_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;./Setup_Randomize_</span><span class="si">{</span><span class="n">acce_ip</span><span class="si">}</span><span class="s1">_Conf.sh -i 1000 -j 10&#39;</span><span class="p">,</span>
                                                     <span class="n">timeout</span><span class="o">=</span><span class="mi">50</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SPR_ACCE_RANDOM_CONFIG_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">total_thread</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">threads_passed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Total Threads&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">word_list0</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="n">total_thread</span> <span class="o">=</span> <span class="n">word_list0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;Threads Passed&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">word_list1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="n">threads_passed</span> <span class="o">=</span> <span class="n">word_list1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">total_thread</span> <span class="o">!=</span> <span class="n">threads_passed</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;dmatest fail&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;dmatest fail&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.dsa_wq_2g2q_user_1"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.dsa_wq_2g2q_user_1">[docs]</a>    <span class="k">def</span> <span class="nf">dsa_wq_2g2q_user_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dsa_device_index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run DSA workqueues two groups two queues and user 1 test</span>
<span class="sd">              Args:</span>
<span class="sd">                  dsa_device_index: DSA device index, index begin from 0</span>
<span class="sd">              Returns:</span>
<span class="sd">                  None</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run DSA workqueues two groups two queues and user 1 test</span>
<span class="sd">                      dsa_wq_2g2q_user_1(&#39;0&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ker_ver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_version</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ker_ver</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CENTOS_INTEL_NEXT_KERNEL</span><span class="p">:</span>
            <span class="n">res</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;accel-config load-config -c ./2g2q_user_1.conf | wc -l&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}</span><span class="s1">*/test/configs/&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">out</span> <span class="o">!=</span> <span class="s1">&#39;0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;accel-config load-config fail&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;accel-config load-config fail&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;accel-config list -i&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}</span><span class="s1">*/test/configs/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;&quot;grouped_workqueues&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;grouped_engines&quot;&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Not recognized grouped_workqueues&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;accel-config enable-device dsa</span><span class="si">{</span><span class="n">dsa_device_index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}</span><span class="s1">*/test/configs/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;enabled 1 device(s) out of 1&#39;</span><span class="p">],</span> <span class="n">err</span><span class="p">,</span> <span class="s1">&#39;Enable dsa device fail&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;accel-config enable-wq dsa</span><span class="si">{</span><span class="n">dsa_device_index</span><span class="si">}</span><span class="s1">/wq0.0 dsa</span><span class="si">{</span><span class="n">dsa_device_index</span><span class="si">}</span><span class="s1">/wq0.1&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;enabled 2 wq(s) out of 2&#39;</span><span class="p">],</span> <span class="n">err</span><span class="p">,</span> <span class="s1">&#39;Not all workqueues are enabled&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;accel-config list -i&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;&quot;state&quot;:&quot;enabled&quot;&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Not recognized grouped_workqueues&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;accel-config disable-wq dsa</span><span class="si">{</span><span class="n">dsa_device_index</span><span class="si">}</span><span class="s1">/wq0.1 dsa</span><span class="si">{</span><span class="n">dsa_device_index</span><span class="si">}</span><span class="s1">/wq0.0&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;disabled 2 wq(s) out of 2&#39;</span><span class="p">],</span> <span class="n">err</span><span class="p">,</span> <span class="s1">&#39;Not all workqueues are disabled&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;accel-config disable-device dsa</span><span class="si">{</span><span class="n">dsa_device_index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;disabled 1 device(s) out of 1&#39;</span><span class="p">],</span> <span class="n">err</span><span class="p">,</span> <span class="s1">&#39;Disable dsa device fail&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;accel-config list -i&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}</span><span class="s1">*/test/configs/&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;grouped_workqueues&#39;</span> <span class="ow">in</span> <span class="n">out</span> <span class="ow">or</span> <span class="s1">&#39;&quot;grouped_engines&quot;&#39;</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;disable workqueues fail&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;disable workqueues fail&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">DSA_path</span> <span class="o">=</span> <span class="s1">&#39;/usr/share/accel-config/test/configs&#39;</span>
            <span class="n">res</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;accel-config load-config -c 2g2q_user_1.conf | wc -l&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DSA_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">out</span> <span class="o">!=</span> <span class="s1">&#39;0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;accel-config load-config fail&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;accel-config load-config fail&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;accel-config list -i&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DSA_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;&quot;grouped_workqueues&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;grouped_engines&quot;&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Not recognized grouped_workqueues&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;accel-config enable-device dsa</span><span class="si">{</span><span class="n">dsa_device_index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DSA_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;enabled 1 device(s) out of 1&#39;</span><span class="p">],</span> <span class="n">err</span><span class="p">,</span> <span class="s1">&#39;Enable dsa device fail&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;accel-config enable-wq dsa</span><span class="si">{</span><span class="n">dsa_device_index</span><span class="si">}</span><span class="s1">/wq0.0 dsa</span><span class="si">{</span><span class="n">dsa_device_index</span><span class="si">}</span><span class="s1">/wq0.1&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DSA_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;enabled 2 wq(s) out of 2&#39;</span><span class="p">],</span> <span class="n">err</span><span class="p">,</span> <span class="s1">&#39;Not all workqueues are enabled&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;accel-config list -i&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DSA_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;&quot;state&quot;:&quot;enabled&quot;&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Not recognized grouped_workqueues&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;accel-config disable-wq dsa</span><span class="si">{</span><span class="n">dsa_device_index</span><span class="si">}</span><span class="s1">/wq0.1 dsa</span><span class="si">{</span><span class="n">dsa_device_index</span><span class="si">}</span><span class="s1">/wq0.0&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DSA_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;disabled 2 wq(s) out of 2&#39;</span><span class="p">],</span> <span class="n">err</span><span class="p">,</span> <span class="s1">&#39;Not all workqueues are disabled&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;accel-config disable-device dsa</span><span class="si">{</span><span class="n">dsa_device_index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DSA_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;disabled 1 device(s) out of 1&#39;</span><span class="p">],</span> <span class="n">err</span><span class="p">,</span> <span class="s1">&#39;Disable dsa device fail&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;accel-config list -i&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DSA_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;grouped_workqueues&#39;</span> <span class="ow">in</span> <span class="n">out</span> <span class="ow">or</span> <span class="s1">&#39;&quot;grouped_engines&quot;&#39;</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;disable workqueues fail&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;disable workqueues fail&#39;</span><span class="p">)</span></div>

    <span class="c1"># def dsa_wq_2g2q_user_1(self, dsa_device_index):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#           Purpose: Run DSA workqueues two groups two queues and user 1 test</span>
    <span class="c1">#           Args:</span>
    <span class="c1">#               dsa_device_index: DSA device index, index begin from 0</span>
    <span class="c1">#           Returns:</span>
    <span class="c1">#               None</span>
    <span class="c1">#           Raises:</span>
    <span class="c1">#               RuntimeError: If any errors</span>
    <span class="c1">#           Example:</span>
    <span class="c1">#               Simplest usage: Run DSA workqueues two groups two queues and user 1 test</span>
    <span class="c1">#                   dsa_wq_2g2q_user_1(&#39;0&#39;)</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     res, out, err = self.sut.execute_shell_cmd(&#39;accel-config load-config -c ./2g2q_user_1.conf | wc -l&#39;, timeout=60, cwd=f&#39;{DSA_PATH_L}*/test/configs/&#39;)</span>
    <span class="c1">#     if out != &#39;0\n&#39;:</span>
    <span class="c1">#         logger.error(&#39;accel-config load-config fail&#39;)</span>
    <span class="c1">#         raise Exception(&#39;accel-config load-config fail&#39;)</span>
    <span class="c1">#     _, out, err = self.sut.execute_shell_cmd(&#39;accel-config list -i&#39;, timeout=60, cwd=f&#39;{DSA_PATH_L}*/test/configs/&#39;)</span>
    <span class="c1">#     self.check_keyword([&#39;&quot;grouped_workqueues&quot;&#39;, &#39;&quot;grouped_engines&quot;&#39;], out, &#39;Not recognized grouped_workqueues&#39;)</span>
    <span class="c1">#     _, out, err = self.sut.execute_shell_cmd(f&#39;accel-config enable-device dsa{dsa_device_index}&#39;, timeout=60, cwd=f&#39;{DSA_PATH_L}*/test/configs/&#39;)</span>
    <span class="c1">#     self.check_keyword([&#39;enabled 1 device(s) out of 1&#39;], err, &#39;Enable dsa device fail&#39;)</span>
    <span class="c1">#     _, out, err = self.sut.execute_shell_cmd(f&#39;accel-config enable-wq dsa{dsa_device_index}/wq0.0 dsa{dsa_device_index}/wq0.1&#39;, timeout=60, cwd=f&#39;{DSA_PATH_L}*/&#39;)</span>
    <span class="c1">#     self.check_keyword([&#39;enabled 2 wq(s) out of 2&#39;], err, &#39;Not all workqueues are enabled&#39;)</span>
    <span class="c1">#     _, out, err = self.sut.execute_shell_cmd(&#39;accel-config list -i&#39;, timeout=60, cwd=f&#39;{DSA_PATH_L}*/&#39;)</span>
    <span class="c1">#     self.check_keyword([&#39;&quot;state&quot;:&quot;enabled&quot;&#39;], out, &#39;Not recognized grouped_workqueues&#39;)</span>
    <span class="c1">#     _, out, err = self.sut.execute_shell_cmd(f&#39;accel-config disable-wq dsa{dsa_device_index}/wq0.1 dsa{dsa_device_index}/wq0.0&#39;, timeout=60, cwd=f&#39;{DSA_PATH_L}*/&#39;)</span>
    <span class="c1">#     self.check_keyword([&#39;disabled 2 wq(s) out of 2&#39;], err, &#39;Not all workqueues are disabled&#39;)</span>
    <span class="c1">#     _, out, err = self.sut.execute_shell_cmd(f&#39;accel-config disable-device dsa{dsa_device_index}&#39;, timeout=60, cwd=f&#39;{DSA_PATH_L}*/&#39;)</span>
    <span class="c1">#     self.check_keyword([&#39;disabled 1 device(s) out of 1&#39;], err, &#39;Disable dsa device fail&#39;)</span>
    <span class="c1">#     _, out, err = self.sut.execute_shell_cmd(&#39;accel-config list -i&#39;, timeout=60, cwd=f&#39;{DSA_PATH_L}*/test/configs/&#39;)</span>
    <span class="c1">#     if &#39;grouped_workqueues&#39; in out or &#39;&quot;grouped_engines&quot;&#39; in out:</span>
    <span class="c1">#         logger.error(&#39;disable workqueues fail&#39;)</span>
    <span class="c1">#         raise Exception(&#39;disable workqueues fail&#39;)</span>

    <span class="c1">#</span>
    <span class="c1"># def fio_stress(self):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#           Purpose: Run fio stress overnight</span>
    <span class="c1">#           Args:</span>
    <span class="c1">#               No</span>
    <span class="c1">#           Returns:</span>
    <span class="c1">#               No</span>
    <span class="c1">#           Raises:</span>
    <span class="c1">#               RuntimeError: If any errors</span>
    <span class="c1">#           Example:</span>
    <span class="c1">#               Simplest usage: Run fio stress overnight</span>
    <span class="c1">#                     fio_stress()</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;yum install -y fio&#39;, timeout=10*60)</span>
    <span class="c1">#     _, out, err = self.sut.execute_shell_cmd(&#39;fio --filename=/dev/sda --direct=1 --iodepth=1 --rw=randrw --rwmixread=70 --ioengine=libaio --bs=4k --size=300G --numjobs=50 --runtime=300 --group_reporting --name=randrw70read4k &gt; /root/fio.log&#39;,</span>
    <span class="c1">#         timeout=300)</span>
    <span class="c1">#     self.__check_error(err)</span>
    <span class="c1">#     self.sut.download_to_local(remotepath=&#39;/root/fio.log&#39;, localpath=os.path.join(LOG_PATH, &#39;Logs&#39;))</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;rm -rf fio.log&#39;, timeout=60, cwd=&#39;/root/&#39;)</span>

<div class="viewcode-block" id="Accelerator.fio_stress"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.fio_stress">[docs]</a>    <span class="k">def</span> <span class="nf">fio_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run fio stress overnight</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run fio stress overnight</span>
<span class="sd">                        fio_stress()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;yum install -y fio&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">hdd_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__grep_linux_fio_hdd</span><span class="p">()</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;fio --filename=/dev/</span><span class="si">{</span><span class="n">hdd_info</span><span class="si">}</span><span class="s1"> --direct=1 --iodepth=1 --rw=randrw --rwmixread=70 --ioengine=libaio --bs=4k --size=300G --numjobs=50 --runtime=300 --group_reporting --name=randrw70read4k &gt; fio.log&#39;</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">download_to_local</span><span class="p">(</span><span class="n">remotepath</span><span class="o">=</span><span class="s1">&#39;/root/fio.log&#39;</span><span class="p">,</span> <span class="n">localpath</span><span class="o">=</span><span class="n">LOG_PATH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;/root/rm -rf fio.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.get_cpu_num"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.get_cpu_num">[docs]</a>    <span class="k">def</span> <span class="nf">get_cpu_num</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Get current SUT CPU numbers</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  Yes: return cpu numbers</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Get current SUT CPU numbers</span>
<span class="sd">                        get_cpu_num()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;lscpu&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
            <span class="n">word_list</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">word_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Socket(s):&#39;</span><span class="p">:</span>
                <span class="n">cpu_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">word_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">cpu_num</span></div>

<div class="viewcode-block" id="Accelerator.get_dev_id"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.get_dev_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_dev_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">pf</span><span class="p">,</span> <span class="n">vf</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Get single QAT device id</span>
<span class="sd">              Args:</span>
<span class="sd">                  ip: Which device need to check the device status, eg: &#39;qat&#39;,&#39;dlb&#39;,&#39;dsa&#39;</span>
<span class="sd">                  pf: which device pf need to search, input number of the device</span>
<span class="sd">                        eg: 0,1...8,begin from 0</span>
<span class="sd">                  vf_num: which device vf number need to search</span>
<span class="sd">                        eg:1,2....16,begin from 1</span>
<span class="sd">              Returns:</span>
<span class="sd">                  Yes: device id  --&gt; &#39;0000:6d:00.0&#39;</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Get single QAT device id</span>
<span class="sd">                        get_qat_dev_id(&#39;qat&#39;, 0, 0)</span>
<span class="sd">                        return --&gt; &#39;0000:6d:00.0&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cpu_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_num</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">ip</span> <span class="o">==</span> <span class="s1">&#39;qat&#39;</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lspci | grep </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">qat_device_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
                <span class="n">str_list</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="n">word_list</span> <span class="o">=</span> <span class="n">str_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>  <span class="c1"># [&#39;6b&#39;,&#39;00.0&#39;]</span>
                <span class="n">qat_device_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">pf</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">qat_device_list</span><span class="p">)</span> <span class="ow">or</span> <span class="n">vf</span> <span class="o">&gt;</span> <span class="mi">16</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;the number of given PF exceeds the maximum PF get number&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;the number of given PF exceeds the maximum PF get number&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">quotient</span><span class="p">,</span> <span class="n">remainder</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">vf</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
                <span class="n">dev_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;0000:</span><span class="si">{</span><span class="n">qat_device_list</span><span class="p">[</span><span class="n">pf</span><span class="p">]</span><span class="si">}</span><span class="s1">:0</span><span class="si">{</span><span class="n">quotient</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">remainder</span><span class="si">}</span><span class="s1">&#39;</span>  <span class="c1"># [&#39; 0000:6b:00.0&#39;] or  [&#39; 0000:6b:00.03&#39;]</span>
                <span class="k">return</span> <span class="n">dev_id</span>
        <span class="k">elif</span> <span class="n">ip</span> <span class="o">==</span> <span class="s1">&#39;dsa&#39;</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lspci | grep </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dsa_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">device_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cpu_num</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsa_device_num</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
                    <span class="n">str_list</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>  <span class="c1"># [&#39;6a:01.0&#39;, &#39;System&#39;... ]</span>
                    <span class="n">dev_id</span> <span class="o">=</span> <span class="s1">&#39;0000:&#39;</span> <span class="o">+</span> <span class="n">str_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>   <span class="c1"># &#39;0000:6a:01.0&#39;</span>
                    <span class="n">device_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dev_id</span><span class="p">)</span>   <span class="c1"># [&#39;0000:6a:01.0&#39;,&#39;0000:6f:01.0&#39;]</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">device_list</span><span class="p">[</span><span class="n">pf</span><span class="p">]</span>   <span class="c1"># &#39;0000:6a:01.0&#39;</span></div>

<div class="viewcode-block" id="Accelerator.get_dlb_dev_id_list"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.get_dlb_dev_id_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_dlb_dev_id_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pf</span><span class="p">,</span> <span class="n">vf_num</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Get list of DLB device ID</span>
<span class="sd">              Args:</span>
<span class="sd">                  pf: DLB PF device number</span>
<span class="sd">                  vf: How many DLB VF device need to create</span>
<span class="sd">              Returns:</span>
<span class="sd">                  Yes: DLB device ID list --&gt; [&#39;0000:6d:00.0&#39;,&#39;0000:72:00.0&#39;]</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: get DLB True device 0 and create 2 DLB Vietual device for Platform</span>
<span class="sd">                        get_dlb_dev_id_list(0, 2)</span>
<span class="sd">                        return [&#39;0000:6d:00.1&#39;,&#39;0000:6d:00.2&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lspci | grep </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dlb_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">dlb_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dev_id_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
            <span class="n">str_list</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>  <span class="c1"># [&#39;6d:00.0&#39;, &#39;Co-processor:&#39;...]</span>
            <span class="n">words_list</span> <span class="o">=</span> <span class="n">str_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>  <span class="c1"># [&#39;6d:00&#39;, &#39;0&#39; , ....]</span>
            <span class="k">if</span> <span class="n">words_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
                <span class="n">dlb_deviceid</span> <span class="o">=</span> <span class="s1">&#39;0000:&#39;</span> <span class="o">+</span> <span class="n">str_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># &#39;0000:6d:00.0&#39;&#39;0000:72:00.0&#39;</span>
                <span class="n">dlb_deviceid</span> <span class="o">=</span> <span class="n">dlb_deviceid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="n">dlb_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dlb_deviceid</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># [&#39;0000:6d:00.0&#39;,&#39;0000:72:00.0&#39;]</span>
        <span class="n">quotient</span><span class="p">,</span> <span class="n">remainder</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">vf_num</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vf_num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dev_id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;0000:</span><span class="si">{</span><span class="n">dlb_list</span><span class="p">[</span><span class="n">pf</span><span class="p">]</span><span class="si">}</span><span class="s1">:0</span><span class="si">{</span><span class="n">quotient</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">remainder</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>   <span class="c1"># [&#39;0000:6d:00.0&#39;,&#39;0000:72:00.0&#39;]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">vf_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="n">dev_id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;0000:</span><span class="si">{</span><span class="n">dlb_list</span><span class="p">[</span><span class="n">pf</span><span class="p">]</span><span class="si">}</span><span class="s1">:00.</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="mi">7</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">:</span>
                    <span class="n">dev_id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;0000:</span><span class="si">{</span><span class="n">dlb_list</span><span class="p">[</span><span class="n">pf</span><span class="p">]</span><span class="si">}</span><span class="s1">:01.</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">8</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dev_id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;0000:</span><span class="si">{</span><span class="n">dlb_list</span><span class="p">[</span><span class="n">pf</span><span class="p">]</span><span class="si">}</span><span class="s1">:0</span><span class="si">{</span><span class="n">quotient</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">remainder</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># [&#39;0000:6d:00.1&#39;,&#39;0000:6d:00.2&#39;]</span>
        <span class="k">return</span> <span class="n">dev_id_list</span>  <span class="c1"># [&#39;0000:6d:00.0&#39;,&#39;0000:72:00.0&#39;]</span></div>


<div class="viewcode-block" id="Accelerator.get_mdev_xml_content"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.get_mdev_xml_content">[docs]</a>    <span class="k">def</span> <span class="nf">get_mdev_xml_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mdev_uuid</span><span class="p">):</span>
        <span class="n">content</span> <span class="o">=</span> <span class="s1">&#39;&lt;hostdev mode=&quot;subsystem&quot; type=&quot;mdev&quot; managed=&quot;no&quot; model=&quot;vfio-pci&quot; display=&quot;off&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">content</span> <span class="o">+=</span> <span class="s1">&#39;    &lt;source&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;        &lt;address uuid=&quot;</span><span class="si">{</span><span class="n">mdev_uuid</span><span class="si">}</span><span class="s1">&quot;/&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">content</span> <span class="o">+=</span> <span class="s1">&#39;    &lt;/source&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">content</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/hostdev&gt;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">content</span></div>


<div class="viewcode-block" id="Accelerator.get_qat_dev_id_list"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.get_qat_dev_id_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_qat_dev_id_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pf</span><span class="p">,</span> <span class="n">vf_num</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Get list of QAT device ID</span>
<span class="sd">              Args:</span>
<span class="sd">                  pf: which QAT pf need to search, input number of the device</span>
<span class="sd">                        eg: 0,1...8,begin from 0</span>
<span class="sd">                  vf_num: which QAT vf number need to search</span>
<span class="sd">                        eg:1,2....16,begin from 1</span>
<span class="sd">              Returns:</span>
<span class="sd">                  Yes: QAT device id list</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Check all QAT device</span>
<span class="sd">                        get_qat_dev_id_list(0, 2)</span>
<span class="sd">                        return --&gt; [&#39;0000:6b:00.1&#39;, &#39;0000:6b:00.2&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dev_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">vf_num</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">dev_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dev_id</span><span class="p">(</span><span class="s1">&#39;qat&#39;</span><span class="p">,</span> <span class="n">pf</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">dev_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dev_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dev_list</span></div>


<div class="viewcode-block" id="Accelerator.get_ifwi_version"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.get_ifwi_version">[docs]</a>    <span class="k">def</span> <span class="nf">get_ifwi_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;dmidecode -t 0 |grep -i &quot;version&quot;&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">ifwi_ver</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">line_list</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">line_list</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">ifwi_ver</span></div>

<div class="viewcode-block" id="Accelerator.init_bashrc"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.init_bashrc">[docs]</a>    <span class="k">def</span> <span class="nf">init_bashrc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Clear /root/.bashrc environment</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Clear /root/.bashrc environment</span>
<span class="sd">                      init_bashrc()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf /root/.bashrc&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">BASHRC_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">BASHRC_PATH_L</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.install_socwatch"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.install_socwatch">[docs]</a>    <span class="k">def</span> <span class="nf">install_socwatch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                 Purpose: Install socwatch tool</span>
<span class="sd">                 Args:</span>
<span class="sd">                     No</span>
<span class="sd">                 Returns:</span>
<span class="sd">                     No</span>
<span class="sd">                 Raises:</span>
<span class="sd">                     RuntimeError: If any errors</span>
<span class="sd">                 Example:</span>
<span class="sd">                     Simplest usage: Install socwatch tool</span>
<span class="sd">                         install_socwatch()</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">SOCWATCH_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">SOCWATCH_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">SOCWATCH_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;tar -zxvf *.tar.gz&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">SOCWATCH_PATH_L</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;sh ./build_drivers.sh&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SOCWATCH_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
        <span class="c1"># self.__check_error(err)</span>
        <span class="n">res</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;insmod drivers/socwatch2_14.ko | wc -l&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SOCWATCH_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">out</span> <span class="o">!=</span> <span class="s1">&#39;0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;insmod socwatch.ko fail&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;insmod socwatch.ko fail&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;source ./setup_socwatch_env.sh&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SOCWATCH_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;SOCWATCH_BASE_DIR&#39;</span><span class="p">,</span> <span class="s1">&#39;SOCPERF_BASE_DIR&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;config environment fail&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.install_accel_config_rich_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.install_accel_config_rich_vm">[docs]</a>    <span class="k">def</span> <span class="nf">install_accel_config_rich_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">install_accel_config_deps_rich_vm</span><span class="p">(</span><span class="n">qemu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upload_dsa_tools_rich_vm</span><span class="p">(</span><span class="n">qemu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_header_devel_rich_vm</span><span class="p">(</span><span class="n">qemu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_header_internal_devel_rich_vm</span><span class="p">(</span><span class="n">qemu</span><span class="p">)</span>
        <span class="n">exec_res</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;accel-config --version&#39;</span><span class="p">)</span>
        <span class="n">accel_config_install</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">vm</span> <span class="ow">in</span> <span class="n">exec_res</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">exec_res</span><span class="p">[</span><span class="n">vm</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">line_list</span> <span class="o">=</span> <span class="n">err</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;command not found&#39;</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">accel_config_install</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">accel_config_install</span><span class="p">:</span>
            <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;unzip *.zip&#39;</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;./autogen.sh&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
            <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span>
                <span class="s2">&quot;./configure CFLAGS=&#39;-g -O2&#39; --prefix=/usr --sysconfdir=/etc --libdir=/usr/lib64 --enable-test=yes&quot;</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
            <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">20</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
            <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;make install&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">20</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Accelerator.install_accel_config_deps_rich_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.install_accel_config_deps_rich_vm">[docs]</a>    <span class="k">def</span> <span class="nf">install_accel_config_deps_rich_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">):</span>
        <span class="n">exec_res</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;yum groupinstall -y </span><span class="se">\&#39;</span><span class="s2">Development Tools</span><span class="se">\&#39;</span><span class="s2"> --allowerasing&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">vm</span> <span class="ow">in</span> <span class="n">exec_res</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">exec_res</span><span class="p">[</span><span class="n">vm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Case</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s1">&#39;yum install Development Tools pass&#39;</span><span class="p">,</span> <span class="n">res</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">exec_res1</span> <span class="o">=</span><span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;yum install -y autoconf automake libtool pkgconf rpm-build rpmdevtools&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">vm</span> <span class="ow">in</span> <span class="n">exec_res1</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">exec_res1</span><span class="p">[</span><span class="n">vm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Case</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s1">&#39;yum install Development Tools pass&#39;</span><span class="p">,</span> <span class="n">res</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">exec_res2</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;yum install -y asciidoc xmlto libuuid-devel json-c-devel kmod-devel libudev-devel&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">vm</span> <span class="ow">in</span> <span class="n">exec_res2</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">exec_res2</span><span class="p">[</span><span class="n">vm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Case</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s1">&#39;yum install Development Tools pass&#39;</span><span class="p">,</span> <span class="n">res</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.kernel_header_devel"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.kernel_header_devel">[docs]</a>    <span class="k">def</span> <span class="nf">kernel_header_devel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Install kernel-header and kernel-devel package</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Install kernel-header and kernel-devel package</span>
<span class="sd">                      kernel_header_devel()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">KERNEL_HEADER_PATH_L</span><span class="p">)</span>
        <span class="c1"># self.sut.upload_to_remote(localpath=KERNEL_HEADER_H, remotepath=KERNEL_HEADER_PATH_L)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">KERNEL_DEVEL_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">KERNEL_DEVEL_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rpm -ivh *.rpm --force --nodeps&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">KERNEL_DEVEL_PATH_L</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.linpack_stress"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.linpack_stress">[docs]</a>    <span class="k">def</span> <span class="nf">linpack_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run linpack stress overnight</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run linpack stress overnight</span>
<span class="sd">                        linpack_stress()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;yum -y install docker&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">LINPACK_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">LINPACK_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">LINPACK_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;unzip *.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">LINPACK_PATH_L</span><span class="p">)</span>
        <span class="c1"># self.add_environment_to_file(&#39;end&#39;, &#39;end=$((SECONDS+300))&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;while [ $SECONDS -lt 300 ]; do /home/BKCPkg/domains/accelerator/linpack/pnpwls-master/linpack/run_linpack.sh avx3 ; done | tee /root/linpack.log&#39;</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mi">50000</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;cat /root/linpack.log&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">(</span><span class="s2">&quot;1 tests completed and passed residual checks&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Run Linpark stress fail&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">download_to_local</span><span class="p">(</span><span class="n">remotepath</span><span class="o">=</span><span class="s1">&#39;/root/linpack.log&#39;</span><span class="p">,</span> <span class="n">localpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LOG_PATH</span><span class="p">,</span> <span class="s1">&#39;Logs&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf linpack.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_environment</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.mlc_stress"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.mlc_stress">[docs]</a>    <span class="k">def</span> <span class="nf">mlc_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run mlc stress overnight</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run mlc stress overnight</span>
<span class="sd">                        mlc_stress()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">MLC_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">MLC_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">MLC_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;tar -zxvf *.tgz&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">MLC_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;chmod 777 *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MLC_PATH_L</span><span class="si">}</span><span class="s1">Linux/&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;./mlc --loaded_latency -t5 -X -D8192 &gt; mlc.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MLC_PATH_L</span><span class="si">}</span><span class="s1">Linux/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">download_to_local</span><span class="p">(</span><span class="n">remotepath</span><span class="o">=</span><span class="s1">&#39;/home/BKCPkg/domains/accelerator/mlc/Linux/mlc.log&#39;</span><span class="p">,</span> <span class="n">localpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LOG_PATH</span><span class="p">,</span> <span class="s1">&#39;Logs&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="Accelerator.modify_qat_config_file"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.modify_qat_config_file">[docs]</a>    <span class="k">def</span> <span class="nf">modify_qat_config_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Modify QAT config files</span>
<span class="sd">              Args:</span>
<span class="sd">                  config_key : Which function (asym, mdev, shim) config files need to modify</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Modify QAT asymmetric encrypted config files</span>
<span class="sd">                        modify_qat_config_file(&#39;asym&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">config_key</span> <span class="o">==</span> <span class="s1">&#39;mdev&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__qat_mdev_config</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">config_key</span> <span class="o">==</span> <span class="s1">&#39;sym&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__qat_sym_config</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">config_key</span> <span class="o">==</span> <span class="s1">&#39;asym&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__qat_asym_config</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">config_key</span> <span class="o">==</span> <span class="s1">&#39;shim&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__qat_shim_config</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Input correct config keyword&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Input correct config keyword&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.modify_kernel_grub"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.modify_kernel_grub">[docs]</a>    <span class="k">def</span> <span class="nf">modify_kernel_grub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vm_function</span><span class="p">,</span> <span class="n">add_or_remove</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Modify kernel grub file</span>
<span class="sd">              Args:</span>
<span class="sd">                  vm_function: What config need to add/remove to grub file</span>
<span class="sd">                  add_or_remove: Is add or remove config file</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Add &#39;intel_iommu=on,sm_on iommu=on no5lvl&#39; function to kernel grub file</span>
<span class="sd">                      modify_kernel_grub(&#39;intel_iommu=on,sm_on iommu=on no5lvl&#39;, True)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;uname -r&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_or_remove</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;grubby --update-kernel=/boot/vmlinuz-</span><span class="si">{</span><span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s1"> --args=&quot;</span><span class="si">{</span><span class="n">vm_function</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="c1"># self.sut.execute_shell_cmd(&#39;reboot&#39;, timeout=30 * 60)</span>
            <span class="c1"># self.Case.sleep(60)</span>
            <span class="c1"># self.Case.wait_and_expect(f&#39;SUT in OS&#39;, 30 * 60, self.sut.check_system_in_os)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">my_os</span><span class="o">.</span><span class="n">warm_reset_cycle_step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Case</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;cat /proc/cmdline&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">vm_function</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;modify kernel file fail&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;modify kernel file fail&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;grubby --update-kernel=/boot/vmlinuz-</span><span class="si">{</span><span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s1"> --remove-args=&quot;</span><span class="si">{</span><span class="n">vm_function</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="c1"># self.sut.execute_shell_cmd(&#39;reboot&#39;, timeout=30*60)</span>
            <span class="c1"># self.Case.sleep(60)</span>
            <span class="c1"># self.Case.wait_and_expect(f&#39;SUT in OS&#39;, 30*60, self.sut.check_system_in_os)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">my_os</span><span class="o">.</span><span class="n">warm_reset_cycle_step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Case</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;cat /proc/cmdline&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">vm_function</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;modify kernel file fail&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;modify kernel file fail&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.modify_kernel_grub_rich_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.modify_kernel_grub_rich_vm">[docs]</a>    <span class="k">def</span> <span class="nf">modify_kernel_grub_rich_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">,</span> <span class="n">vm_function</span><span class="p">,</span> <span class="n">add_or_remove</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Modify kernel grub file</span>
<span class="sd">              Args:</span>
<span class="sd">                  qemu: Call VM Class RichHypervisor</span>
<span class="sd">                  vm_function: What config need to add/remove to grub file</span>
<span class="sd">                  add_or_remove: Is add or remove config file</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Add &#39;intel_iommu=on,sm_on iommu=on no5lvl&#39; function to kernel grub file in VM</span>
<span class="sd">                      modify_kernel_grub_rich_vm(qemu,&#39;intel_iommu=on,sm_on iommu=on no5lvl&#39;, True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">exec_res</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;uname -r&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">out</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">vm</span> <span class="ow">in</span> <span class="n">exec_res</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">exec_res</span><span class="p">[</span><span class="n">vm</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">if</span> <span class="n">add_or_remove</span><span class="p">:</span>
            <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;grubby --update-kernel=/boot/vmlinuz-</span><span class="si">{</span><span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2"> --args=&#39;</span><span class="si">{</span><span class="n">vm_function</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                                <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;reboot&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Case</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">exec_res</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;cat /proc/cmdline&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">vm</span> <span class="ow">in</span> <span class="n">exec_res</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">exec_res</span><span class="p">[</span><span class="n">vm</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">vm_function</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;modify kernel file fail&#39;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;modify kernel file fail&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;grubby --update-kernel=/boot/vmlinuz-</span><span class="si">{</span><span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2"> --remove-args=&#39;</span><span class="si">{</span><span class="n">vm_function</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;reboot&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Case</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">exec_res</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;cat /proc/cmdline&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">vm</span> <span class="ow">in</span> <span class="n">exec_res</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">exec_res</span><span class="p">[</span><span class="n">vm</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">vm_function</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;modify kernel file fail&#39;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;modify kernel file fail&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Accelerator.openssl_asymmetric"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.openssl_asymmetric">[docs]</a>    <span class="k">def</span> <span class="nf">openssl_asymmetric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run openssl asymmetric</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run openssl asymmetric</span>
<span class="sd">                      openssl_asymmetric()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;openssl engine -t -c -v qatengine&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_ENGINE_PATH_L</span><span class="si">}</span><span class="s1">QAT_Engine-master/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;available&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;run openssl engine fail&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__qat_asym_config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_qat_service_status</span><span class="p">()</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;openssl speed -engine qatengine -elapsed -async_jobs 72 rsa2048&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_ENGINE_PATH_L</span><span class="si">}</span><span class="s1">QAT_Engine-master/&#39;</span><span class="p">)</span>
        <span class="c1"># self.__check_error(err)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;dos2unix QAT_Linux_OpenSSL_Speed_Test_Script_Asymmetric.sh&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_ASYM_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;chmod 777 *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_ASYM_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;./QAT_Linux_OpenSSL_Speed_Test_Script_Asymmetric.sh&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_ASYM_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>
        <span class="c1"># self.__check_error(err)</span>

<div class="viewcode-block" id="Accelerator.openssl_install"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.openssl_install">[docs]</a>    <span class="k">def</span> <span class="nf">openssl_install</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Install openssl file</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Install openssl file</span>
<span class="sd">                        openssl_install()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;yum -y install perl-core&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">OPENSSL_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">OPENSSL_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">OPENSSL_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;unzip *.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">OPENSSL_PATH_L</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;find </span><span class="si">{</span><span class="n">OPENSSL_PATH_L</span><span class="si">}</span><span class="s1"> -name &quot;config&quot;&#39;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mv </span><span class="si">{</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">OPENSSL_PATH_L</span><span class="si">}</span><span class="s1">openssl-master/&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="c1"># self.sut.execute_shell_cmd(&#39;mv openssl*/ openssl-master/&#39;, timeout=60, cwd=OPENSSL_PATH_L)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;chmod 777 *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">OPENSSL_PATH_L</span><span class="si">}</span><span class="s1">openssl-master/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;./config --prefix=/usr/local/ssl&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">OPENSSL_PATH_L</span><span class="si">}</span><span class="s1">openssl-master/&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">OPENSSL_PATH_L</span><span class="si">}</span><span class="s1">openssl-master/&#39;</span><span class="p">)</span>
        <span class="c1"># self.__check_error(err)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;openssl make fail&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make test&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">OPENSSL_PATH_L</span><span class="si">}</span><span class="s1">openssl-master/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;Result: PASS&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Openssl test fail&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make install&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">OPENSSL_PATH_L</span><span class="si">}</span><span class="s1">openssl-master/&#39;</span><span class="p">)</span>
        <span class="c1"># self.__check_error(err)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file</span><span class="p">(</span><span class="s1">&#39;PERL5LIB&#39;</span><span class="p">,</span> <span class="s1">&#39;export PERL5LIB=$PERL5LIB:/home/BKCPkg/domains/accelerator/openssl/openssl-master&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file</span><span class="p">(</span><span class="s1">&#39;OPENSSL_ENGINES&#39;</span><span class="p">,</span> <span class="s1">&#39;export OPENSSL_ENGINES=/usr/lib64/engines-1.1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file</span><span class="p">(</span><span class="s1">&#39;LD_LIBRARY_PATH&#39;</span><span class="p">,</span> <span class="s1">&#39;export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/lib&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.openssl_symmetric"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.openssl_symmetric">[docs]</a>    <span class="k">def</span> <span class="nf">openssl_symmetric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run openssl symmetric</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run openssl symmetric</span>
<span class="sd">                      openssl_symmetric()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;openssl engine -t -c -v qatengine&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_ENGINE_PATH_L</span><span class="si">}</span><span class="s1">QAT_Engine-master/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;available&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;run openssl engine fail&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;dos2unix QAT_Linux_OpenSSL_Speed_Test_Script_Symmetric.sh&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_SYM_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;chmod 777 *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_SYM_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;./QAT_Linux_OpenSSL_Speed_Test_Script_Symmetric.sh&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_SYM_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>
        <span class="c1"># self.__check_error(err)</span>

<div class="viewcode-block" id="Accelerator.prime95_stress"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.prime95_stress">[docs]</a>    <span class="k">def</span> <span class="nf">prime95_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run prime95 stress overnight</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run prime95 stress overnight</span>
<span class="sd">                      prime95_stress()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">PRIME95_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">PRIME95_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">PRIME95_PATH_L</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;tar -zxvf *.tar.gz&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">PRIME95_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">PPEXPECT_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">PPEXPECT_prime95_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">PRIME95_SCRIPT_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">PRIME95_SCRIPT_PATH_L</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;python3 prime95.py run_prime95&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">7200</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">PRIME95_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">download_to_local</span><span class="p">(</span><span class="n">remotepath</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">PRIME95_PATH_L</span><span class="si">}</span><span class="s1">primeprime.log&#39;</span><span class="p">,</span> <span class="n">localpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LOG_PATH</span><span class="p">,</span> <span class="s1">&#39;Logs&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">download_to_local</span><span class="p">(</span><span class="n">remotepath</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">PRIME95_PATH_L</span><span class="si">}</span><span class="s1">prime95.log&#39;</span><span class="p">,</span> <span class="n">localpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LOG_PATH</span><span class="p">,</span> <span class="s1">&#39;Logs&#39;</span><span class="p">))</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cat </span><span class="si">{</span><span class="n">PRIME95_PATH_L</span><span class="si">}</span><span class="s1">primeprime.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cat </span><span class="si">{</span><span class="n">PRIME95_PATH_L</span><span class="si">}</span><span class="s1">prime95.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.ptu_stress"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.ptu_stress">[docs]</a>    <span class="k">def</span> <span class="nf">ptu_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run ptu stress overnight</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run ptu stress overnight</span>
<span class="sd">                        ptu_stress()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">PTU_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">PTU_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">PTU_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;unzip *.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">PTU_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;chmod 777 *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">PTU_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;./ptu -ct 8 &gt; ptu.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">PTU_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">download_to_local</span><span class="p">(</span><span class="s1">&#39;/home/BKCPkg/domains/accelerator/ptu/ptu.log&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LOG_PATH</span><span class="p">,</span> <span class="s1">&#39;Logs&#39;</span><span class="p">))</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;cat ptu.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">PTU_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Run ptu stress fail&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Run ptu stress fail&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.qat_engine_install"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.qat_engine_install">[docs]</a>    <span class="k">def</span> <span class="nf">qat_engine_install</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Install QAT Engine file</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Install QAT Engine file</span>
<span class="sd">                        qat_engine_install()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_ENGINE_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">QAT_ENGINE_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">QAT_ENGINE_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;unzip *.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_ENGINE_PATH_L</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;find </span><span class="si">{</span><span class="n">QAT_ENGINE_PATH_L</span><span class="si">}</span><span class="s1"> -name &quot;autogen.sh&quot;&#39;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mv </span><span class="si">{</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">QAT_ENGINE_PATH_L</span><span class="si">}</span><span class="s1">QAT_Engine-master/&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;chmod 777 *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_ENGINE_PATH_L</span><span class="si">}</span><span class="s1">QAT_Engine-master/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;dos2unix *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_ENGINE_PATH_L</span><span class="si">}</span><span class="s1">QAT_Engine-master/&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;./autogen.sh&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_ENGINE_PATH_L</span><span class="si">}</span><span class="s1">QAT_Engine-master/&#39;</span><span class="p">)</span>
        <span class="c1"># self.__check_error(err)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;./configure  --with-qat_hw_dir=/home/BKCPkg/domains/accelerator/QAT&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_ENGINE_PATH_L</span><span class="si">}</span><span class="s1">QAT_Engine-master/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;sed -i &quot;s/cpa_dc.h/dc\/cpa_dc.h/g&quot; /home/BKCPkg/domains/accelerator/QAT/quickassist/lookaside/access_layer/include/icp_sal_user.h&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make install&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_ENGINE_PATH_L</span><span class="si">}</span><span class="s1">QAT_Engine-master/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.qat_engine_uninstall"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.qat_engine_uninstall">[docs]</a>    <span class="k">def</span> <span class="nf">qat_engine_uninstall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Uninstall QAT Engine</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Uninstall QAT Engine file</span>
<span class="sd">                        qat_engine_uninstall()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make uninstall&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_ENGINE_PATH_L</span><span class="si">}</span><span class="s1">QAT_Engine-master/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make clean&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_ENGINE_PATH_L</span><span class="si">}</span><span class="s1">QAT_Engine-master/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make distclean&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_ENGINE_PATH_L</span><span class="si">}</span><span class="s1">QAT_Engine-master/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.qat_install"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.qat_install">[docs]</a>    <span class="k">def</span> <span class="nf">qat_install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_siov</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: To install QAT driver</span>
<span class="sd">              Args:</span>
<span class="sd">                  is_siov: Install qat driver with siov or not</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Install QAT driver</span>
<span class="sd">                      qat_install(False)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">QAT_DRIVER_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;unzip *.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;tar -zxvf *.tar.gz&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_siov</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;./configure --enable-icp-sriov=host&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;./configure&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make install&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="c1"># self.__check_error(err)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make samples-install&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="c1"># self.__check_error(err)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;service qat_service status&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;Unit qat_service.service could not be found&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Issue - QAT driver install failed&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Issue - QAT driver install failed&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.qat_service_restart"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.qat_service_restart">[docs]</a>    <span class="k">def</span> <span class="nf">qat_service_restart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Check QAT restart status</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: run qat_service restart</span>
<span class="sd">                        qat_service_restart()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__qat_service_restart</span><span class="p">()</span>
        <span class="c1"># Different versions of QAT have differing output signatures. Code below permits both versions.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;Restarting all devices&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;QAT service status down&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;Stopping all devices&#39;</span><span class="p">,</span> <span class="s1">&#39;Starting all devices&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;QAT service status down&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.qat_service_status"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.qat_service_status">[docs]</a>    <span class="k">def</span> <span class="nf">qat_service_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run QAT service status</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  QAT service status result</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: run qat_service status</span>
<span class="sd">                        qat_service_status()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;service qat_service status&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;Unit qat_service.service could not be found&quot;</span> <span class="ow">in</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;qat_service status&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="Accelerator.qat_service_stop_start"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.qat_service_stop_start">[docs]</a>    <span class="k">def</span> <span class="nf">qat_service_stop_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">             Purpose: Check QAT service stop and QAT service start function</span>
<span class="sd">             Args:</span>
<span class="sd">                 No</span>
<span class="sd">             Returns:</span>
<span class="sd">                 No</span>
<span class="sd">             Raises:</span>
<span class="sd">                 RuntimeError: If any errors</span>
<span class="sd">             Example:</span>
<span class="sd">                 Simplest usage: run qat_service stop and qat_service start</span>
<span class="sd">                       qat_service_stop_start()</span>
<span class="sd">       &quot;&quot;&quot;</span>
        <span class="n">cpu_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_num</span><span class="p">()</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;service qat_service stop&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">dev_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Stopping device qat_dev&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">dev_num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">dev_num</span> <span class="o">!=</span> <span class="n">cpu_num</span> <span class="o">*</span> <span class="mi">16</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">qat_device_num</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Not all QAT vf stopped&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not all QAT vf stopped&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;service qat_service start&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">dev_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;state: up&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">dev_num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">dev_num</span> <span class="o">!=</span> <span class="n">cpu_num</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">qat_device_num</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Not all QAT pf status show up&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not all QAT pf status show up&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.qat_stress"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.qat_stress">[docs]</a>    <span class="k">def</span> <span class="nf">qat_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run QAT stress overnight</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run QAT stress overnight</span>
<span class="sd">                        qat_stress()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># self.add_environment_to_file(&#39;end&#39;, &#39;end=$((SECONDS+300))&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;while [ $SECONDS -lt 300 ]; do /home/BKCPkg/domains/accelerator/QAT/build/cpa_sample_code runTests=63 signOfLife=1 | tee /root/qat.log; done &#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">50000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">download_to_local</span><span class="p">(</span><span class="n">remotepath</span><span class="o">=</span><span class="s1">&#39;/root/qat.log&#39;</span><span class="p">,</span> <span class="n">localpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LOG_PATH</span><span class="p">,</span> <span class="s1">&#39;Logs&#39;</span><span class="p">))</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;cat /root/qat.log&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s2">&quot;Sample code completed successfully&quot;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Run qat stress fail&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf qat.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_environment</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.qat_stv_mega_test"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.qat_stv_mega_test">[docs]</a>    <span class="k">def</span> <span class="nf">qat_stv_mega_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run QAT mega test</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run QAT mega test</span>
<span class="sd">                      qat_stv_mega_test()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">SAMPLE_CODE_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;tar -zxvf *.tar.gz&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;dnf -y install git&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;git clone https://github.com/smuellerDD/libkcapi.git&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;autoreconf -i&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="si">}</span><span class="s1">\libkcapi&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;./configure --prefix=/usr/ --enable-kcapi-test&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="si">}</span><span class="s1">\libkcapi&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="si">}</span><span class="s1">\libkcapi&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make install&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="si">}</span><span class="s1">\libkcapi&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;./build.sh&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">MEGA_CONF_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">MEGA_CONF_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">MEGA_CONF_PATH_L</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">__copy_mega_to_config</span><span class="p">():</span>
            <span class="n">cpu_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_num</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cpu_num</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_device_num</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cp /home/BKCPkg/domains/accelerator/mega_conf/mega.conf /etc/4xxx_dev</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.conf&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">__copy_mega_to_config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;./build/adf_ctl restart&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">PPEXPECT_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">PPEXPECT_MEGA_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">MEGA_SCRIPT_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">MEGA_SCRIPT_PATH_L</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;python3 mega_script.py run_testcli&#39;</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">MEGA_SCRIPT_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">download_to_local</span><span class="p">(</span><span class="n">remotepath</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MEGA_SCRIPT_PATH_L</span><span class="si">}</span><span class="s1">mega.log&#39;</span><span class="p">,</span> <span class="n">localpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LOG_PATH</span><span class="p">,</span> <span class="s1">&#39;Logs&#39;</span><span class="p">))</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cat </span><span class="si">{</span><span class="n">MEGA_SCRIPT_PATH_L</span><span class="si">}</span><span class="s1">mega.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">mega_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">tms_pass_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">mega_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;TMS PASSED&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">tms_pass_num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">tms_pass_num</span> <span class="o">!=</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">err</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.qat_vm_mega_install"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.qat_vm_mega_install">[docs]</a>    <span class="k">def</span> <span class="nf">qat_vm_mega_install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run QAT mega test on guest</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run QAT mega test</span>
<span class="sd">                      qat_vm_mega_install()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;pip3 install pexpect&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;yum install -y epel-release readline-devel  lz4-devel python3 xxhash-devel&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">SAMPLE_CODE_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;mkdir -p </span><span class="si">{</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;rm -rf </span><span class="si">{</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="si">}</span><span class="s1">*&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">sut_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="si">}{</span><span class="n">SAMPLE_CODE_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">vm_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="si">}{</span><span class="n">SAMPLE_CODE_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">upload_to_vm</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="n">sut_file_dir</span><span class="p">,</span> <span class="n">vm_file_dir</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;tar -zxf *.tar.gz&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;./build.sh&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">PPEXPECT_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">PPEXPECT_MEGA_PATH_L</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;mkdir -p </span><span class="si">{</span><span class="n">PPEXPECT_MEGA_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;rm -rf </span><span class="si">{</span><span class="n">PPEXPECT_MEGA_PATH_L</span><span class="si">}</span><span class="s1">*&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">sut_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">PPEXPECT_MEGA_PATH_L</span><span class="si">}{</span><span class="n">PPEXPECT_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">vm_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">PPEXPECT_MEGA_PATH_L</span><span class="si">}{</span><span class="n">PPEXPECT_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">upload_to_vm</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="n">sut_file_dir</span><span class="p">,</span> <span class="n">vm_file_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">MEGA_SCRIPT_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">MEGA_SCRIPT_PATH_L</span><span class="p">)</span>
        <span class="n">sut_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MEGA_SCRIPT_PATH_L</span><span class="si">}{</span><span class="n">MEGA_SCRIPT_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">vm_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MEGA_SCRIPT_PATH_L</span><span class="si">}{</span><span class="n">MEGA_SCRIPT_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">upload_to_vm</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="n">sut_file_dir</span><span class="p">,</span> <span class="n">vm_file_dir</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.qat_uninstall"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.qat_uninstall">[docs]</a>    <span class="k">def</span> <span class="nf">qat_uninstall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: To uninstall QAT driver</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Uninstall QAT driver</span>
<span class="sd">                      qat_uninstall()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#_, out, err = self.sut.execute_shell_cmd(&quot;lsmod | grep &#39;qat\|usdm&#39; | wc -l&quot;, timeout=60, cwd=QAT_DRIVER_PATH_L)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;service qat_service status&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;Unit qat_service.service could not be found&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">):</span>
        <span class="c1">#if out != &#39;&#39;:</span>
            <span class="c1">#if out != &#39;0\n&#39;:</span>
                <span class="c1"># self.sut.execute_shell_cmd(&#39;reboot&#39;, timeout=30*60)</span>
                <span class="c1"># self.Case.sleep(60)</span>
                <span class="c1"># self.Case.wait_and_expect(f&#39;SUT in OS&#39;, 30*60, self.sut.check_system_in_os)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">my_os</span><span class="o">.</span><span class="n">warm_reset_cycle_step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Case</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make uninstall&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make clean&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make distclean&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
            <span class="c1">#_, out, err = self.sut.execute_shell_cmd(&quot;lsmod | grep &#39;qat\|usdm&#39; | wc -l&quot;, timeout=60,</span>
            <span class="c1">#                                         cwd=QAT_DRIVER_PATH_L)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;service qat_service status&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;Unit qat_service.service could not be found&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;0&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Issue - QAT driver still exist&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="c1">#else:#</span>
               <span class="c1"># pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span></div>


<div class="viewcode-block" id="Accelerator.qatzip_test"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.qatzip_test">[docs]</a>    <span class="k">def</span> <span class="nf">qatzip_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1">#qatzip_script--&gt;qatzip.sh</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Install QATZIP file and test QATZIP</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Install QATZIP file and test QATZIP</span>
<span class="sd">                        qatzip_test()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QATZIP_SCRIPT_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">QATZIP_SCRIPT_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">QATZIP_SCRIPT_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QATZIP_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">QATZIP_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">QATZIP_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;[ -e *.7z ] &amp;&amp; 7z e *.7z&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QATZIP_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;unzip *.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QATZIP_PATH_L</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;find </span><span class="si">{</span><span class="n">QATZIP_PATH_L</span><span class="si">}</span><span class="s1"> -name &quot;qatzip.spec.in&quot;&#39;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mv </span><span class="si">{</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">QATZIP_PATH_L</span><span class="si">}</span><span class="s1">QATzip-master/&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="c1"># self.sut.execute_shell_cmd(&#39;mv qatzip*/qatzip*/ QATzip-master/&#39;, timeout=60, cwd=QATZIP_PATH_L)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;cp *.conf /etc&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QATZIP_PATH_L</span><span class="si">}</span><span class="s1">QATzip-master/config_file/c6xx/multiple_process_opt/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file</span><span class="p">(</span><span class="s1">&#39;ICP_ROOT&#39;</span><span class="p">,</span> <span class="s1">&#39;export ICP_ROOT=/home/BKCPkg/domains/accelerator/QAT/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file</span><span class="p">(</span><span class="s1">&#39;QATZIP_ROOT&#39;</span><span class="p">,</span> <span class="s1">&#39;export QATZIP_ROOT=/home/BKCPkg/domains/accelerator/QATzip-master/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;chmod 777 *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QATZIP_PATH_L</span><span class="si">}</span><span class="s1">QATzip-master/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;./autogen.sh&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QATZIP_PATH_L</span><span class="si">}</span><span class="s1">QATzip-master/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;./configure&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QATZIP_PATH_L</span><span class="si">}</span><span class="s1">QATzip-master/&#39;</span><span class="p">)</span>
        <span class="n">ker_ver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_version</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ker_ver</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CENTOS_INTEL_NEXT_KERNEL</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make clean&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QATZIP_PATH_L</span><span class="si">}</span><span class="s1">QATzip-master/&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make all install&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QATZIP_PATH_L</span><span class="si">}</span><span class="s1">QATzip-master/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qat_service_restart</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_qat_service_status</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;chmod 777 *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QATZIP_SCRIPT_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;dos2unix qatzip.sh&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QATZIP_SCRIPT_PATH_L</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;sh qatzip.sh&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QATZIP_SCRIPT_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;Test finished&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;QATZIP test fail&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.rpm_install"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.rpm_install">[docs]</a>    <span class="k">def</span> <span class="nf">rpm_install</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: To install rpm packages</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Install rpm packages</span>
<span class="sd">                      rpm_install()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rpm_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;openssl-devel&#39;</span><span class="p">,</span> <span class="s1">&#39;libcurl-devel&#39;</span><span class="p">,</span> <span class="s1">&#39;protobuf-devel&#39;</span><span class="p">,</span> <span class="s1">&#39;yum-utils.noarch&#39;</span><span class="p">,</span> <span class="s1">&#39;zlib-devel.x86_64&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;yasm systemd-devel&#39;</span><span class="p">,</span> <span class="s1">&#39;boost-devel.x86_64&#39;</span><span class="p">,</span> <span class="s1">&#39;libnl3-devel&#39;</span><span class="p">,</span> <span class="s1">&#39;gcc gcc-c++&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;libgudev.x86_64&#39;</span><span class="p">,</span> <span class="s1">&#39;libgudev-devel.x86_64&#39;</span><span class="p">,</span> <span class="s1">&#39;systemd*&#39;</span><span class="p">,</span> <span class="s1">&#39;boost-devel.x86_64&#39;</span><span class="p">,</span> <span class="s1">&#39;autoconf&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;automake&#39;</span><span class="p">,</span> <span class="s1">&#39;libtool&#39;</span><span class="p">,</span> <span class="s1">&#39;pkgconf&#39;</span><span class="p">,</span> <span class="s1">&#39;rpm-build&#39;</span><span class="p">,</span> <span class="s1">&#39;rpmdevtools&#39;</span><span class="p">,</span> <span class="s1">&#39;asciidoc&#39;</span><span class="p">,</span> <span class="s1">&#39;xmlto&#39;</span><span class="p">,</span> <span class="s1">&#39;libuuid-devel&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;json-c-devel&#39;</span><span class="p">,</span> <span class="s1">&#39;kmod-devel&#39;</span><span class="p">,</span> <span class="s1">&#39;libudev-devel&#39;</span><span class="p">,</span> <span class="s1">&#39;qemu*&#39;</span><span class="p">,</span> <span class="s1">&#39;abrt-cli&#39;</span><span class="p">,</span> <span class="s1">&#39;epel-release&#39;</span><span class="p">,</span> <span class="s1">&#39;autoconf&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;automake&#39;</span><span class="p">,</span> <span class="s1">&#39;libtool&#39;</span><span class="p">,</span> <span class="s1">&#39;pkgconf&#39;</span><span class="p">,</span> <span class="s1">&#39;rpm-build&#39;</span><span class="p">,</span> <span class="s1">&#39;rpmdevtools&#39;</span><span class="p">,</span> <span class="s1">&#39;asciidoc&#39;</span><span class="p">,</span> <span class="s1">&#39;xmlto&#39;</span><span class="p">,</span> <span class="s1">&#39;libuuid-devel&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;json-c-devel&#39;</span><span class="p">,</span> <span class="s1">&#39;kmod-devel&#39;</span><span class="p">,</span> <span class="s1">&#39;libudev-devel&#39;</span><span class="p">,</span> <span class="s1">&#39;msr-tools&#39;</span><span class="p">,</span> <span class="s1">&#39;epel-release&#39;</span><span class="p">,</span> <span class="s1">&#39;readline-devel&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;xxhash-devel&#39;</span><span class="p">,</span> <span class="s1">&#39;lz4-devel&#39;</span><span class="p">,</span> <span class="s1">&#39;qemu-kvm&#39;</span><span class="p">,</span> <span class="s1">&#39;python3-libvirt.x86_64&#39;</span><span class="p">,</span> <span class="s1">&#39;p7zip&#39;</span><span class="p">,</span> <span class="s1">&#39;p7zip-plugins&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file</span><span class="p">(</span><span class="s1">&#39;http_proxy&#39;</span><span class="p">,</span> <span class="s1">&#39;export http_proxy=http://proxy-iind.intel.com:911&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file</span><span class="p">(</span><span class="s1">&#39;HTTP_PROXY&#39;</span><span class="p">,</span> <span class="s1">&#39;export HTTP_PROXY=http://proxy-iind.intel.com:911&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file</span><span class="p">(</span><span class="s1">&#39;https_proxy&#39;</span><span class="p">,</span> <span class="s1">&#39;export https_proxy=http://proxy-iind.intel.com:911&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file</span><span class="p">(</span><span class="s1">&#39;HTTPS_PROXY&#39;</span><span class="p">,</span> <span class="s1">&#39;export HTTPS_PROXY=http://proxy-iind.intel.com:911&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file</span><span class="p">(</span><span class="s1">&#39;no_proxy&#39;</span><span class="p">,</span> <span class="s2">&quot;export no_proxy=&#39;localhost,127.0.0.1,intel.com,.intel.com&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;yum groupinstall -y &quot;Development Tools&quot; --allowerasing&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;dnf update --nogpg --allowerasing -y&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">100</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rpm</span> <span class="ow">in</span> <span class="n">rpm_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;yum -y install </span><span class="si">{</span><span class="n">rpm</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60000</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.run_dpdk"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.run_dpdk">[docs]</a>    <span class="k">def</span> <span class="nf">run_dpdk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Install and Run DPDK test</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Install and Run DPDK test</span>
<span class="sd">                      run_dpdk()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">DPDK_DRIVER_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="c1"># self.sut.execute_shell_cmd(&#39;unzip *.zip&#39;, timeout=60, cwd=DPDK_DRIVER_PATH_L)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;tar xvf *.tar.xz&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ls -d */&#39;</span><span class="p">,</span><span class="n">cwd</span><span class="o">=</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">dpdk_dirname</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;find </span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">dpdk/ -name *.patch&#39;</span><span class="p">,</span><span class="n">cwd</span><span class="o">=</span><span class="n">DLB_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">patch_fname</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;patch -Np1 &lt; </span><span class="si">{</span><span class="n">patch_fname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="si">}{</span><span class="n">dpdk_dirname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file</span><span class="p">(</span><span class="s1">&#39;DPDK_DIR&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;export DPDK_DIR=</span><span class="si">{</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="si">}{</span><span class="n">dpdk_dirname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file</span><span class="p">(</span><span class="s1">&#39;RTE_SDK&#39;</span><span class="p">,</span> <span class="s1">&#39;export RTE_SDK=$DPDK_DIR&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file</span><span class="p">(</span><span class="s1">&#39;RTE_TARGET&#39;</span><span class="p">,</span> <span class="s1">&#39;export RTE_TARGET=installdir&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;yum install -y meson python3-pyelftools&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;meson setup --prefix $RTE_SDK/$RTE_TARGET builddir&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="si">}{</span><span class="n">dpdk_dirname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;ninja -C builddir&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="si">}{</span><span class="n">dpdk_dirname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;mkdir -p /mnt/hugepages&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="si">}{</span><span class="n">dpdk_dirname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;mount -t hugetlbfs nodev /mnt/hugepages&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="si">}{</span><span class="n">dpdk_dirname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;echo 2048 &gt; /proc/sys/vm/nr_hugepages&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="si">}{</span><span class="n">dpdk_dirname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

    <span class="c1"># def run_fio_stress_async(self):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#           Purpose: Run fio asynchronous stress overnight</span>
    <span class="c1">#           Args:</span>
    <span class="c1">#               No</span>
    <span class="c1">#           Returns:</span>
    <span class="c1">#               No</span>
    <span class="c1">#           Raises:</span>
    <span class="c1">#               RuntimeError: If any errors</span>
    <span class="c1">#           Example:</span>
    <span class="c1">#               Simplest usage: Run fio stress overnight</span>
    <span class="c1">#                     run_fio_stress_async()</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;rm -rf fio_async.log&#39;, timeout=60, cwd=&#39;/root/&#39;)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;yum install -y fio&#39;, timeout=10 * 60)</span>
    <span class="c1">#     _, out, err = self.sut.execute_shell_cmd_async(</span>
    <span class="c1">#         &#39;fio --filename=/dev/sda --direct=1 --iodepth=1 --rw=randrw --rwmixread=70 --ioengine=libaio --bs=4k --size=300G --numjobs=50 --runtime=300 --group_reporting --name=randrw70read4k &gt; /root/fio_async.log&#39;,</span>
    <span class="c1">#         timeout=300)</span>

<div class="viewcode-block" id="Accelerator.run_fio_stress_async"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.run_fio_stress_async">[docs]</a>    <span class="k">def</span> <span class="nf">run_fio_stress_async</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run fio asynchronous stress overnight</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run fio stress overnight</span>
<span class="sd">                        run_fio_stress_async()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf fio_async.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;yum install -y fio&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">hdd_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__grep_linux_fio_hdd</span><span class="p">()</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd_async</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;fio --filename=/dev/</span><span class="si">{</span><span class="n">hdd_info</span><span class="si">}</span><span class="s1"> --direct=1 --iodepth=1 --rw=randrw --rwmixread=70 --ioengine=libaio --bs=4k --size=300G --numjobs=50 --runtime=300 --group_reporting --name=randrw70read4k &gt; fio_async.log&#39;</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.run_linpack_stress_async"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.run_linpack_stress_async">[docs]</a>    <span class="k">def</span> <span class="nf">run_linpack_stress_async</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run linpack asynchronous stress overnight</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run linpack asynchronous stress overnight</span>
<span class="sd">                        run_linpack_stress_async()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf linpack_async.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;yum -y install docker&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">LINPACK_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">LINPACK_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">LINPACK_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;unzip *.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">LINPACK_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd_async</span><span class="p">(</span>
            <span class="s1">&#39;while [ $SECONDS -lt $((SECONDS+300)) ]; do /home/BKCPkg/domains/accelerator/linpack/pnpwls-master/linpack/run_linpack.sh avx3 ; done | tee /root/linpack_async.log&#39;</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="mi">50000</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.run_mlc_stress_async"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.run_mlc_stress_async">[docs]</a>    <span class="k">def</span> <span class="nf">run_mlc_stress_async</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run mlc asynchronous stress overnight</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run mlc asynchronous stress overnight</span>
<span class="sd">                        run_mlc_stress_async()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">MLC_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">MLC_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">MLC_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;tar -zxvf *.tgz&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">MLC_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;chmod 777 *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MLC_PATH_L</span><span class="si">}</span><span class="s1">Linux/&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd_async</span><span class="p">(</span><span class="s1">&#39;./mlc --loaded_latency -t3 -X -D8192 &gt; mlc_async.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MLC_PATH_L</span><span class="si">}</span><span class="s1">Linux/&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.run_openssl"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.run_openssl">[docs]</a>    <span class="k">def</span> <span class="nf">run_openssl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_asym</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>  <span class="c1"># --&gt;True/False</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run openssl symmetric or asymmetric</span>
<span class="sd">              Args:</span>
<span class="sd">                  is_asym: is openssl symmetric or asymmetric</span>
<span class="sd">              Returns:</span>
<span class="sd">                  None</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run openssl symmetric</span>
<span class="sd">                      run_openssl(False)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_ASYM_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">QAT_ASYM_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">QAT_ASYM_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_SYM_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">QAT_SYM_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">QAT_SYM_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_TEST_SCRIPT_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">QAT_TEST_SCRIPT_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">QAT_TEST_SCRIPT_PATH_L</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_asym</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openssl_asymmetric</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openssl_symmetric</span><span class="p">()</span></div>

<div class="viewcode-block" id="Accelerator.run_prime95_stress_async"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.run_prime95_stress_async">[docs]</a>    <span class="k">def</span> <span class="nf">run_prime95_stress_async</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run prime95 asynchronous stress overnight</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run prime95 asynchronous stress overnight</span>
<span class="sd">                      run_prime95_stress_async()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">PRIME95_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">PRIME95_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">PRIME95_PATH_L</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;tar -zxvf *.tar.gz&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">PRIME95_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">PPEXPECT_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">PPEXPECT_prime95_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">PRIME95_SCRIPT_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">PRIME95_SCRIPT_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd_async</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;python3 prime95.py run_prime95&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">7200</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">PRIME95_PATH_L</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.run_ptu_stress_async"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.run_ptu_stress_async">[docs]</a>    <span class="k">def</span> <span class="nf">run_ptu_stress_async</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run ptu asynchronous stress overnight</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run ptu asynchronous stress overnight</span>
<span class="sd">                        run_ptu_stress_async()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">PTU_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">PTU_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">PTU_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;unzip *.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">PTU_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;chmod 777 *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">PTU_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd_async</span><span class="p">(</span><span class="s1">&#39;./ptu -ct 8 &gt; ptu_async.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">PTU_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="Accelerator.run_qat_sample_code"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.run_qat_sample_code">[docs]</a>    <span class="k">def</span> <span class="nf">run_qat_sample_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qat_cpa_param</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run QAT cap_sample stress</span>
<span class="sd">              Args:</span>
<span class="sd">                  qat_cpa_param: Which cap_sample stress need to run</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: run cap_sample stress</span>
<span class="sd">                        run_qat_sample_code(&#39;&#39;)</span>
<span class="sd">                        run_qat_sample_code(&#39;signOfLife=1&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;./cpa_sample_code &#39;</span> <span class="o">+</span> <span class="n">qat_cpa_param</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1000</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">/build/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;Sample code completed successfully&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Issue - Run qat stress fail&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.run_qat_stress_async"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.run_qat_stress_async">[docs]</a>    <span class="k">def</span> <span class="nf">run_qat_stress_async</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run QAT asynchronous stress overnight</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run QAT asynchronous stress overnight</span>
<span class="sd">                        run_qat_stress_async()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf qat_async.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd_async</span><span class="p">(</span><span class="s1">&#39;while [ $SECONDS -lt $((SECONDS+300)) ]; do /home/BKCPkg/domains/accelerator/QAT/build/cpa_sample_code runTests=63 signOfLife=1 ; done | tee /root/qat_async.log&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.run_socwatch"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.run_socwatch">[docs]</a>    <span class="k">def</span> <span class="nf">run_socwatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_num</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run socwatch tool</span>
<span class="sd">              Args:</span>
<span class="sd">                  Yes: log_num is which time run socwatch tool.</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run socwatch tool</span>
<span class="sd">                      install_socwatch()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">PPEXPECT_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">PPEXPECT_SOCWATCH_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">SOCWATCH_SCRIPT_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">SOCWATCH_SCRIPT_PATH_L</span><span class="p">)</span></div>
        <span class="c1"># ret, out, err = self.sut.execute_shell_cmd(f&#39;python3 socwatch.py run_socwatch&#39;, timeout=10*60, cwd=SOCWATCH_SCRIPT_PATH_L)</span>
        <span class="c1"># self.__check_error(err)</span>
        <span class="c1"># self.sut.execute_shell_cmd(f&#39;rm -rf /root/socwatch{log_num}.log&#39;)</span>
        <span class="c1"># self.sut.execute_shell_cmd(f&#39;mv socwatch.log socwatch{log_num}.log&#39;, timeout=10 * 60, cwd=&#39;/root&#39;)</span>
        <span class="c1"># self.sut.download_to_local(f&#39;/root/socwatch{log_num}.log&#39;, os.path.join(LOG_PATH, &#39;Logs&#39;))</span>
        <span class="c1"># self.sut.execute_shell_cmd(f&#39;rm -rf /root/runsocwatch{log_num}.log&#39;)</span>
        <span class="c1"># self.sut.execute_shell_cmd(f&#39;mv {SOCWATCH_PATH_L}socwatch_chrome_linux_INTERNAL_v2021.2_x86_64/runsocwatch.log /root/runsocwatch{log_num}.log&#39;, timeout=10*60)</span>
        <span class="c1"># self.sut.download_to_local(f&#39;/root/runsocwatch{log_num}.log&#39;, os.path.join(LOG_PATH, &#39;Logs&#39;))</span>
        <span class="c1"># self.sut.execute_shell_cmd(f&#39;rm -rf /root/SoCWatchOutput{log_num}.csv&#39;)</span>
        <span class="c1"># self.sut.execute_shell_cmd(f&#39;mv {SOCWATCH_PATH_L}socwatch_chrome_linux_INTERNAL_v2021.2_x86_64/SoCWatchOutput.csv /root/SoCWatchOutput{log_num}.csv&#39;, timeout=10*60)</span>
        <span class="c1"># self.sut.download_to_local(f&#39;/root/SoCWatchOutput{log_num}.csv&#39;, os.path.join(LOG_PATH, &#39;Logs&#39;))</span>
        <span class="c1"># _, out, err = self.sut.execute_shell_cmd(f&#39;cat SoCWatchOutput{log_num}.csv&#39;, timeout=60, cwd=&#39;/root&#39;)</span>
        <span class="c1"># self.__cc6_value_check(out)</span>
        <span class="c1"># self.__cpu_idle_value_check(out)</span>

<div class="viewcode-block" id="Accelerator.run_stressapptest_stress_async"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.run_stressapptest_stress_async">[docs]</a>    <span class="k">def</span> <span class="nf">run_stressapptest_stress_async</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run stressapptest asynchronous stress overnight</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run stressapptest asynchronous stress overnight</span>
<span class="sd">                        run_stressapptest_stress_async()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf stressapptest_async_log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">STRESSAPPTEST_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">STRESSAPPTEST_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">STRESSAPPTEST_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;unzip *.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">STRESSAPPTEST_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;./configure&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">STRESSAPPTEST_PATH_L</span><span class="si">}</span><span class="s1">stressapptest-master/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make install&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">STRESSAPPTEST_PATH_L</span><span class="si">}</span><span class="s1">stressapptest-master/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd_async</span><span class="p">(</span><span class="s1">&#39;/home/BKCPkg/domains/accelerator/stressapptest/stressapptest-master/src/stressapptest -s 300 -M 256 -m 18 -W -l /root/stressapptest_async_log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">50000</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.save_check_mce_error"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.save_check_mce_error">[docs]</a>    <span class="k">def</span> <span class="nf">save_check_mce_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf /root/mce.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;abrt-cli list | grep mce | tee /root/mce.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">download_to_local</span><span class="p">(</span><span class="n">remotepath</span><span class="o">=</span><span class="s1">&#39;/root/mce.log&#39;</span><span class="p">,</span> <span class="n">localpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LOG_PATH</span><span class="p">,</span> <span class="s1">&#39;Logs&#39;</span><span class="p">))</span>
        <span class="n">rcode</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;abrt-cli list | grep mce|wc -l&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">err</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.save_check_dmesg_error"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.save_check_dmesg_error">[docs]</a>    <span class="k">def</span> <span class="nf">save_check_dmesg_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf /root/dmesg.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;dmesg | tee /root/dmesg.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">download_to_local</span><span class="p">(</span><span class="n">remotepath</span><span class="o">=</span><span class="s1">&#39;/root/dmesg.log&#39;</span><span class="p">,</span> <span class="n">localpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LOG_PATH</span><span class="p">,</span> <span class="s1">&#39;Logs&#39;</span><span class="p">))</span>
        <span class="n">rcode</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;dmesg | grep &quot;error&quot; | wc -l&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">err</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.sgx_install_and_test"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.sgx_install_and_test">[docs]</a>    <span class="k">def</span> <span class="nf">sgx_install_and_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">             Purpose: Install SGX driver and run SGX SDK test</span>
<span class="sd">             Args:</span>
<span class="sd">                 No</span>
<span class="sd">             Returns:</span>
<span class="sd">                 No</span>
<span class="sd">             Raises:</span>
<span class="sd">                 RuntimeError: If any errors</span>
<span class="sd">             Example:</span>
<span class="sd">                 Simplest usage: Install SGX driver and run SGX SDK test</span>
<span class="sd">                     sgx_install_and_test()</span>
<span class="sd">       &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">SGX_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">SGX_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">SGX_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;unzip sgx*.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">SGX_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;tar -zxvf sgx*.tgz&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SGX_PATH_L</span><span class="si">}</span><span class="s1">Installer/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;yum-config-manager --add-repo </span><span class="si">{</span><span class="n">SGX_PATH_L</span><span class="si">}</span><span class="s1">Installer/sgx_rpm_local_repo&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;yum --nogpgcheck install -y libsgx-epid libsgx-uae-service libsgx-launch libsgx-urts&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;chmod 777 *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SGX_PATH_L</span><span class="si">}</span><span class="s1">sgx_test/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file</span><span class="p">(</span><span class="s1">&#39;LD_LIBRARY_PATH&#39;</span><span class="p">,</span> <span class="s1">&#39;export LD_LIBRARY_PATH=/home/BKCPkg/domains/accelerator/sgx/sgx_test&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;./sgx_app -auto&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SGX_PATH_L</span><span class="si">}</span><span class="s1">sgx_test/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;Success: 7   Fail: 0&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Execute SGX app test fail&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;chmod 777 *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SGX_PATH_L</span><span class="si">}</span><span class="s1">Installer/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">PPEXPECT_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">PPEXPECT_SGXSDK_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">SGXSDK_SCRIPT_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">SGXSDK_SCRIPT_PATH_L</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;python3 sgx_sdk.py run_sgxsdk&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">7200</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">SGXSDK_SCRIPT_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">download_to_local</span><span class="p">(</span><span class="n">remotepath</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SGXSDK_SCRIPT_PATH_L</span><span class="si">}</span><span class="s1">sgx_sdk.log&#39;</span><span class="p">,</span> <span class="n">localpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LOG_PATH</span><span class="p">,</span> <span class="s1">&#39;Logs&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">download_to_local</span><span class="p">(</span><span class="n">remotepath</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SGXSDK_SCRIPT_PATH_L</span><span class="si">}</span><span class="s1">Installer/sdk.log&#39;</span><span class="p">,</span> <span class="n">localpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LOG_PATH</span><span class="p">,</span> <span class="s1">&#39;Logs&#39;</span><span class="p">))</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cat </span><span class="si">{</span><span class="n">SGXSDK_SCRIPT_PATH_L</span><span class="si">}</span><span class="s1">Installer/sdk.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;Installation is successful!&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;RUN SGX SDK fail&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;source /home/BKCPkg/domains/accelerator/sgx/Installer/sgxsdk/environment&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;source /home/BKCPkg/domains/accelerator/sgx/Installer/sgxsdk/environment&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SGX_PATH_L</span><span class="si">}</span><span class="s1">Installer/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.sgx_msr_value_check"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.sgx_msr_value_check">[docs]</a>    <span class="k">def</span> <span class="nf">sgx_msr_value_check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">             Purpose: Check SGX &quot;rdmsr 0x3a&quot; value</span>
<span class="sd">             Args:</span>
<span class="sd">                 No</span>
<span class="sd">             Returns:</span>
<span class="sd">                 No</span>
<span class="sd">             Raises:</span>
<span class="sd">                 RuntimeError: If any errors</span>
<span class="sd">             Example:</span>
<span class="sd">                 Simplest usage: Check SGX &quot;rdmsr 0x3a&quot; value</span>
<span class="sd">                     sgx_msr_value_check()</span>
<span class="sd">       &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">MSR_TOOL_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">MSR_tool_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">MSR_TOOL_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rpm -ivh *.rpm --force --nodeps&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">MSR_TOOL_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;yum install -y openssl-devel libcurl-devel protobuf-devel yum-utils.noarch epel-release msr-tools&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rdmsr 0x3a&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">x3a_value</span> <span class="o">=</span> <span class="s1">&#39;0x&#39;</span> <span class="o">+</span> <span class="n">out</span>
        <span class="n">x3a_bin_value</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x3a_value</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
        <span class="n">x3a_str_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">x3a_bin_value</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="n">x3a_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">x3a_str_value</span><span class="p">:</span>
            <span class="n">x3a_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="n">x3a_list</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x3a_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;1&#39;</span> <span class="ow">or</span> <span class="n">x3a_list</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;1&#39;</span> <span class="ow">or</span> <span class="n">x3a_list</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;1&#39;</span> <span class="ow">or</span> <span class="n">x3a_list</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;0x3a value is incorrect&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;0x3a value is incorrect&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.sgx_sampleenclave_test"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.sgx_sampleenclave_test">[docs]</a>    <span class="k">def</span> <span class="nf">sgx_sampleenclave_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">             Purpose: Run SGX sampleenclave test</span>
<span class="sd">             Args:</span>
<span class="sd">                 No</span>
<span class="sd">             Returns:</span>
<span class="sd">                 No</span>
<span class="sd">             Raises:</span>
<span class="sd">                 RuntimeError: If any errors</span>
<span class="sd">             Example:</span>
<span class="sd">                 Simplest usage: Run SGX sampleenclave test</span>
<span class="sd">                     sgx_sampleenclave_test()</span>
<span class="sd">       &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SGX_PATH_L</span><span class="si">}</span><span class="s1">Installer/sgxsdk/SampleCode/SampleEnclave/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;The project has been built in debug hardware mode&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Execute SGX app test fail&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;./app &gt; app.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SGX_PATH_L</span><span class="si">}</span><span class="s1">Installer/sgxsdk/SampleCode/SampleEnclave/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">download_to_local</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SGX_PATH_L</span><span class="si">}</span><span class="s1">Installer/sgxsdk/SampleCode/SampleEnclave/app.log&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LOG_PATH</span><span class="p">,</span> <span class="s1">&#39;Logs&#39;</span><span class="p">))</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cat </span><span class="si">{</span><span class="n">SGX_PATH_L</span><span class="si">}</span><span class="s1">Installer/sgxsdk/SampleCode/SampleEnclave/app.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;SampleEnclave successfully returned&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Run SampleEnclave fail&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.sgxhydra_test"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.sgxhydra_test">[docs]</a>    <span class="k">def</span> <span class="nf">sgxhydra_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">             Purpose: Run sgxhydra test</span>
<span class="sd">             Args:</span>
<span class="sd">                 No</span>
<span class="sd">             Returns:</span>
<span class="sd">                 No</span>
<span class="sd">             Raises:</span>
<span class="sd">                 RuntimeError: If any errors</span>
<span class="sd">             Example:</span>
<span class="sd">                 Simplest usage: Run sgxhydra test</span>
<span class="sd">                     sgxhydra_test()</span>
<span class="sd">       &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">SGXHYDRA_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">SGXHYDRA_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;unzip SGXHydra.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">SGXHYDRA_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make SGX_PRERELEASE=1 SGX_DEBUG=0&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SGXHYDRA_PATH_L</span><span class="si">}</span><span class="s1">SGXHydra/&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;./SGXHydra 128 64 64 9&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">50000</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SGXHYDRA_PATH_L</span><span class="si">}</span><span class="s1">SGXHydra/App/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;started&#39;</span><span class="p">,</span> <span class="s1">&#39;stopped&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;run SGXHydra stress fail&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.stressapptest_stress"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.stressapptest_stress">[docs]</a>    <span class="k">def</span> <span class="nf">stressapptest_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run stressapptest stress overnight</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run stressapptest stress overnight</span>
<span class="sd">                        stressapptest_stress()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">STRESSAPPTEST_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">STRESSAPPTEST_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">STRESSAPPTEST_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;unzip *.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">STRESSAPPTEST_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;./configure&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">STRESSAPPTEST_PATH_L</span><span class="si">}</span><span class="s1">stressapptest-master/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;make install&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">STRESSAPPTEST_PATH_L</span><span class="si">}</span><span class="s1">stressapptest-master/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
            <span class="s1">&#39;/home/BKCPkg/domains/accelerator/stressapptest/stressapptest-master/src/stressapptest -s 300 -M 256 -m 18 -W -l /root/stressapptest_log&#39;</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="mi">50000</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;cat /root/stressapptest_log&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s2">&quot;Status: PASS - please verify no corrected errors&quot;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Run stressapptest stress fail&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">download_to_local</span><span class="p">(</span><span class="n">remotepath</span><span class="o">=</span><span class="s1">&#39;/root/stressapptest_log&#39;</span><span class="p">,</span> <span class="n">localpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LOG_PATH</span><span class="p">,</span> <span class="s1">&#39;Logs&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf stressapptest_log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root/&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.kernel_version"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.kernel_version">[docs]</a>    <span class="k">def</span> <span class="nf">kernel_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;uname -r&#39;</span><span class="p">)</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">line_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Accelerator.tdx_install"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.tdx_install">[docs]</a>    <span class="k">def</span> <span class="nf">tdx_install</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Install TDX driver and check TDX status</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Install TDX driver and check TDX status</span>
<span class="sd">                      tdx_install()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ker_ver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_version</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ker_ver</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CENTOS_INTEL_NEXT_KERNEL</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">MSR_TOOL_PATH_L</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">MSR_tool_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">MSR_TOOL_PATH_L</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rpm -ivh *.rpm --force --nodeps&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">MSR_TOOL_PATH_L</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rdmsr 0x1401 -f 11:11&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;1&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;TDX status show fail&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;mkdir /usr/lib/firmware/intel-seam&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">TDX_SEAM_LOADER_PATH_L</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">TDX_SEAM_LOADER_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">TDX_SEAM_LOADER_PATH_L</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;unzip *.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">TDX_SEAM_LOADER_PATH_L</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">TDX_SEAM_MODULE_PATH_L</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">TDX_SEAM_MODULE_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">TDX_SEAM_MODULE_PATH_L</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;unzip *.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">TDX_SEAM_MODULE_PATH_L</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;mv *.bin np-seamldr.acm&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">TDX_SEAM_LOADER_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;cp np-seamldr.acm  /usr/lib/firmware/intel-seam/&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">TDX_SEAM_LOADER_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;mv *.sigstruct libtdx.so.sigstruct&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">TDX_SEAM_MODULE_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;cp libtdx.so.sigstruct  /usr/lib/firmware/intel-seam/&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">TDX_SEAM_MODULE_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;mv *.so libtdx.so&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">TDX_SEAM_MODULE_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;cp libtdx.so  /usr/lib/firmware/intel-seam/&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">TDX_SEAM_MODULE_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf np-seamldr.conf&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/etc/dracut.conf.d/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;touch np-seamldr.conf&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/etc/dracut.conf.d/&#39;</span><span class="p">)</span>
            <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;compress=cat&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s1"> &gt;&gt; /etc/dracut.conf.d/np-seamldr.conf&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;echo </span><span class="se">\&#39;</span><span class="s1">install_items+=&quot; /usr/lib/firmware/intel-seam/libtdx.so /usr/lib/firmware/intel-seam/libtdx.so.sigstruct /usr/lib/firmware/intel-seam/np-seamldr.acm &quot;</span><span class="se">\&#39;</span><span class="s1"> &gt;&gt; /etc/dracut.conf.d/np-seamldr.conf&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;chmod 777 *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/etc/dracut.conf.d/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;dracut --force&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/etc/dracut.conf.d/&#39;</span><span class="p">)</span>
            <span class="c1"># self.sut.execute_shell_cmd(&#39;reboot&#39;, timeout=30 * 60)</span>
            <span class="c1"># self.Case.sleep(60)</span>
            <span class="c1"># self.Case.wait_and_expect(f&#39;SUT in OS&#39;, 30 * 60, self.sut.check_system_in_os)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">my_os</span><span class="o">.</span><span class="n">warm_reset_cycle_step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Case</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;dmesg | grep -i &quot;tdx init&quot;&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/etc/dracut.conf.d/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;tdx: TDX initialized&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;TDX initialized fail&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mkdir -p </span><span class="si">{</span><span class="n">TDX_SEAM_RPMS_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">TDX_SEAM_RPMS_PATH_L</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;wget </span><span class="si">{</span><span class="n">TDX_SEAM_MODULE_RPM_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">TDX_SEAM_RPMS_PATH_L</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;wget </span><span class="si">{</span><span class="n">TDX_SEAM_MODULE_COMMON_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">TDX_SEAM_RPMS_PATH_L</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;wget </span><span class="si">{</span><span class="n">TDX_SEAM_MODULE_NON_PRODUCTION_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">TDX_SEAM_RPMS_PATH_L</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rpm -ivh tdx-seam*.rpm --nodeps&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">TDX_SEAM_RPMS_PATH_L</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modify_kernel_grub</span><span class="p">(</span><span class="s1">&#39;tdx_host=on&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rdmsr 0x1401 -f 11:11&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;1&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;TDX status show fail&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;dmesg | grep -i &quot;tdx&quot;&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/etc/dracut.conf.d/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;tdx: Successfully initialized TDX module&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;TDX initialized fail&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.upload_dsa_tools_rich_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.upload_dsa_tools_rich_vm">[docs]</a>    <span class="k">def</span> <span class="nf">upload_dsa_tools_rich_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">):</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mkdir -p </span><span class="si">{</span><span class="n">SPR_ACCE_RANDOM_CONFIG_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rm -rf </span><span class="si">{</span><span class="n">SPR_ACCE_RANDOM_CONFIG_PATH_L</span><span class="si">}</span><span class="s1">*&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">sut_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SPR_ACCE_RANDOM_CONFIG_PATH_L</span><span class="si">}{</span><span class="n">SPR_ACCE_RANDOM_CONFIG_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">vm_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SPR_ACCE_RANDOM_CONFIG_PATH_L</span><span class="si">}{</span><span class="n">SPR_ACCE_RANDOM_CONFIG_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">upload_to_rich_vm</span><span class="p">(</span><span class="n">sut_file_dir</span><span class="p">,</span> <span class="n">vm_file_dir</span><span class="p">)</span>

        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mkdir -p </span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rm -rf </span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}</span><span class="s1">*&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">sut_file_dir1</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}{</span><span class="n">DSA_ACCEL_CONFIG_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">vm_file_dir1</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DSA_PATH_L</span><span class="si">}{</span><span class="n">DSA_ACCEL_CONFIG_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">DSA_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">DSA_PATH_L</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">upload_to_rich_vm</span><span class="p">(</span><span class="n">sut_file_dir1</span><span class="p">,</span> <span class="n">vm_file_dir1</span><span class="p">)</span></div>

    <span class="c1"># def tdx_install(self):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#           Purpose: Install TDX driver and check TDX status</span>
    <span class="c1">#           Args:</span>
    <span class="c1">#               No</span>
    <span class="c1">#           Returns:</span>
    <span class="c1">#               No</span>
    <span class="c1">#           Raises:</span>
    <span class="c1">#               RuntimeError: If any errors</span>
    <span class="c1">#           Example:</span>
    <span class="c1">#               Simplest usage: Install TDX driver and check TDX status</span>
    <span class="c1">#                   tdx_install()</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;rm -rf *&#39;, timeout=60, cwd=MSR_TOOL_PATH_L)</span>
    <span class="c1">#     self.sut.upload_to_remote(localpath=MSR_tool_H, remotepath=MSR_TOOL_PATH_L)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;rpm -ivh *.rpm --force --nodeps&#39;, timeout=60, cwd=MSR_TOOL_PATH_L)</span>
    <span class="c1">#     _, out, err = self.sut.execute_shell_cmd(&#39;rdmsr 0x1401 -f 11:11&#39;, timeout=60)</span>
    <span class="c1">#     self.check_keyword([&#39;1&#39;], out, &#39;TDX status show fail&#39;)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;mkdir /usr/lib/firmware/intel-seam&#39;, timeout=60)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;rm -rf *&#39;, timeout=60, cwd=TDX_SEAM_LOADER_PATH_L)</span>
    <span class="c1">#     self.sut.upload_to_remote(localpath=TDX_SEAM_LOADER_H, remotepath=TDX_SEAM_LOADER_PATH_L)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;unzip *.zip&#39;, timeout=60, cwd=TDX_SEAM_LOADER_PATH_L)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;rm -rf *&#39;, timeout=60, cwd=TDX_SEAM_MODULE_PATH_L)</span>
    <span class="c1">#     self.sut.upload_to_remote(localpath=TDX_SEAM_MODULE_H, remotepath=TDX_SEAM_MODULE_PATH_L)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;unzip *.zip&#39;, timeout=60, cwd=TDX_SEAM_MODULE_PATH_L)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;mv *.bin np-seamldr.acm&#39;, timeout=60, cwd=f&#39;{TDX_SEAM_LOADER_PATH_L}*/&#39;)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;cp np-seamldr.acm  /usr/lib/firmware/intel-seam/&#39;, timeout=60, cwd=f&#39;{TDX_SEAM_LOADER_PATH_L}*/&#39;)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;mv *.sigstruct libtdx.so.sigstruct&#39;, timeout=60, cwd=f&#39;{TDX_SEAM_MODULE_PATH_L}*/&#39;)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;cp libtdx.so.sigstruct  /usr/lib/firmware/intel-seam/&#39;, timeout=60, cwd=f&#39;{TDX_SEAM_MODULE_PATH_L}*/&#39;)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;mv *.so libtdx.so&#39;, timeout=60, cwd=f&#39;{TDX_SEAM_MODULE_PATH_L}*/&#39;)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;cp libtdx.so  /usr/lib/firmware/intel-seam/&#39;, timeout=60, cwd=f&#39;{TDX_SEAM_MODULE_PATH_L}*/&#39;)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;rm -rf np-seamldr.conf&#39;, timeout=60, cwd=&#39;/etc/dracut.conf.d/&#39;)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;touch np-seamldr.conf&#39;, timeout=60, cwd=&#39;/etc/dracut.conf.d/&#39;)</span>
    <span class="c1">#     command = &#39;compress=cat&#39;</span>
    <span class="c1">#     self.sut.execute_shell_cmd(f&#39;echo {command} &gt;&gt; /etc/dracut.conf.d/np-seamldr.conf&#39;, timeout=60)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;echo \&#39;install_items+=&quot; /usr/lib/firmware/intel-seam/libtdx.so /usr/lib/firmware/intel-seam/libtdx.so.sigstruct /usr/lib/firmware/intel-seam/np-seamldr.acm &quot;\&#39; &gt;&gt; /etc/dracut.conf.d/np-seamldr.conf&#39;, timeout=60)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;chmod 777 *&#39;, timeout=60, cwd=&#39;/etc/dracut.conf.d/&#39;)</span>
    <span class="c1">#     self.sut.execute_shell_cmd(&#39;dracut --force&#39;, timeout=60, cwd=&#39;/etc/dracut.conf.d/&#39;)</span>
    <span class="c1">#     # self.sut.execute_shell_cmd(&#39;reboot&#39;, timeout=30 * 60)</span>
    <span class="c1">#     # self.Case.sleep(60)</span>
    <span class="c1">#     # self.Case.wait_and_expect(f&#39;SUT in OS&#39;, 30 * 60, self.sut.check_system_in_os)</span>
    <span class="c1">#     self.my_os.warm_reset_cycle_step(self.sut)</span>
    <span class="c1">#     self.Case.sleep(60)</span>
    <span class="c1">#     _, out, err = self.sut.execute_shell_cmd(&#39;dmesg | grep -i &quot;tdx init&quot;&#39;, timeout=60, cwd=&#39;/etc/dracut.conf.d/&#39;)</span>
    <span class="c1">#     self.__check_error(err)</span>
    <span class="c1">#     self.check_keyword([&#39;tdx: TDX initialized&#39;], out, &#39;TDX initialized fail&#39;)</span>

    <span class="k">def</span> <span class="nf">__dlb_vf_set_egs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vf</span><span class="p">,</span> <span class="n">dlb_pf_id</span><span class="p">,</span> <span class="n">pci_id_list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vf</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="mi">2048</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vf</span><span class="p">)</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/devices/</span><span class="si">{</span><span class="n">dlb_pf_id</span><span class="si">}</span><span class="s1">/vf</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_resources/num_atomic_inflights&#39;</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="mi">2048</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vf</span><span class="p">)</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/devices/</span><span class="si">{</span><span class="n">dlb_pf_id</span><span class="si">}</span><span class="s1">/vf</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_resources/num_dir_credits&#39;</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="mi">64</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vf</span><span class="p">)</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/devices/</span><span class="si">{</span><span class="n">dlb_pf_id</span><span class="si">}</span><span class="s1">/vf</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_resources/num_dir_ports&#39;</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="mi">2048</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vf</span><span class="p">)</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/devices/</span><span class="si">{</span><span class="n">dlb_pf_id</span><span class="si">}</span><span class="s1">/vf</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_resources/num_hist_list_entries&#39;</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="mi">8192</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vf</span><span class="p">)</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/devices/</span><span class="si">{</span><span class="n">dlb_pf_id</span><span class="si">}</span><span class="s1">/vf</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_resources/num_ldb_credits&#39;</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="mi">64</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vf</span><span class="p">)</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/devices/</span><span class="si">{</span><span class="n">dlb_pf_id</span><span class="si">}</span><span class="s1">/vf</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_resources/num_ldb_ports&#39;</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="mi">32</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vf</span><span class="p">)</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/devices/</span><span class="si">{</span><span class="n">dlb_pf_id</span><span class="si">}</span><span class="s1">/vf</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_resources/num_ldb_queues&#39;</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="mi">32</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vf</span><span class="p">)</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/devices/</span><span class="si">{</span><span class="n">dlb_pf_id</span><span class="si">}</span><span class="s1">/vf</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_resources/num_sched_domains&#39;</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="mi">16</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vf</span><span class="p">)</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/devices/</span><span class="si">{</span><span class="n">dlb_pf_id</span><span class="si">}</span><span class="s1">/vf</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_resources/num_sn0_slots&#39;</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="mi">16</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vf</span><span class="p">)</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/devices/</span><span class="si">{</span><span class="n">dlb_pf_id</span><span class="si">}</span><span class="s1">/vf</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_resources/num_sn1_slots&#39;</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">ret</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;virsh nodedev-detach pci_</span><span class="si">{</span><span class="n">pci_id_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;detached device fail&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;detached device fail&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__dlb_vf_set_bhs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vf</span><span class="p">,</span> <span class="n">dlb_pf_id</span><span class="p">,</span> <span class="n">pci_id_list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vf</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="mi">2048</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vf</span><span class="p">)</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/devices/</span><span class="si">{</span><span class="n">dlb_pf_id</span><span class="si">}</span><span class="s1">/vf</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_resources/num_atomic_inflights&#39;</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="mi">96</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vf</span><span class="p">)</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/devices/</span><span class="si">{</span><span class="n">dlb_pf_id</span><span class="si">}</span><span class="s1">/vf</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_resources/num_dir_ports&#39;</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="mi">2048</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vf</span><span class="p">)</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/devices/</span><span class="si">{</span><span class="n">dlb_pf_id</span><span class="si">}</span><span class="s1">/vf</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_resources/num_hist_list_entries&#39;</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="mi">16384</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vf</span><span class="p">)</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/devices/</span><span class="si">{</span><span class="n">dlb_pf_id</span><span class="si">}</span><span class="s1">/vf</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_resources/num_ldb_credits&#39;</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="mi">64</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vf</span><span class="p">)</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/devices/</span><span class="si">{</span><span class="n">dlb_pf_id</span><span class="si">}</span><span class="s1">/vf</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_resources/num_ldb_ports&#39;</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="mi">32</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vf</span><span class="p">)</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/devices/</span><span class="si">{</span><span class="n">dlb_pf_id</span><span class="si">}</span><span class="s1">/vf</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_resources/num_ldb_queues&#39;</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="mi">32</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vf</span><span class="p">)</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/devices/</span><span class="si">{</span><span class="n">dlb_pf_id</span><span class="si">}</span><span class="s1">/vf</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_resources/num_sched_domains&#39;</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="mi">16</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vf</span><span class="p">)</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/devices/</span><span class="si">{</span><span class="n">dlb_pf_id</span><span class="si">}</span><span class="s1">/vf</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_resources/num_sn0_slots&#39;</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="mi">16</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vf</span><span class="p">)</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/devices/</span><span class="si">{</span><span class="n">dlb_pf_id</span><span class="si">}</span><span class="s1">/vf</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_resources/num_sn1_slots&#39;</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">ret</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;virsh nodedev-detach pci_</span><span class="si">{</span><span class="n">pci_id_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;detached device fail&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;detached device fail&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__grep_linux_fio_hdd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># grep boot os hdd</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s2">&quot;df -h |grep -i &#39;/boot/efi&#39; |awk &#39;{print $1}&#39;&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">dev_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">disk_line</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="n">disk_name</span> <span class="o">=</span> <span class="n">disk_line</span><span class="p">[</span><span class="mi">2</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">dev_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disk_name</span><span class="p">)</span>

        <span class="c1"># grep vm os hdd</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s2">&quot;fdisk -l |grep -i &#39;VMware VMFS&#39;|awk &#39;{print $1}&#39;&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">disk_line</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">disk_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">disk_line</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;sd&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">disk_num</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">line_name</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
                <span class="n">disk_name</span> <span class="o">=</span> <span class="n">line_name</span><span class="p">[</span><span class="mi">2</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">dev_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disk_name</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">disk_num</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">line_name</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
                <span class="n">disk_name</span> <span class="o">=</span> <span class="n">line_name</span><span class="p">[</span><span class="mi">2</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">dev_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disk_name</span><span class="p">)</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s2">&quot;fdisk -l |grep -i &#39;unknown&#39;|awk &#39;{print $1}&#39;&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">disk_line</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">disk_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">disk_line</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;sd&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">disk_num</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">line_name</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
                <span class="n">disk_name</span> <span class="o">=</span> <span class="n">line_name</span><span class="p">[</span><span class="mi">2</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">dev_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disk_name</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">disk_num</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">line_name</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
                <span class="n">disk_name</span> <span class="o">=</span> <span class="n">line_name</span><span class="p">[</span><span class="mi">2</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">dev_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disk_name</span><span class="p">)</span>

        <span class="c1"># grep all sut hdd</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out1</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;ls /dev/sd?&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out2</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;ls /dev/nvme*n1&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">out1</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">out2</span>

        <span class="n">disk_line</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">disk_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">all_dev_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">disk_line</span><span class="p">:</span>
            <span class="n">disk_num</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">line_name</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">disk_name</span> <span class="o">=</span> <span class="n">line_name</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">all_dev_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disk_name</span><span class="p">)</span>

        <span class="c1"># grep fio hdd name</span>
        <span class="n">fio_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="nb">list</span> <span class="ow">in</span> <span class="n">all_dev_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">list</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dev_list</span><span class="p">:</span>
                <span class="n">fio_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fio_list</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;please add another hdd to test&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;please add another hdd to test&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fio_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<div class="viewcode-block" id="Accelerator.unbind_device"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.unbind_device">[docs]</a>    <span class="k">def</span> <span class="nf">unbind_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip_pf_vf</span><span class="p">):</span>   <span class="c1">#begain is qat_0_1  dlb_0_0</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Unbind &#39;QAT&#39;, &#39;DLB&#39;, &#39;DSA&#39; device</span>
<span class="sd">              Args:</span>
<span class="sd">                  ip_pf_vf_mdev :</span>
<span class="sd">                  1. If unbind QAT device, format is qat_0_1, pf 0 is QAT PF device 1,pf begin from device 1, device id from device 0-7, pf 0 --&gt;device id;</span>
<span class="sd">                    vf 1 vf device 1, vf begin from virtual device 1, device id from device 00.1-02.0,vf 1--&gt;device 00.1</span>
<span class="sd">                  2.If unbind DLB device, format is dlb_0_0, pf 0 is pf device 1,pf begin from true device 1, device id from device 0-7, pf 0 --&gt;device id 1;</span>
<span class="sd">                    vf is number of vf device need created, vf 0 is don&#39;t create virtual device, vf 1 is create 1 virtual device, vf 16 is create 16 virtual device</span>
<span class="sd">                  3.If unbind DSA device, format is dsa_0_0, pf 0 is pf device 1,pf begin from true device 1, device id from device 0-7, pf 0 --&gt;device id 1</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: unbind QAT pf device 0</span>
<span class="sd">                        unbind_device(&#39;qat_0_0&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ip</span><span class="p">,</span> <span class="n">pf</span><span class="p">,</span> <span class="n">vf</span> <span class="o">=</span> <span class="n">ip_pf_vf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">pf</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pf</span><span class="p">)</span>
        <span class="n">vf</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vf</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ip</span> <span class="o">==</span> <span class="s1">&#39;qat&#39;</span><span class="p">:</span>
            <span class="n">dev_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dev_id</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">pf</span><span class="p">,</span> <span class="n">vf</span><span class="p">)</span>
            <span class="n">unbind_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_qat_unbind_path</span><span class="p">(</span><span class="n">dev_id</span><span class="p">)</span>
            <span class="n">pci_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_qat_pci_id</span><span class="p">(</span><span class="n">dev_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;modprobe vfio&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;modprobe vfio-pci&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="n">dev_id</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/devices/</span><span class="si">{</span><span class="n">unbind_path</span><span class="si">}</span><span class="s1">/driver/unbind&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">vf</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 8086 </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_id</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/drivers/vfio-pci/new_id&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="k">elif</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">vf</span> <span class="o">&lt;</span> <span class="mi">17</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 8086 </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_vf_id</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/drivers/vfio-pci/new_id&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Input an uncorrect vf number&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Input an uncorrect vf number&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lspci -s </span><span class="si">{</span><span class="n">dev_id</span><span class="si">}</span><span class="s1"> -k&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">ret</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;virsh nodedev-detach pci_</span><span class="si">{</span><span class="n">pci_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;detached device fail&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;detached device fail&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ip</span> <span class="o">==</span> <span class="s1">&#39;dlb&#39;</span><span class="p">:</span>
            <span class="n">dev_id_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dlb_dev_id_list</span><span class="p">(</span><span class="n">pf</span><span class="p">,</span> <span class="n">vf</span><span class="p">)</span>
            <span class="n">dlb_pf_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_dlb_unbind_path</span><span class="p">(</span><span class="n">dev_id_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">pci_id_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_dlb_pci_id_list</span><span class="p">(</span><span class="n">dev_id_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;modprobe vfio&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;modprobe vfio-pci&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vf</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="n">dev_id_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/drivers/dlb2/unbind&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">vf</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="n">dev_id_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/drivers/dlb2/unbind&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 8086 </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dlb_id</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/drivers/vfio-pci/new_id&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lspci -s </span><span class="si">{</span><span class="n">dev_id_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> -k&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
                <span class="n">ret</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;virsh nodedev-detach pci_</span><span class="si">{</span><span class="n">pci_id_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;detached device fail&#39;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;detached device fail&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">vf</span> <span class="o">&lt;</span> <span class="mi">17</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 8086 </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dlb_vf_id</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/drivers/vfio-pci/new_id&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__dlb_vf_set_egs</span><span class="p">(</span><span class="n">vf</span><span class="p">,</span> <span class="n">dlb_pf_id</span><span class="p">,</span> <span class="n">pci_id_list</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Input an uncorrect vf number&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Input an uncorrect vf number&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ip</span> <span class="o">==</span> <span class="s1">&#39;dsa&#39;</span><span class="p">:</span>
            <span class="n">dev_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dev_id</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">pf</span><span class="p">,</span> <span class="n">vf</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo </span><span class="si">{</span><span class="n">dev_id</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/devices/</span><span class="si">{</span><span class="n">dev_id</span><span class="si">}</span><span class="s1">/driver/unbind&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;echo 8086 </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dsa_id</span><span class="si">}</span><span class="s1"> &gt; /sys/bus/pci/drivers/vfio-pci/new_id&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lspci -s </span><span class="si">{</span><span class="n">dev_id</span><span class="si">}</span><span class="s1"> -k&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span></div>

    <span class="c1"># CentOS_VM-APIs</span>
<span class="c1">###############################################################################################</span>

<div class="viewcode-block" id="Accelerator.add_environment_to_file_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.add_environment_to_file_vm">[docs]</a>    <span class="k">def</span> <span class="nf">add_environment_to_file_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="n">check_key</span><span class="p">,</span> <span class="n">add_command</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: to check all keys in VM /root/.bashrc file, if not add environments variable to /root/.bashrc file</span>
<span class="sd">              Args:</span>
<span class="sd">                  qemu: Call VM Class RichHypervisor</span>
<span class="sd">                  vm_name: Run command on which VM</span>
<span class="sd">                  check_key: the name of environments variable</span>
<span class="sd">                  add_command: add environments variable to VM /root/.bashrc file</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Add key &#39;end&#39; to /root/.bashrc file</span>
<span class="sd">                        add_environment_to_file(qemu, vm_name, &#39;end&#39;, &#39;end=$((SECONDS+110))&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;cat /root/.bashrc&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">check_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;echo &#39;</span><span class="si">{</span><span class="n">add_command</span><span class="si">}</span><span class="s2">&#39; &gt;&gt; /root/.bashrc&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;source /root/.bashrc&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.add_environment_to_file_rich_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.add_environment_to_file_rich_vm">[docs]</a>    <span class="k">def</span> <span class="nf">add_environment_to_file_rich_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">,</span> <span class="n">check_key</span><span class="p">,</span> <span class="n">add_command</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: to check all keys in VM /root/.bashrc file, if not add environments variable to /root/.bashrc file</span>
<span class="sd">              Args:</span>
<span class="sd">                  qemu: Call VM Class RichHypervisor</span>
<span class="sd">                  vm_name: Run command on which VM</span>
<span class="sd">                  check_key: the name of environments variable</span>
<span class="sd">                  add_command: add environments variable to VM /root/.bashrc file</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Add key &#39;end&#39; to /root/.bashrc file</span>
<span class="sd">                        add_environment_to_file_rich_vm(qemu, &#39;end&#39;, &#39;end=$((SECONDS+110))&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">exec_res</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;cat /root/.bashrc&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">vm</span> <span class="ow">in</span> <span class="n">exec_res</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">exec_res</span><span class="p">[</span><span class="n">vm</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">check_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;echo &#39;</span><span class="si">{</span><span class="n">add_command</span><span class="si">}</span><span class="s2">&#39; &gt;&gt; /root/.bashrc&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
                <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm</span><span class="p">,</span> <span class="s1">&#39;source /root/.bashrc&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.check_device_in_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.check_device_in_vm">[docs]</a>    <span class="k">def</span> <span class="nf">check_device_in_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="n">device_ip</span><span class="p">,</span> <span class="n">vf_num</span><span class="p">,</span> <span class="n">mdev</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Check attached device in VM</span>
<span class="sd">              Args:</span>
<span class="sd">                  qemu: Call VM Class RichHypervisor</span>
<span class="sd">                  vm_name: Run command on which VM</span>
<span class="sd">                  device_ip: Which device need to check; eg: &#39;qat&#39;, &#39;blb&#39;, &#39;dsa&#39;</span>
<span class="sd">                  vf_num: How many vf attached to VM</span>
<span class="sd">                  mdev: Is SIOV device</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Check attached device in VM</span>
<span class="sd">                      check_device_in_vm(qemu, vm_name, &#39;qat&#39;, 16)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;lspci&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mdev</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">vf_num</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">device_ip</span> <span class="o">==</span> <span class="s1">&#39;qat&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;Intel Corporation Device </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s2">&quot;Can&#39;t detact attached device&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">device_ip</span> <span class="o">==</span> <span class="s1">&#39;dlb&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;Intel Corporation Device </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dlb_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s2">&quot;Can&#39;t detact attached device&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">device_ip</span> <span class="o">==</span> <span class="s1">&#39;dsa&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;Intel Corporation Device </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dsa_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s2">&quot;Can&#39;t detact attached device&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">device_ip</span> <span class="o">==</span> <span class="s1">&#39;qat&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__check_device_in_vm</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">vf_num</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Intel Corporation Device </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_vf_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">device_ip</span> <span class="o">==</span> <span class="s1">&#39;dlb&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__check_device_in_vm</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">vf_num</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Intel Corporation Device </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dlb_vf_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">device_ip</span> <span class="o">==</span> <span class="s1">&#39;qat&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;Intel Corporation Device </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_mdev_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s2">&quot;Can&#39;t detact attached device&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.check_device_in_rich_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.check_device_in_rich_vm">[docs]</a>    <span class="k">def</span> <span class="nf">check_device_in_rich_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">,</span> <span class="n">device_ip</span><span class="p">,</span> <span class="n">vf_num</span><span class="p">,</span> <span class="n">mdev</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Check attached device in VM</span>
<span class="sd">              Args:</span>
<span class="sd">                  qemu: Call VM Class RichHypervisor</span>
<span class="sd">                  vm_name: Run command on which VM</span>
<span class="sd">                  device_ip: Which device need to check; eg: &#39;qat&#39;, &#39;blb&#39;, &#39;dsa&#39;</span>
<span class="sd">                  vf_num: How many vf attached to VM</span>
<span class="sd">                  mdev: Is SIOV device</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Check attached device in VM</span>
<span class="sd">                      check_device_in_rich_vm(qemu, &#39;qat&#39;, 16)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;start check devices in every virtual machine&#39;</span><span class="p">)</span>
        <span class="n">exec_res</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;lspci&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">vm</span> <span class="ow">in</span> <span class="n">exec_res</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">exec_res</span><span class="p">[</span><span class="n">vm</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mdev</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">vf_num</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">device_ip</span> <span class="o">==</span> <span class="s1">&#39;qat&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;Intel Corporation Device </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s2">&quot;Can&#39;t detact attached device&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">device_ip</span> <span class="o">==</span> <span class="s1">&#39;dlb&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;Intel Corporation Device </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dlb_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s2">&quot;Can&#39;t detact attached device&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">device_ip</span> <span class="o">==</span> <span class="s1">&#39;dsa&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;Intel Corporation Device </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dsa_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s2">&quot;Can&#39;t detact attached device&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">device_ip</span> <span class="o">==</span> <span class="s1">&#39;qat&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__check_device_in_vm</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">vf_num</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Intel Corporation Device </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_vf_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">device_ip</span> <span class="o">==</span> <span class="s1">&#39;dlb&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__check_device_in_vm</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">vf_num</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Intel Corporation Device </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dlb_vf_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">device_ip</span> <span class="o">==</span> <span class="s1">&#39;qat&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;Intel Corporation Device </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_mdev_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s2">&quot;Can&#39;t detact attached device&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;check devices in every virtual machine successfully&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.dlb_install_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.dlb_install_vm">[docs]</a>    <span class="k">def</span> <span class="nf">dlb_install_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="n">ch_makefile</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: To install DLB driver in VM</span>
<span class="sd">              Args:</span>
<span class="sd">                  qemu: Call VM Class RichHypervisor</span>
<span class="sd">                  vm_name: Run command on which VM</span>
<span class="sd">                  ch_makefile: if need to modify DLB make file</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Modify Makefile and install DLB driver</span>
<span class="sd">                      dlb_install(qemu, vm_name, True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;mkdir -p </span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;rm -rf </span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">*&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">sut_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}{</span><span class="n">DLB_DRIVER_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">vm_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}{</span><span class="n">DLB_DRIVER_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">upload_to_vm</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="n">sut_file_dir</span><span class="p">,</span> <span class="n">vm_file_dir</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;if [ -e *.txz ]; then tar xvf *.txz; fi&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DLB_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;if [ -e *.zip ]; then unzip *.zip; fi&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DLB_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;mv dlb/* .&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DLB_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;rm -rf dlb&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DLB_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ch_makefile</span><span class="p">:</span>
            <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sed -i &#39;s/ccflags-y += -DCONFIG_INTEL_DLB2_SIOV/#  iccflags-y += -DCONFIG_INTEL_DLB2_SIOV/g&#39; </span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s2">driver/dlb2/Makefile&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">driver/dlb2/&#39;</span><span class="p">)</span>
        <span class="c1"># self.__check_error(err)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;rmmod dlb2&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">driver/dlb2/&#39;</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;insmod ./dlb2.ko&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">driver/dlb2/&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;lsmod | grep dlb2&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;dlb2&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Issue - dlb driver install fail&#39;</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">libdlb/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file_vm</span><span class="p">(</span><span class="n">qemu</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;LD_LIBRARY_PATH&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;export LD_LIBRARY_PATH=</span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">libdlb/&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Accelerator.dlb_install_rich_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.dlb_install_rich_vm">[docs]</a>    <span class="k">def</span> <span class="nf">dlb_install_rich_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">,</span> <span class="n">ch_makefile</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: To install DLB driver in VM</span>
<span class="sd">              Args:</span>
<span class="sd">                  qemu: Call VM Class RichHypervisor</span>
<span class="sd">                  vm_name: Run command on which VM</span>
<span class="sd">                  ch_makefile: if need to modify DLB make file</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Modify Makefile and install DLB driver</span>
<span class="sd">                      dlb_install_rich_vm(qemu, True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;start dlb driver in every virtual machine&#39;</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mkdir -p </span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rm -rf </span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">*&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">sut_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}{</span><span class="n">DLB_DRIVER_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">vm_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}{</span><span class="n">DLB_DRIVER_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">upload_to_rich_vm</span><span class="p">(</span><span class="n">sut_file_dir</span><span class="p">,</span> <span class="n">vm_file_dir</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;copy dlb driver to every virtual machine successfully&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;.*\.txz$&#39;</span><span class="p">,</span><span class="n">DLB_DRIVER_NAME</span><span class="p">):</span>
            <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;tar xvf </span><span class="si">{</span><span class="n">DLB_DRIVER_NAME</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DLB_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;unzip -o </span><span class="si">{</span><span class="n">DLB_DRIVER_NAME</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DLB_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">exec_res</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;find </span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s1"> -name &quot;driver&quot;&#39;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">vm</span> <span class="ow">in</span> <span class="n">exec_res</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">exec_res</span><span class="p">[</span><span class="n">vm</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cp -rf </span><span class="si">{</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> /home/BKCPkg/domains/accelerator/&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;unzip dlb driver in every virtual machine successfully&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ch_makefile</span><span class="p">:</span>
            <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s2">&quot;sed -i &#39;s/ccflags-y += -DCONFIG_INTEL_DLB2_SIOV/#  iccflags-y += -DCONFIG_INTEL_DLB2_SIOV/g&#39; /home/BKCPkg/domains/accelerator/dlb/driver/dlb2/Makefile&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">driver/dlb2/&#39;</span><span class="p">)</span>
        <span class="c1"># self.__check_error(err)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;install dlb driver in every virtual machine successfully&#39;</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;rmmod dlb2&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">driver/dlb2/&#39;</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;insmod ./dlb2.ko&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">driver/dlb2/&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;insmod dlb driver in every virtual machine successfully&#39;</span><span class="p">)</span>
        <span class="n">exec_res</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;lsmod | grep dlb2&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">vm</span> <span class="ow">in</span> <span class="n">exec_res</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">exec_res</span><span class="p">[</span><span class="n">vm</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;dlb2&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Issue - dlb driver install fail&#39;</span><span class="p">)</span>
        <span class="n">exec_res</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">libdlb/&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">vm</span> <span class="ow">in</span> <span class="n">exec_res</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">exec_res</span><span class="p">[</span><span class="n">vm</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file_rich_vm</span><span class="p">(</span><span class="n">qemu</span><span class="p">,</span> <span class="s1">&#39;LD_LIBRARY_PATH&#39;</span><span class="p">,</span> <span class="s1">&#39;export LD_LIBRARY_PATH=/home/BKCPkg/domains/accelerator/dlb/libdlb:$LD_LIBRARY_PATH&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;dlb driver show in every virtual machine correct&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.kernel_header_devel_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.kernel_header_devel_vm">[docs]</a>    <span class="k">def</span> <span class="nf">kernel_header_devel_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Install kernel-header and kernel-devel package in VM</span>
<span class="sd">              Args:</span>
<span class="sd">                  qemu: Call VM Class RichHypervisor</span>
<span class="sd">                  vm_name: Run command on which VM</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Install kernel-header and kernel-devel package in VM</span>
<span class="sd">                      kernel_header_devel_vm(qemu, vm_name)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;mkdir -p </span><span class="si">{</span><span class="n">KERNEL_HEADER_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;rm -rf </span><span class="si">{</span><span class="n">KERNEL_HEADER_PATH_L</span><span class="si">}</span><span class="s1">*&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="c1"># sut_file_dir = f&#39;{KERNEL_HEADER_PATH_L}{KERNEL_HEADER_NAME}&#39;</span>
        <span class="c1"># vm_file_dir = f&#39;{KERNEL_HEADER_PATH_L}{KERNEL_HEADER_NAME}&#39;</span>
        <span class="c1"># qemu.upload_to_vm(vm_name, sut_file_dir, vm_file_dir)</span>
        <span class="n">sut_file_dir1</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">KERNEL_DEVEL_PATH_L</span><span class="si">}{</span><span class="n">KERNEL_DEVEL_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">vm_file_dir1</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">KERNEL_DEVEL_PATH_L</span><span class="si">}{</span><span class="n">KERNEL_DEVEL_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">upload_to_vm</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="n">sut_file_dir1</span><span class="p">,</span> <span class="n">vm_file_dir1</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;rpm -ivh *.rpm --force --nodeps&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">KERNEL_DEVEL_PATH_L</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.kernel_header_internal_devel_rich_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.kernel_header_internal_devel_rich_vm">[docs]</a>    <span class="k">def</span> <span class="nf">kernel_header_internal_devel_rich_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">):</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mkdir -p </span><span class="si">{</span><span class="n">KERNEL_INTERNAL_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rm -rf </span><span class="si">{</span><span class="n">KERNEL_INTERNAL_PATH_L</span><span class="si">}</span><span class="s1">*&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">sut_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">KERNEL_INTERNAL_PATH_L</span><span class="si">}{</span><span class="n">KERNEL_INTERNAL_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">vm_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">KERNEL_INTERNAL_PATH_L</span><span class="si">}{</span><span class="n">KERNEL_INTERNAL_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">KERNEL_INTERNAL_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">KERNEL_INTERNAL_PATH_L</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">upload_to_rich_vm</span><span class="p">(</span><span class="n">sut_file_dir</span><span class="p">,</span> <span class="n">vm_file_dir</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;rpm -ivh *.rpm --force --nodeps&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span>
                                          <span class="n">cwd</span><span class="o">=</span><span class="n">KERNEL_INTERNAL_PATH_L</span><span class="p">)</span></div>


<div class="viewcode-block" id="Accelerator.kvm_kernel_header_devel_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.kvm_kernel_header_devel_vm">[docs]</a>    <span class="k">def</span> <span class="nf">kvm_kernel_header_devel_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kvm</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Install kernel-header and kernel-devel package in VM</span>
<span class="sd">              Args:</span>
<span class="sd">                  kvm: Call VM Class</span>
<span class="sd">                  vm_name: Run command on which VM</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Install kernel-header and kernel-devel package in VM</span>
<span class="sd">                      kvm_kernel_header_devel_vm(kvm, vm_name)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;mkdir -p </span><span class="si">{</span><span class="n">KERNEL_HEADER_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;rm -rf </span><span class="si">{</span><span class="n">KERNEL_HEADER_PATH_L</span><span class="si">}</span><span class="s1">*&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">sut_file_dir1</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">KERNEL_DEVEL_PATH_L</span><span class="si">}{</span><span class="n">KERNEL_DEVEL_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">vm_file_dir1</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">KERNEL_DEVEL_PATH_L</span><span class="si">}{</span><span class="n">KERNEL_DEVEL_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">upload_to_vm</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="n">sut_file_dir1</span><span class="p">,</span> <span class="n">vm_file_dir1</span><span class="p">)</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;rpm -ivh *.rpm --force --nodeps&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">KERNEL_DEVEL_PATH_L</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.kvm_add_environment_to_file_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.kvm_add_environment_to_file_vm">[docs]</a>    <span class="k">def</span> <span class="nf">kvm_add_environment_to_file_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kvm</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="n">check_key</span><span class="p">,</span> <span class="n">add_command</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: to check all keys in VM /root/.bashrc file, if not add environments variable to /root/.bashrc file</span>
<span class="sd">              Args:</span>
<span class="sd">                  qemu: Call VM Class kvm</span>
<span class="sd">                  vm_name: Run command on which VM</span>
<span class="sd">                  check_key: the name of environments variable</span>
<span class="sd">                  add_command: add environments variable to VM /root/.bashrc file</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Add key &#39;end&#39; to /root/.bashrc file</span>
<span class="sd">                        add_environment_to_file(kvm, vm_name, &#39;end&#39;, &#39;end=$((SECONDS+110))&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;cat /root/.bashrc&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">check_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;echo &#39;</span><span class="si">{</span><span class="n">add_command</span><span class="si">}</span><span class="s2">&#39; &gt;&gt; /root/.bashrc&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;source /root/.bashrc&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.kvm_qat_uninstall_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.kvm_qat_uninstall_vm">[docs]</a>    <span class="k">def</span> <span class="nf">kvm_qat_uninstall_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kvm</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: To uninstall QAT driver</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Uninstall QAT driver</span>
<span class="sd">                     kvm_qat_uninstall_vm()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s2">&quot;lsmod | grep &#39;qat\|usdm&#39; | wc -l&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">out</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">out</span> <span class="o">!=</span> <span class="s1">&#39;0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span>
                <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;reboot&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Case</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
                <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;make uninstall&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
                <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;sleep 180&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
                <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;make clean&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
                <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;sleep 180&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
                <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;make distclean&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
                <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;sleep 180&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s2">&quot;lsmod | grep &#39;qat\|usdm&#39; | wc -l&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
                                                         <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;0&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Issue - QAT driver still exist&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="Accelerator.kvm_qat_install_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.kvm_qat_install_vm">[docs]</a>    <span class="k">def</span> <span class="nf">kvm_qat_install_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kvm</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="n">execute_command</span><span class="o">=</span><span class="s1">&#39;./configure &#39;</span><span class="p">,</span> <span class="n">enable_sriov</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                      Purpose: To install QAT driver in VM</span>
<span class="sd">                      Args:</span>
<span class="sd">                          No</span>
<span class="sd">                      Returns:</span>
<span class="sd">                          No</span>
<span class="sd">                      Raises:</span>
<span class="sd">                          RuntimeError: If any errors</span>
<span class="sd">                      Example:</span>
<span class="sd">                          Simplest usage: install QAT driver</span>
<span class="sd">                              kvm_qat_install_vm()</span>
<span class="sd">                &quot;&quot;&quot;</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;mkdir -p </span><span class="si">{</span><span class="n">QAT_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;rm -rf </span><span class="si">{</span><span class="n">QAT_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">*&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">sut_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_DRIVER_PATH_L</span><span class="si">}{</span><span class="n">QAT_DRIVER_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">vm_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_DRIVER_PATH_L</span><span class="si">}{</span><span class="n">QAT_DRIVER_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">upload_to_vm</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="n">sut_file_dir</span><span class="p">,</span> <span class="n">vm_file_dir</span><span class="p">)</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;unzip </span><span class="si">{</span><span class="n">QAT_DRIVER_NAME</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;tar -zxvf *.tar.gz&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">enable_sriov</span><span class="p">:</span>
            <span class="n">execute_command</span> <span class="o">=</span> <span class="n">execute_command</span> <span class="o">+</span> <span class="s1">&#39; --enable-icp-sriov=guest&#39;</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="n">execute_command</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;sleep 60&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;make install&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;sleepp 120&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;make samples-install&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;sleep 120&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;lsmod | grep qat&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">enable_sriov</span><span class="p">:</span>
            <span class="n">key_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;qat_vqat&#39;</span><span class="p">,</span> <span class="s1">&#39;intel_qat&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">(</span><span class="n">key_list</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Issue - QAT driver install failed&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">key_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;qat_4xxx&#39;</span><span class="p">,</span> <span class="s1">&#39;intel_qat&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">(</span><span class="n">key_list</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Issue - QAT driver install failed&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.kvm_rpm_install_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.kvm_rpm_install_vm">[docs]</a>    <span class="k">def</span> <span class="nf">kvm_rpm_install_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kvm</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: To install rpm packages in VM</span>
<span class="sd">              Args:</span>
<span class="sd">                  kvm: Call VM Class</span>
<span class="sd">                  vm_name: Run command on which VM</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Install rpm packages in VM</span>
<span class="sd">                      kvm_rpm_install_vm(kvm, vm_name)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rpm_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;zlib-devel.x86_64 yasm systemd-devel boost-devel.x86_64 openssl-devel libnl3-devel gcc gcc-c++ libgudev.x86_64 libgudev-devel.x86_64 systemd* abrt-cli boost-devel.x86_64&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kvm_add_environment_to_file_vm</span><span class="p">(</span><span class="n">kvm</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;http_proxy&#39;</span><span class="p">,</span> <span class="s1">&#39;export http_proxy=http://proxy-iind.intel.com:911&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kvm_add_environment_to_file_vm</span><span class="p">(</span><span class="n">kvm</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;HTTP_PROXY&#39;</span><span class="p">,</span> <span class="s1">&#39;export HTTP_PROXY=http://proxy-iind.intel.com:911&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kvm_add_environment_to_file_vm</span><span class="p">(</span><span class="n">kvm</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;https_proxy&#39;</span><span class="p">,</span> <span class="s1">&#39;export https_proxy=http://proxy-iind.intel.com:911&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kvm_add_environment_to_file_vm</span><span class="p">(</span><span class="n">kvm</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;HTTPS_PROXY&#39;</span><span class="p">,</span> <span class="s1">&#39;export HTTPS_PROXY=http://proxy-iind.intel.com:911&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kvm_add_environment_to_file_vm</span><span class="p">(</span><span class="n">kvm</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;no_proxy&#39;</span><span class="p">,</span> <span class="s2">&quot;export no_proxy=&#39;localhost,127.0.0.1,intel.com,.intel.com&#39;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rpm</span> <span class="ow">in</span> <span class="n">rpm_list</span><span class="p">:</span>
            <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;yum -y install </span><span class="si">{</span><span class="n">rpm</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60000</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.kvm_qat_vm_mega_install"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.kvm_qat_vm_mega_install">[docs]</a>    <span class="k">def</span> <span class="nf">kvm_qat_vm_mega_install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kvm</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run QAT mega test on guest</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run QAT mega test</span>
<span class="sd">                      virsh_qat_vm_mega_install()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;pip3 install pexpect&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;yum install -y epel-release readline-devel  lz4-devel python3 xxhash-devel&#39;</span><span class="p">,</span>
                            <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">SAMPLE_CODE_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;mkdir -p </span><span class="si">{</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;rm -rf </span><span class="si">{</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="si">}</span><span class="s1">*&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">sut_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="si">}{</span><span class="n">SAMPLE_CODE_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">vm_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="si">}{</span><span class="n">SAMPLE_CODE_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">upload_to_vm</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="n">sut_file_dir</span><span class="p">,</span> <span class="n">vm_file_dir</span><span class="p">)</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;tar -zxf *.tar.gz&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="p">)</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;sleep 120&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="p">)</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;./build.sh&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="p">)</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;sleep 120&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">SAMPLE_CODE_PATH_L</span><span class="p">)</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">MEGA_CONF_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">PPEXPECT_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">PPEXPECT_MEGA_PATH_L</span><span class="p">)</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;mkdir -p </span><span class="si">{</span><span class="n">PPEXPECT_MEGA_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;rm -rf </span><span class="si">{</span><span class="n">PPEXPECT_MEGA_PATH_L</span><span class="si">}</span><span class="s1">*&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">sut_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">PPEXPECT_MEGA_PATH_L</span><span class="si">}{</span><span class="n">PPEXPECT_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">vm_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">PPEXPECT_MEGA_PATH_L</span><span class="si">}{</span><span class="n">PPEXPECT_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">upload_to_vm</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="n">sut_file_dir</span><span class="p">,</span> <span class="n">vm_file_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">MEGA_SCRIPT_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">MEGA_SCRIPT_PATH_L</span><span class="p">)</span>
        <span class="n">sut_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MEGA_SCRIPT_PATH_L</span><span class="si">}{</span><span class="n">MEGA_SCRIPT_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">vm_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MEGA_SCRIPT_PATH_L</span><span class="si">}{</span><span class="n">MEGA_SCRIPT_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">kvm</span><span class="o">.</span><span class="n">upload_to_vm</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="n">sut_file_dir</span><span class="p">,</span> <span class="n">vm_file_dir</span><span class="p">)</span></div>


<div class="viewcode-block" id="Accelerator.kernel_header_devel_rich_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.kernel_header_devel_rich_vm">[docs]</a>    <span class="k">def</span> <span class="nf">kernel_header_devel_rich_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Install kernel-header and kernel-devel package in VM</span>
<span class="sd">              Args:</span>
<span class="sd">                  qemu: Call VM Class RichHypervisor</span>
<span class="sd">                  vm_name: Run command on which VM</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Install kernel-header and kernel-devel package in VM</span>
<span class="sd">                      kernel_header_devel_rich_vm(qemu)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;start install kernel_devel to every virtual machine&#39;</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mkdir -p </span><span class="si">{</span><span class="n">KERNEL_HEADER_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rm -rf </span><span class="si">{</span><span class="n">KERNEL_HEADER_PATH_L</span><span class="si">}</span><span class="s1">*&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">sut_file_dir1</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">KERNEL_DEVEL_PATH_L</span><span class="si">}{</span><span class="n">KERNEL_DEVEL_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">vm_file_dir1</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">KERNEL_DEVEL_PATH_L</span><span class="si">}{</span><span class="n">KERNEL_DEVEL_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">upload_to_rich_vm</span><span class="p">(</span><span class="n">sut_file_dir1</span><span class="p">,</span> <span class="n">vm_file_dir1</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;rpm -ivh *.rpm --force --nodeps&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">KERNEL_DEVEL_PATH_L</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;install kernel_devel to every virtual machine successfully&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.modify_kernel_grub_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.modify_kernel_grub_vm">[docs]</a>    <span class="k">def</span> <span class="nf">modify_kernel_grub_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="n">vm_function</span><span class="p">,</span> <span class="n">add_or_remove</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Modify kernel grub file</span>
<span class="sd">              Args:</span>
<span class="sd">                  qemu: Call VM Class RichHypervisor</span>
<span class="sd">                  vm_name: Run command on which VM</span>
<span class="sd">                  vm_function: What config need to add/remove to grub file</span>
<span class="sd">                  add_or_remove: Is add or remove config file</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Add &#39;intel_iommu=on,sm_on iommu=on no5lvl&#39; function to kernel grub file in VM</span>
<span class="sd">                      modify_kernel_grub_vm(qemu, vm_name, &#39;intel_iommu=on,sm_on iommu=on no5lvl&#39;, True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;uname -r&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_or_remove</span><span class="p">:</span>
            <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;grubby --update-kernel=/boot/vmlinuz-</span><span class="si">{</span><span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2"> --args=&#39;</span><span class="si">{</span><span class="n">vm_function</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                                <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;reboot&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Case</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;cat /proc/cmdline&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">vm_function</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;modify kernel file fail&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;modify kernel file fail&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;grubby --update-kernel=/boot/vmlinuz-</span><span class="si">{</span><span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2"> --remove-args=&#39;</span><span class="si">{</span><span class="n">vm_function</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;reboot&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Case</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;cat /proc/cmdline&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">vm_function</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;modify kernel file fail&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;modify kernel file fail&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.qat_install_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.qat_install_vm">[docs]</a>    <span class="k">def</span> <span class="nf">qat_install_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="n">execute_command</span><span class="o">=</span><span class="s1">&#39;./configure &#39;</span><span class="p">,</span> <span class="n">enable_sriov</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: To install QAT driver in VM</span>
<span class="sd">              Args:</span>
<span class="sd">                  qemu: Call VM Class RichHypervisor</span>
<span class="sd">                  vm_name: Run command on which VM</span>
<span class="sd">                  enable_sriov: If enable sriov host function in VM</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: install QAT driver in VM</span>
<span class="sd">                      qat_install_vm(qemu, vm_name, False)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;mkdir -p </span><span class="si">{</span><span class="n">QAT_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;rm -rf </span><span class="si">{</span><span class="n">QAT_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">*&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">sut_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_DRIVER_PATH_L</span><span class="si">}{</span><span class="n">QAT_DRIVER_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">vm_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_DRIVER_PATH_L</span><span class="si">}{</span><span class="n">QAT_DRIVER_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">upload_to_vm</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="n">sut_file_dir</span><span class="p">,</span> <span class="n">vm_file_dir</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;unzip </span><span class="si">{</span><span class="n">QAT_DRIVER_NAME</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;tar -zxvf *.tar.gz&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">enable_sriov</span><span class="p">:</span>
            <span class="n">execute_command</span> <span class="o">=</span> <span class="n">execute_command</span> <span class="o">+</span> <span class="s1">&#39; --enable-icp-sriov=guest&#39;</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="n">execute_command</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;make install&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;make samples-install&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;lsmod | grep qat&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">enable_sriov</span><span class="p">:</span>
            <span class="n">key_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;qat_vqat&#39;</span><span class="p">,</span> <span class="s1">&#39;intel_qat&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">(</span><span class="n">key_list</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Issue - QAT driver install failed&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">key_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;qat_4xxx&#39;</span><span class="p">,</span> <span class="s1">&#39;intel_qat&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">(</span><span class="n">key_list</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Issue - QAT driver install failed&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.qat_install_rich_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.qat_install_rich_vm">[docs]</a>    <span class="k">def</span> <span class="nf">qat_install_rich_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">,</span> <span class="n">execute_command</span><span class="o">=</span><span class="s1">&#39;./configure &#39;</span><span class="p">,</span> <span class="n">enable_sriov</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: To install QAT driver in VM</span>
<span class="sd">              Args:</span>
<span class="sd">                  qemu: Call VM Class RichHypervisor</span>
<span class="sd">                  execute_command: Run command o</span>
<span class="sd">                  enable_sriov: If enable sriov host function in VM</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: install QAT driver in VM</span>
<span class="sd">                      qat_install_rich_vm(qemu, False)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;start install qat driver in every virtual machine&#39;</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mkdir -p </span><span class="si">{</span><span class="n">QAT_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rm -rf </span><span class="si">{</span><span class="n">QAT_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">*&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">sut_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_DRIVER_PATH_L</span><span class="si">}{</span><span class="n">QAT_DRIVER_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">vm_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_DRIVER_PATH_L</span><span class="si">}{</span><span class="n">QAT_DRIVER_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">upload_to_rich_vm</span><span class="p">(</span><span class="n">sut_file_dir</span><span class="p">,</span> <span class="n">vm_file_dir</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;copy qat driver to every virtual machine successfully&#39;</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;unzip </span><span class="si">{</span><span class="n">QAT_DRIVER_NAME</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;tar -zxvf *.tar.gz&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;qat driver successfully unzip in every virtual machine &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">enable_sriov</span><span class="p">:</span>
            <span class="n">execute_command</span> <span class="o">=</span> <span class="n">execute_command</span> <span class="o">+</span> <span class="s1">&#39; --enable-icp-sriov=guest&#39;</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="n">execute_command</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;make install&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;make samples-install&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">15</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;qat driver install successfully in every virtual machine&#39;</span><span class="p">)</span>
        <span class="n">exec_res</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;lsmod | grep qat&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">vm</span> <span class="ow">in</span> <span class="n">exec_res</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">exec_res</span><span class="p">[</span><span class="n">vm</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">exec_res</span><span class="p">[</span><span class="n">vm</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">enable_sriov</span><span class="p">:</span>
                <span class="n">key_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;qat_vqat&#39;</span><span class="p">,</span> <span class="s1">&#39;intel_qat&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">(</span><span class="n">key_list</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Issue - QAT driver install failed&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">key_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;qat_4xxx&#39;</span><span class="p">,</span> <span class="s1">&#39;intel_qat&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">(</span><span class="n">key_list</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Issue - QAT driver install failed&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;qat driver show successfully in every virtual machine&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.qat_uninstall_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.qat_uninstall_vm">[docs]</a>    <span class="k">def</span> <span class="nf">qat_uninstall_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: To uninstall QAT driver</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Uninstall QAT driver</span>
<span class="sd">                      qat_uninstall()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s2">&quot;lsmod | grep &#39;qat\|usdm&#39; | wc -l&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">out</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">out</span> <span class="o">!=</span> <span class="s1">&#39;0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span>
                <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;reboot&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Case</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
                <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;make uninstall&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
                <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;make clean&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
                <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;make distclean&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s2">&quot;lsmod | grep &#39;qat\|usdm&#39; | wc -l&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
                                                         <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_L</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;0&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Issue - QAT driver still exist&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span></div>



<div class="viewcode-block" id="Accelerator.run_dpdk_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.run_dpdk_vm">[docs]</a>    <span class="k">def</span> <span class="nf">run_dpdk_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Install and Run DPDK test in VM</span>
<span class="sd">              Args:</span>
<span class="sd">                  qemu: Call VM Class RichHypervisor</span>
<span class="sd">                  vm_name: Run command on which VM</span>
<span class="sd">              Returns:</span>
<span class="sd">                  None</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Install and Run DPDK test in VM</span>
<span class="sd">                      run_dpdk_vm(qemu, vm_name)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;mkdir -p </span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="c1"># qemu.execute_vm_cmd(vm_name, f&#39;rm -rf {DLB_DRIVER_PATH_L}*&#39;, timeout=60)</span>
        <span class="n">sut_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}{</span><span class="n">DLB_DRIVER_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">vm_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_L</span><span class="si">}{</span><span class="n">DLB_DRIVER_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">upload_to_vm</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="n">sut_file_dir</span><span class="p">,</span> <span class="n">vm_file_dir</span><span class="p">)</span>
        <span class="c1"># qemu.execute_vm_cmd(vm_name, &#39;unzip *.zip&#39;, timeout=60, cwd=DLB_DRIVER_PATH_L)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">DPDK_DRIVER_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;mkdir -p </span><span class="si">{</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;rm -rf </span><span class="si">{</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">*&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">sut_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="si">}{</span><span class="n">DPDK_DRIVER_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">vm_file_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="si">}{</span><span class="n">DPDK_DRIVER_NAME</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">upload_to_vm</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="n">sut_file_dir</span><span class="p">,</span> <span class="n">vm_file_dir</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;unzip *.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;tar xfJ *.tar.xz&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;patch -Np1 &lt; /home/BKCPkg/domains/accelerator/dlb/dpdk/*.patch&#39;</span><span class="p">,</span>
                                          <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
        <span class="c1"># self.check_keyword([&#39;succeeded&#39;], out, &#39;DPDK load patch fail&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file_vm</span><span class="p">(</span><span class="n">qemu</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;DPDK_DIR&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;export DPDK_DIR=/home/BKCPkg/domains/accelerator/dpdk/*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file_vm</span><span class="p">(</span><span class="n">qemu</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;RTE_SDK&#39;</span><span class="p">,</span> <span class="s1">&#39;export RTE_SDK=$DPDK_DIR&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file_vm</span><span class="p">(</span><span class="n">qemu</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;RTE_TARGET&#39;</span><span class="p">,</span> <span class="s1">&#39;export RTE_TARGET=installdir&#39;</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;yum install -y meson python3-pyelftools&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;meson setup --prefix $RTE_SDK/$RTE_TARGET builddir&#39;</span><span class="p">,</span>
                                          <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;ninja -C builddir&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;mkdir -p /mnt/hugepages&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;mount -t hugetlbfs nodev /mnt/hugepages&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
                            <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;echo 2048 &gt; /proc/sys/vm/nr_hugepages&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DPDK_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.rpm_install_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.rpm_install_vm">[docs]</a>    <span class="k">def</span> <span class="nf">rpm_install_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: To install rpm packages in VM</span>
<span class="sd">              Args:</span>
<span class="sd">                  qemu: Call VM Class RichHypervisor</span>
<span class="sd">                  vm_name: Run command on which VM</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Install rpm packages in VM</span>
<span class="sd">                      rpm_install_vm(qemu, vm_name)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rpm_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;zlib-devel.x86_64 yasm systemd-devel boost-devel.x86_64 openssl-devel libnl3-devel gcc gcc-c++ libgudev.x86_64 libgudev-devel.x86_64 systemd* abrt-cli boost-devel.x86_64&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file_vm</span><span class="p">(</span><span class="n">qemu</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;http_proxy&#39;</span><span class="p">,</span> <span class="s1">&#39;export http_proxy=http://proxy-iind.intel.com:911&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file_vm</span><span class="p">(</span><span class="n">qemu</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;HTTP_PROXY&#39;</span><span class="p">,</span> <span class="s1">&#39;export HTTP_PROXY=http://proxy-iind.intel.com:911&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file_vm</span><span class="p">(</span><span class="n">qemu</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;https_proxy&#39;</span><span class="p">,</span> <span class="s1">&#39;export https_proxy=http://proxy-iind.intel.com:911&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file_vm</span><span class="p">(</span><span class="n">qemu</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;HTTPS_PROXY&#39;</span><span class="p">,</span> <span class="s1">&#39;export HTTPS_PROXY=http://proxy-iind.intel.com:911&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file_vm</span><span class="p">(</span><span class="n">qemu</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;no_proxy&#39;</span><span class="p">,</span> <span class="s2">&quot;export no_proxy=&#39;localhost,127.0.0.1,intel.com,.intel.com&#39;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rpm</span> <span class="ow">in</span> <span class="n">rpm_list</span><span class="p">:</span>
            <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;yum -y install </span><span class="si">{</span><span class="n">rpm</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60000</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;yum -y install make&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60000</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;yum -y install patch&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60000</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.rpm_install_rich_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.rpm_install_rich_vm">[docs]</a>    <span class="k">def</span> <span class="nf">rpm_install_rich_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: To install rpm packages in VM</span>
<span class="sd">              Args:</span>
<span class="sd">                  qemu: Call VM Class RichHypervisor</span>
<span class="sd">                  vm_name: Run command on which VM</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Install rpm packages in VM</span>
<span class="sd">                      rpm_install_rich_vm(qemu)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;start yum install packages to every virtual machine&#39;</span><span class="p">)</span>
        <span class="n">rpm_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;zlib-devel.x86_64 yasm systemd-devel boost-devel.x86_64 openssl-devel libnl3-devel gcc gcc-c++ libgudev.x86_64 libgudev-devel.x86_64 systemd* abrt-cli boost-devel.x86_64&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file_rich_vm</span><span class="p">(</span><span class="n">qemu</span><span class="p">,</span> <span class="s1">&#39;http_proxy&#39;</span><span class="p">,</span> <span class="s1">&#39;export http_proxy=http://proxy-iind.intel.com:911&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file_rich_vm</span><span class="p">(</span><span class="n">qemu</span><span class="p">,</span> <span class="s1">&#39;HTTP_PROXY&#39;</span><span class="p">,</span> <span class="s1">&#39;export HTTP_PROXY=http://proxy-iind.intel.com:911&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file_rich_vm</span><span class="p">(</span><span class="n">qemu</span><span class="p">,</span> <span class="s1">&#39;https_proxy&#39;</span><span class="p">,</span> <span class="s1">&#39;export https_proxy=http://proxy-iind.intel.com:911&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file_rich_vm</span><span class="p">(</span><span class="n">qemu</span><span class="p">,</span> <span class="s1">&#39;HTTPS_PROXY&#39;</span><span class="p">,</span> <span class="s1">&#39;export HTTPS_PROXY=http://proxy-iind.intel.com:911&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_environment_to_file_rich_vm</span><span class="p">(</span><span class="n">qemu</span><span class="p">,</span> <span class="s1">&#39;no_proxy&#39;</span><span class="p">,</span> <span class="s2">&quot;export no_proxy=&#39;localhost,127.0.0.1,intel.com,.intel.com&#39;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rpm</span> <span class="ow">in</span> <span class="n">rpm_list</span><span class="p">:</span>
            <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;yum -y install </span><span class="si">{</span><span class="n">rpm</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60000</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;yum install packages to every virtual machine successfully&#39;</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;yum -y install make&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60000</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;yum -y install patch&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60000</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.run_qat_sample_code_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.run_qat_sample_code_vm">[docs]</a>    <span class="k">def</span> <span class="nf">run_qat_sample_code_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="n">qat_cpa_param</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run QAT cap_sample stress on VM</span>
<span class="sd">              Args:</span>
<span class="sd">                  qemu: Call VM Class RichHypervisor</span>
<span class="sd">                  vm_name: Run command on which VM</span>
<span class="sd">                  qat_cpa_param: Which cap_sample stress need to run</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: run cap_sample stress</span>
<span class="sd">                        run_qat_sample_code(qemu, vm_name, &#39;&#39;)</span>
<span class="sd">                        run_qat_sample_code(qemu, vm_name, &#39;signOfLife=1&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;./cpa_sample_code &#39;</span> <span class="o">+</span> <span class="n">qat_cpa_param</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">/build/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;Sample code completed successfully&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Issue - Run qat stress fail&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.run_qat_sample_code_rich_vm"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.run_qat_sample_code_rich_vm">[docs]</a>    <span class="k">def</span> <span class="nf">run_qat_sample_code_rich_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">,</span> <span class="n">qat_cpa_param</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run QAT cap_sample stress on VM</span>
<span class="sd">              Args:</span>
<span class="sd">                  qemu: Call VM Class RichHypervisor</span>
<span class="sd">                  vm_name: Run command on which VM</span>
<span class="sd">                  qat_cpa_param: Which cap_sample stress need to run</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: run cap_sample stress</span>
<span class="sd">                        run_qat_sample_code_rich_vm(qemu, &#39;&#39;)</span>
<span class="sd">                        run_qat_sample_code_rich_vm(qemu, &#39;signOfLife=1&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;start run qat stress in every virtual machine&#39;</span><span class="p">)</span>
        <span class="n">exec_res</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;./cpa_sample_code &#39;</span> <span class="o">+</span> <span class="n">qat_cpa_param</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">/build/&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">vm</span> <span class="ow">in</span> <span class="n">exec_res</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">exec_res</span><span class="p">[</span><span class="n">vm</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;Sample code completed successfully&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Issue - Run qat stress fail&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;run qat stress in every virtual machine successfully&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.run_qat_sample_code_vm_async"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.run_qat_sample_code_vm_async">[docs]</a>    <span class="k">def</span> <span class="nf">run_qat_sample_code_vm_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">,</span> <span class="n">qat_cpa_param</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run qat sample stress asynchronously in vm</span>
<span class="sd">              Args:</span>
<span class="sd">                  qemu: Call VM Class RichHypervisor</span>
<span class="sd">                  vm_name: Run command on which VM</span>
<span class="sd">                  qat_cpa_param: Which cap_sample stress need to run</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: run cap_sample stress</span>
<span class="sd">                        run_qat_sample_code(qemu, vm_name, &#39;&#39;)</span>
<span class="sd">                        run_qat_sample_code(qemu, vm_name, &#39;signOfLife=1&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd_async</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;./cpa_sample_code &#39;</span> <span class="o">+</span> <span class="n">qat_cpa_param</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">QAT_DRIVER_PATH_L</span><span class="si">}</span><span class="s1">/build/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;Sample code completed successfully&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;Issue - Run qat stress fail&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.run_qat_stress_vm_async"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.run_qat_stress_vm_async">[docs]</a>    <span class="k">def</span> <span class="nf">run_qat_stress_vm_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run QAT asynchronous stress overnight in VM</span>
<span class="sd">              Args:</span>
<span class="sd">                  qemu: Call VM Class RichHypervisor</span>
<span class="sd">                  vm_name: Run command on which VM</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run QAT asynchronous stress overnight in VM</span>
<span class="sd">                        run_qat_stress_vm_async(qemu, vm_name)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd_async</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span> <span class="s1">&#39;rm -rf qat_vm_async.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root/&#39;</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_vm_cmd_async</span><span class="p">(</span><span class="n">vm_name</span><span class="p">,</span>
                                  <span class="s1">&#39;while [ $SECONDS -lt 300 ]; do /home/BKCPkg/domains/accelerator/QAT/build/cpa_sample_code runTests=63 signOfLife=1 ; done | tee /root/qat_vm_async.log&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Accelerator.run_qat_stress_rich_vm_async"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.run_qat_stress_rich_vm_async">[docs]</a>    <span class="k">def</span> <span class="nf">run_qat_stress_rich_vm_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qemu</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Run QAT asynchronous stress overnight in VM</span>
<span class="sd">              Args:</span>
<span class="sd">                  qemu: Call VM Class RichHypervisor</span>
<span class="sd">                  vm_name: Run command on which VM</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Run QAT asynchronous stress overnight in VM</span>
<span class="sd">                        run_qat_stress_vm_async(qemu, vm_name)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel</span><span class="p">(</span><span class="s1">&#39;rm -rf qat_vm_async.log&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/root/&#39;</span><span class="p">)</span>
        <span class="n">qemu</span><span class="o">.</span><span class="n">execute_rich_vm_cmd_parallel_async</span><span class="p">(</span><span class="s1">&#39;while [ $SECONDS -lt 100 ]; do /home/BKCPkg/domains/accelerator/QAT/build/cpa_sample_code runTests=63 signOfLife=1 ; done | tee /root/qat_vm_async.log&#39;</span><span class="p">)</span></div>

    <span class="c1"># VMware-APIs</span>
<span class="c1">#################################################################################################</span>

<div class="viewcode-block" id="Accelerator.check_acce_device_esxi"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.check_acce_device_esxi">[docs]</a>    <span class="k">def</span> <span class="nf">check_acce_device_esxi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acce_module_name</span><span class="p">,</span> <span class="n">cpu_num</span><span class="p">,</span> <span class="n">is_driver_installed</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">             Purpose: Check accelerator device status</span>
<span class="sd">             Args:</span>
<span class="sd">                 acce_module_name: this is accelerator device name, eg: &#39;qat&#39;, &#39;dlb&#39;, &#39;iadx&#39;</span>
<span class="sd">                 is_driver_installed: check driver installed or not</span>
<span class="sd">             Returns:</span>
<span class="sd">                 No</span>
<span class="sd">             Raises:</span>
<span class="sd">                 RuntimeError: If any errors</span>
<span class="sd">             Example:</span>
<span class="sd">                 Simplest usage: Get CPU number in BIOS serial log</span>
<span class="sd">                     get_cpu_num_esxi()</span>
<span class="sd">       &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">acce_module_name</span> <span class="o">==</span> <span class="s1">&#39;qat&#39;</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lspci -p | grep 8086:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__detact_device_in_esxi</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">],</span> <span class="s1">&#39;qat&#39;</span><span class="p">,</span> <span class="n">cpu_num</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_driver_installed</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__detact_device_in_esxi</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;qat&#39;</span><span class="p">],</span> <span class="s1">&#39;qat&#39;</span><span class="p">,</span> <span class="n">cpu_num</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">acce_module_name</span> <span class="o">==</span> <span class="s1">&#39;dlb&#39;</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lspci -p | grep 8086:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dlb_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__detact_device_in_esxi</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dlb_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">],</span> <span class="s1">&#39;dlb&#39;</span><span class="p">,</span> <span class="n">cpu_num</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_driver_installed</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__detact_device_in_esxi</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dlb_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;dlb&#39;</span><span class="p">],</span> <span class="s1">&#39;dlb&#39;</span><span class="p">,</span> <span class="n">cpu_num</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">acce_module_name</span> <span class="o">==</span> <span class="s1">&#39;iadx&#39;</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lspci -p | grep 8086:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dsa_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__detact_device_in_esxi</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dsa_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">],</span> <span class="s1">&#39;dsa&#39;</span><span class="p">,</span> <span class="n">cpu_num</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_driver_installed</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__detact_device_in_esxi</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dsa_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;iadx&#39;</span><span class="p">],</span> <span class="s1">&#39;dsa&#39;</span><span class="p">,</span> <span class="n">cpu_num</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">acce_module_name</span> <span class="o">==</span> <span class="s1">&#39;iads&#39;</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lspci -p | grep 8086:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dsa_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__detact_device_in_esxi</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dsa_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">],</span> <span class="s1">&#39;dsa&#39;</span><span class="p">,</span> <span class="n">cpu_num</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_driver_installed</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__detact_device_in_esxi</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dsa_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;iads&#39;</span><span class="p">],</span> <span class="s1">&#39;dsa&#39;</span><span class="p">,</span> <span class="n">cpu_num</span><span class="p">)</span></div>
<div class="viewcode-block" id="Accelerator.dsa_driver_install_esxi"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.dsa_driver_install_esxi">[docs]</a>    <span class="k">def</span> <span class="nf">dsa_driver_install_esxi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: To install DSA driver</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Install DSA driver</span>
<span class="sd">                      dsa_driver_install_esxi()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mkdir -p </span><span class="si">{</span><span class="n">DSA_DRIVER_PATH_V</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span> <span class="c1">#add by jin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DSA_DRIVER_PATH_V</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">DSA_DRIVER_V_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">DSA_DRIVER_PATH_V</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;unzip -j *.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DSA_DRIVER_PATH_V</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;tar -xvf *.tar&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DSA_DRIVER_PATH_V</span><span class="p">)</span> <span class="c1">#add by jin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;unzip VMW-esx-*.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DSA_DRIVER_PATH_V</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;esxcli software vib install --maintenance-mode --no-sig-check -v </span><span class="si">{</span><span class="n">DSA_DRIVER_PATH_V</span><span class="si">}</span><span class="s1">vib20/iads/INT*.vib&#39;</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;Operation finished successfully&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;DSA driver install fail&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__load_driver</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">my_os</span><span class="o">.</span><span class="n">warm_reset_cycle_step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Case</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_acce_driver</span><span class="p">(</span><span class="s1">&#39;iads&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.dlb_driver_install_esxi"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.dlb_driver_install_esxi">[docs]</a>    <span class="k">def</span> <span class="nf">dlb_driver_install_esxi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_siov</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: To install dlb driver</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Install dlb driver</span>
<span class="sd">                      dlb_driver_install_esxi()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DLB_DRIVER_PATH_V</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">DLB_DRIVER_V_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">DLB_DRIVER_PATH_V</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;unzip *.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DLB_DRIVER_PATH_V</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;ls  *.tar.gz&#39;</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="s1">&#39;/home/BKCPkg/domains/accelerator/dlb&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">line</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)):</span>
            <span class="k">if</span> <span class="s1">&#39;dvx&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="n">a</span><span class="p">]:</span>
                <span class="n">siov_tool</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sriov_tool</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">is_siov</span><span class="p">:</span>
            <span class="c1"># self.sut.execute_shell_cmd(&#39;tar -zxvf dlb_siov_*.tar.gz&#39;, timeout=60, cwd=DLB_DRIVER_PATH_V)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;tar -zxvf </span><span class="si">{</span><span class="n">siov_tool</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DLB_DRIVER_PATH_V</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Case</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;esxcli software component apply --no-sig-check -d </span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_V</span><span class="si">}</span><span class="s1">INT-esx*.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;The update completed successfully&#39;</span><span class="p">,</span> <span class="s1">&#39;Reboot Required: true&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span>
                               <span class="s1">&#39;dlb driver install fail&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">my_os</span><span class="o">.</span><span class="n">warm_reset_cycle_step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__check_acce_driver</span><span class="p">(</span><span class="s1">&#39;dlb&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># self.sut.execute_shell_cmd(&#39;tar -zxvf dlb_sriov_*.tar.gz&#39;, timeout=60, cwd=DLB_DRIVER_PATH_V)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;tar -zxvf </span><span class="si">{</span><span class="n">sriov_tool</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">DLB_DRIVER_PATH_V</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;esxcli software component apply --no-sig-check -d </span><span class="si">{</span><span class="n">DLB_DRIVER_PATH_V</span><span class="si">}</span><span class="s1">VMW*.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;The update completed successfully&#39;</span><span class="p">,</span> <span class="s1">&#39;Reboot Required: true&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span>
                               <span class="s1">&#39;dlb driver install fail&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">my_os</span><span class="o">.</span><span class="n">warm_reset_cycle_step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Case</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__check_acce_driver</span><span class="p">(</span><span class="s1">&#39;dlb&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.get_cpu_num_esxi"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.get_cpu_num_esxi">[docs]</a>    <span class="k">def</span> <span class="nf">get_cpu_num_esxi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">             Purpose: Get CPU number in BIOS serial log</span>
<span class="sd">             Args:</span>
<span class="sd">                 No</span>
<span class="sd">             Returns:</span>
<span class="sd">                 No</span>
<span class="sd">             Raises:</span>
<span class="sd">                 RuntimeError: If any errors</span>
<span class="sd">             Example:</span>
<span class="sd">                 Simplest usage: Get CPU number in BIOS serial log</span>
<span class="sd">                     get_cpu_num_esxi()</span>
<span class="sd">       &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;reboot&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="c1"># self.Case.wait_and_expect(f&#39;SUT in OS&#39;, 10 * 60, self.sut.check_system_in_os)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Case</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">bios_log</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LOG_PATH</span><span class="p">,</span> <span class="s1">&#39;bios.log&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">bios_log</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">line_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">())</span>
            <span class="n">file_list</span> <span class="o">=</span> <span class="n">line_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;Calculate Resource Allocation - END&#39;</span><span class="p">)</span>
            <span class="n">cpu_info</span> <span class="o">=</span> <span class="n">file_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;CPU Resource Allocation&#39;</span><span class="p">)</span>
            <span class="n">line_list</span> <span class="o">=</span> <span class="n">cpu_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">cpu_num</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;CPU&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">cpu_num</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">cpu_num</span></div>

<div class="viewcode-block" id="Accelerator.qat_driver_install_esxi"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.qat_driver_install_esxi">[docs]</a>    <span class="k">def</span> <span class="nf">qat_driver_install_esxi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: To install QAT driver</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Install QAT driver</span>
<span class="sd">                      qat_driver_install_esxi</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;rm -rf *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_V</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">upload_to_remote</span><span class="p">(</span><span class="n">localpath</span><span class="o">=</span><span class="n">QAT_DRIVER_V_H</span><span class="p">,</span> <span class="n">remotepath</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_V</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;unzip *.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">QAT_DRIVER_PATH_V</span><span class="p">)</span>
        <span class="c1"># self.sut.execute_shell_cmd(&#39;tar -zxvf *.tar.gz&#39;, timeout=60, cwd=QAT_DRIVER_PATH_V)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;esxcli software component apply --no-sig-check -d </span><span class="si">{</span><span class="n">QAT_DRIVER_PATH_V</span><span class="si">}</span><span class="s1">qat-*/*.zip&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;Installed: Intel-qat&#39;</span><span class="p">,</span> <span class="s1">&#39;Operation finished successfully&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span>
                           <span class="s1">&#39;QAT driver install fail&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__load_driver</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">my_os</span><span class="o">.</span><span class="n">warm_reset_cycle_step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Case</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_acce_driver</span><span class="p">(</span><span class="s1">&#39;qat&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Accelerator.uninstall_driver_esxi"><a class="viewcode-back" href="../../lib.html#lib.accelerator.Accelerator.uninstall_driver_esxi">[docs]</a>    <span class="k">def</span> <span class="nf">uninstall_driver_esxi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acce_module_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: To uninstall accelerator device driver</span>
<span class="sd">              Args:</span>
<span class="sd">                  acce_module_name: this is accelerator device name, eg: &#39;qat&#39;, &#39;dlb&#39;, &#39;iadx&#39;</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Uninstall accelerator device driver</span>
<span class="sd">                      uninstall_driver_esxi()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">acce_module_name</span> <span class="o">==</span> <span class="s1">&#39;qat&#39;</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;esxcfg-module -u </span><span class="si">{</span><span class="n">acce_module_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;Module </span><span class="si">{</span><span class="n">acce_module_name</span><span class="si">}</span><span class="s1"> unloaded successfully&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;uninstall driver fail&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;esxcli software component remove -n Intel-</span><span class="si">{</span><span class="n">acce_module_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;Components Removed: Intel-</span><span class="si">{</span><span class="n">acce_module_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;Operation finished successfully&#39;</span><span class="p">],</span>
                               <span class="n">out</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;uninstall </span><span class="si">{</span><span class="n">acce_module_name</span><span class="si">}</span><span class="s1"> driver fail&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">acce_module_name</span> <span class="o">==</span> <span class="s1">&#39;dlb&#39;</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;esxcfg-module -u </span><span class="si">{</span><span class="n">acce_module_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;Module </span><span class="si">{</span><span class="n">acce_module_name</span><span class="si">}</span><span class="s1"> unloaded successfully&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;uninstall driver fail&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;esxcli software component remove -n Intel-</span><span class="si">{</span><span class="n">acce_module_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;Components Removed: Intel-</span><span class="si">{</span><span class="n">acce_module_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;The update completed successfully, but the system needs to be rebooted for the changes to be effective.&#39;</span><span class="p">],</span>
                               <span class="n">out</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;uninstall </span><span class="si">{</span><span class="n">acce_module_name</span><span class="si">}</span><span class="s1"> driver fail&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">my_os</span><span class="o">.</span><span class="n">warm_reset_cycle_step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">acce_module_name</span> <span class="o">==</span> <span class="s1">&#39;iadx&#39;</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;vmkload_mod --unload </span><span class="si">{</span><span class="n">acce_module_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;Module </span><span class="si">{</span><span class="n">acce_module_name</span><span class="si">}</span><span class="s1"> successfully unloaded&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;uninstall driver fail&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;esxcli software vib remove --maintenance-mode -n </span><span class="si">{</span><span class="n">acce_module_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;Operation finished successfully&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span>
                               <span class="sa">f</span><span class="s1">&#39;uninstall </span><span class="si">{</span><span class="n">acce_module_name</span><span class="si">}</span><span class="s1"> driver fail&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">acce_module_name</span> <span class="o">==</span> <span class="s1">&#39;iads&#39;</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;vmkload_mod --unload </span><span class="si">{</span><span class="n">acce_module_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;Module </span><span class="si">{</span><span class="n">acce_module_name</span><span class="si">}</span><span class="s1"> successfully unloaded&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="s1">&#39;uninstall driver fail&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;esxcli software vib remove --maintenance-mode -n </span><span class="si">{</span><span class="n">acce_module_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="s1">&#39;Operation finished successfully&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span>
                               <span class="sa">f</span><span class="s1">&#39;uninstall </span><span class="si">{</span><span class="n">acce_module_name</span><span class="si">}</span><span class="s1"> driver fail&#39;</span><span class="p">)</span></div>

<span class="c1">#############################################################################################################</span>

    <span class="k">def</span> <span class="nf">__cc6_value_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
        <span class="n">cpu_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_num</span><span class="p">()</span>
        <span class="n">core_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_core_num</span><span class="p">()</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;CC6&#39;</span><span class="p">)</span>
        <span class="n">cc6_line_list</span> <span class="o">=</span> <span class="n">line_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;Core C-State Summary: Entry Counts&#39;</span><span class="p">)</span>
        <span class="n">word_list</span> <span class="o">=</span> <span class="n">cc6_line_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">value_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">word_list</span><span class="p">:</span>
            <span class="n">value_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">less_100_value_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">value_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">word</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">100.00</span><span class="p">:</span>
                <span class="n">less_100_value_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
        <span class="n">cc6_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">less_100_value_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">70</span><span class="p">:</span>
                <span class="n">cc6_num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">cc6_num</span> <span class="o">!=</span> <span class="n">cpu_num</span> <span class="o">*</span> <span class="n">core_num</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Not all core CC6 Residency value more than 70%&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not all core CC6 Residency value more than 70%&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__check_acce_driver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acce_module_name</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;esxcfg-module -l | grep </span><span class="si">{</span><span class="n">acce_module_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_keyword</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">acce_module_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span> <span class="n">out</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;detect </span><span class="si">{</span><span class="n">acce_module_name</span><span class="si">}</span><span class="s1"> driver fail&#39;</span><span class="p">)</span>

    <span class="c1"># def __check_all_device_wq(self, cpu_num, device_num, out):</span>
    <span class="c1">#     line_list = out.strip().split(&#39;\n&#39;)</span>
    <span class="c1">#     dsa_enable_num = 0</span>
    <span class="c1">#     for line in line_list:</span>
    <span class="c1">#         if &#39;&quot;state&quot;:&quot;enabled&quot;&#39; in line:</span>
    <span class="c1">#             dsa_enable_num += 1</span>
    <span class="c1">#     if dsa_enable_num != cpu_num * device_num * 9:</span>
    <span class="c1">#         logger.error(&#39;Not all dsa grouped_workqueues are enabled&#39;)</span>
    <span class="c1">#         raise Exception(&#39;Not all dsa grouped_workqueues are enabled&#39;)</span>


    <span class="k">def</span> <span class="nf">__check_all_device_wq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">device_num</span><span class="p">,</span> <span class="n">acce_ip</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;&quot;state&quot;:&quot;disabled&quot;&#39;</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Some disabled wq are showed&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Some disabled wq are showed&#39;</span><span class="p">)</span>
        <span class="n">enabled_device_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;&quot;dev&quot;:&quot;</span><span class="si">{</span><span class="n">acce_ip</span><span class="si">}</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">enabled_device_num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">device_num</span> <span class="o">!=</span> <span class="n">enabled_device_num</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Not all device are detected&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not all device are detected&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__check_enabled_wq_num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;Enabling&#39;</span><span class="p">)</span>
        <span class="n">work_queues_list</span> <span class="o">=</span> <span class="n">line_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;enabled&#39;</span><span class="p">)</span>
        <span class="n">queues_word_list</span> <span class="o">=</span> <span class="n">work_queues_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">queues_word_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__check_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">err</span><span class="p">):</span>
        <span class="c1"># Ignore CryptographyDeprecationWarning messages from paramiko</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="s1">&#39;CryptographyDeprecationWarning&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__check_device_in_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">vf_num</span><span class="p">,</span> <span class="n">check_key</span><span class="p">):</span>
        <span class="n">dev_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">check_key</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">dev_num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">dev_num</span> <span class="o">!=</span> <span class="n">vf_num</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Can&#39;t detact attached device&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Can&#39;t detact attached device&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__check_random_device_wq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">device_num</span><span class="p">,</span> <span class="n">acce_ip</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;&quot;state&quot;:&quot;disabled&quot;&#39;</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Some disabled wq are showed&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Some disabled wq are showed&#39;</span><span class="p">)</span>
        <span class="n">enabled_device_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;&quot;dev&quot;:&quot;</span><span class="si">{</span><span class="n">acce_ip</span><span class="si">}</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">enabled_device_num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">device_num</span> <span class="o">!=</span> <span class="n">enabled_device_num</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Not all device are detected&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not all device are detected&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__choose_run_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">is_reset_folder</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_reset_folder</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;chmod 777 *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SPR_ACCE_RANDOM_CONFIG_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;./</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SPR_ACCE_RANDOM_CONFIG_PATH_L</span><span class="si">}</span><span class="s1">*/&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;chmod 777 *&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SPR_ACCE_RANDOM_CONFIG_PATH_L</span><span class="si">}</span><span class="s1">*/accelerator_reset/&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;./</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">SPR_ACCE_RANDOM_CONFIG_PATH_L</span><span class="si">}</span><span class="s1">*/accelerator_reset/&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">__cpu_idle_value_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
        <span class="n">thread_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_thread_num</span><span class="p">()</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;CPU Idle&#39;</span><span class="p">)</span>
        <span class="n">cpu_idle_list</span> <span class="o">=</span> <span class="n">line_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;CPU P-State/Frequency Summary: Total Samples Received&#39;</span><span class="p">)</span>
        <span class="n">cpu_idle_list</span> <span class="o">=</span> <span class="n">cpu_idle_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">word_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">cpu_idle_list</span><span class="p">:</span>
            <span class="n">word_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">word_list</span><span class="p">)</span>
        <span class="n">cpu_idle_value_less_100_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">word_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">word</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">100.00</span><span class="p">:</span>
                <span class="n">cpu_idle_value_less_100_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
        <span class="n">cpu_idle_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">cpu_idle_value_less_100_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">70</span><span class="p">:</span>
                <span class="n">cpu_idle_num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">cpu_idle_num</span> <span class="o">!=</span> <span class="n">thread_num</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Not all thread cpu idle value more than 70%&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not all thread cpu idle value more than 70%&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__detact_device_in_esxi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">key_list</span><span class="p">,</span> <span class="n">acce_ip</span><span class="p">,</span> <span class="n">cpu_num</span><span class="p">):</span>
        <span class="n">qat_line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">key_list</span><span class="p">:</span>
            <span class="n">key_num</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">qat_line_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">key_num</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">acce_ip</span> <span class="o">==</span> <span class="s1">&#39;qat&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key_num</span> <span class="o">!=</span> <span class="n">cpu_num</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">qat_device_num</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Not all device are recognized&#39;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not all device are recognized&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">acce_ip</span> <span class="o">==</span> <span class="s1">&#39;dlb&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key_num</span> <span class="o">!=</span> <span class="n">cpu_num</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlb_device_num</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Not all device are recognized&#39;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not all device are recognized&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">acce_ip</span> <span class="o">==</span> <span class="s1">&#39;dsa&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key_num</span> <span class="o">!=</span> <span class="n">cpu_num</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsa_device_num</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Not all device are recognized&#39;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not all device are recognized&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_core_num</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Get current SUT core numbers</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  Yes: return core numbers</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Get current SUT core numbers</span>
<span class="sd">                        __get_core_num()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;lscpu&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
            <span class="n">word_list</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">word_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Core(s)&#39;</span><span class="p">:</span>
                <span class="n">core_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">word_list</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">core_num</span>

    <span class="k">def</span> <span class="nf">__get_dlb_pci_id_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dev_id_list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Modify the format of DLB device ID list</span>
<span class="sd">              Args:</span>
<span class="sd">                  dev_id_list : DLB device ID list --&gt;# [&#39;0000:6d:00.1&#39;,&#39;0000:6d:00.2&#39;,&#39;0000:6d:00.3&#39;]</span>
<span class="sd">              Returns:</span>
<span class="sd">                  Yes  --&gt; # &#39;0000_6d_00_1&#39;&#39;0000_6d_00_2&#39;&#39;0000_6d_00_3&#39;</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Modify the format of DLB device ID list</span>
<span class="sd">                        __get_dlb_pci_id_list([&#39;0000:6d:00.1&#39;,&#39;0000:6d:00.2&#39;,&#39;0000:6d:00.3&#39;])</span>
<span class="sd">                        return &#39;0000_6d_00_1&#39;&#39;0000_6d_00_2&#39;&#39;0000_6d_00_3&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dlb_pci_id_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dev_id</span> <span class="ow">in</span> <span class="n">dev_id_list</span><span class="p">:</span>
            <span class="n">change_li</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">word_list_split</span> <span class="o">=</span> <span class="n">dev_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
                <span class="s1">&#39;:&#39;</span><span class="p">)</span>  <span class="c1"># [&#39; 0000&#39;, &#39;6d&#39;, &#39;00.1&#39;][&#39; 0000&#39;, &#39;6d&#39;, &#39;00.2&#39;][&#39; 0000&#39;, &#39;6d&#39;, &#39;00.3&#39;]</span>
            <span class="n">word_list_change</span> <span class="o">=</span> <span class="n">word_list_split</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>  <span class="c1"># [&#39;00&#39;, &#39;1&#39;][&#39;00&#39;, &#39;2&#39;][&#39;00&#39;, &#39;3&#39;]</span>
            <span class="n">change_li</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word_list_split</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># [&#39; 0000][&#39; 0000&#39;][&#39; 0000&#39;]</span>
            <span class="n">change_li</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word_list_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># [&#39; 0000&#39;, &#39;6d&#39;][&#39; 0000&#39;, &#39;6d&#39;][&#39; 0000&#39;, &#39;6d&#39;]</span>
            <span class="n">change_li</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word_list_change</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># [&#39; 0000&#39;, &#39;6d&#39;,&#39;00&#39;][&#39; 0000&#39;, &#39;6d&#39;,&#39;00&#39;][&#39; 0000&#39;, &#39;6d&#39;, &#39;00&#39;]</span>
            <span class="n">change_li</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">word_list_change</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># [&#39; 0000&#39;, &#39;6d&#39;,&#39;00&#39;, &#39;1&#39;][&#39; 0000&#39;, &#39;6d&#39;,&#39;00&#39;, &#39;2&#39;][&#39; 0000&#39;, &#39;6d&#39;, &#39;00&#39;, &#39;3&#39;]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">change_li</span><span class="p">):</span>
                <span class="n">change_li</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span>
                                 <span class="s1">&#39;_&#39;</span><span class="p">)</span>  <span class="c1"># [&#39; 0000&#39;, &#39;_&#39;, &#39;6d&#39;, &#39;_&#39;, &#39;00&#39;, &#39;_&#39;, &#39;1&#39;][&#39; 0000&#39;, &#39;_&#39;, &#39;6d&#39;, &#39;_&#39;, &#39;00&#39;, &#39;_&#39;, &#39;2&#39;][&#39; 0000&#39;, &#39;_&#39;, &#39;6d&#39;, &#39;_&#39;, &#39;00&#39;, &#39;_&#39;, &#39;3&#39;]</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
            <span class="n">change_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">change_li</span><span class="p">)</span>  <span class="c1"># &#39; 0000_6d_00_1&#39;&#39; 0000_6d_00_2&#39;&#39; 0000_6d_00_3&#39;</span>
            <span class="n">change_str</span> <span class="o">=</span> <span class="n">change_str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># &#39;0000_6d_00_1&#39;&#39;0000_6d_00_2&#39;&#39;0000_6d_00_3&#39;</span>
            <span class="n">dlb_pci_id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">change_str</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dlb_pci_id_list</span>

    <span class="k">def</span> <span class="nf">__get_dlb_unbind_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dev_id</span><span class="p">):</span>  <span class="c1"># &#39;0000:6d:00.1&#39;</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Get True DLB device ID</span>
<span class="sd">              Args:</span>
<span class="sd">                  dev_id: DLB device ID, this is DLB True device ID or virtual DLB device ID</span>
<span class="sd">              Returns:</span>
<span class="sd">                  Yes  --&gt; &#39;0000:6d:00.0&#39;</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: get DLB True device 0 and create 2 DLB Vietual device for Platform</span>
<span class="sd">                        __get_dlb_unbind_path(&#39;0000:6d:00.1&#39;)</span>
<span class="sd">                        return&#39;0000:6d:00.0&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_vf</span> <span class="o">=</span> <span class="n">dev_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_vf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;00.0&#39;</span><span class="p">:</span>
            <span class="n">dlb_pf_id</span> <span class="o">=</span> <span class="n">dev_id</span>  <span class="c1"># &#39;0000:6d:00.0&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">before_id</span> <span class="o">=</span> <span class="n">dev_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">dlb_pf_id</span> <span class="o">=</span> <span class="n">before_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.0&#39;</span>  <span class="c1"># &#39;0000:6d:00.0&#39;</span>
        <span class="k">return</span> <span class="n">dlb_pf_id</span>  <span class="c1"># &#39;0000:6d:00.0&#39;</span>

    <span class="k">def</span> <span class="nf">__get_qat_pci_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dev_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Modify the format of QAT device ID</span>
<span class="sd">              Args:</span>
<span class="sd">                  dev_id : QAT device ID --&gt;&#39;0000:6d:00.0&#39;</span>
<span class="sd">              Returns:</span>
<span class="sd">                  Yes  --&gt; &#39;0000_6b_00_1&#39;</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Modify the format of QAT device ID</span>
<span class="sd">                        __get_qat_pci_id(0000:6d:00.0)</span>
<span class="sd">                        return &#39;0000_6b_00_1&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">change_li</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">word_list_split</span> <span class="o">=</span> <span class="n">dev_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>  <span class="c1"># [&#39; 0000&#39;, &#39;6b&#39;, &#39;00.1&#39;]</span>
        <span class="n">word_list_change</span> <span class="o">=</span> <span class="n">word_list_split</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>  <span class="c1"># [&#39;00&#39;, &#39;1&#39;]</span>
        <span class="n">change_li</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word_list_split</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># [&#39; 0000]</span>
        <span class="n">change_li</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word_list_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># [&#39; 0000&#39;, &#39;6b&#39;]</span>
        <span class="n">change_li</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word_list_change</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># [&#39; 0000&#39;, &#39;6b&#39;,&#39;00&#39;]</span>
        <span class="n">change_li</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word_list_change</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># [&#39; 0000&#39;, &#39;6b&#39;,&#39;00&#39;, &#39;1&#39;]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">change_li</span><span class="p">):</span>
            <span class="n">change_li</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>  <span class="c1"># [&#39; 0000&#39;, &#39;_&#39;, &#39;6b&#39;, &#39;_&#39;, &#39;00&#39;, &#39;_&#39;, &#39;1&#39;]</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
        <span class="n">change_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">change_li</span><span class="p">)</span>  <span class="c1"># &#39; 0000_6b_00_1&#39;</span>
        <span class="n">change_str</span> <span class="o">=</span> <span class="n">change_str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># &#39;0000_6b_00_1&#39;</span>
        <span class="k">return</span> <span class="n">change_str</span>

    <span class="k">def</span> <span class="nf">__get_qat_unbind_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dev_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Modify the format of QAT device ID</span>
<span class="sd">              Args:</span>
<span class="sd">                  dev_id : QAT device ID --&gt;&#39;0000:6d:00.0&#39;</span>
<span class="sd">              Returns:</span>
<span class="sd">                  Yes  --&gt; &#39;0000\:6b\:00.0&#39;</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Modify the format of QAT device ID</span>
<span class="sd">                        __get_qat_unbind_path(0000:6d:00.0)</span>
<span class="sd">                        return &#39;0000\:6b\:00.0&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">word_split</span> <span class="o">=</span> <span class="n">dev_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>  <span class="c1"># [&#39; 0000&#39;, &#39;6b&#39;, &#39;00.0&#39;]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">word_split</span><span class="p">):</span>
            <span class="n">word_split</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">:&#39;</span><span class="p">)</span>  <span class="c1"># [&#39; 0000&#39;, &#39;\\:&#39;, &#39;6b&#39;, &#39;\\:&#39;, &#39;00.0&#39;]</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
        <span class="n">change_word</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">word_split</span><span class="p">)</span>  <span class="c1"># &#39; 0000\:6b\:00.0&#39;</span>
        <span class="n">change_word</span> <span class="o">=</span> <span class="n">change_word</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># &#39;0000\:6b\:00.0&#39;</span>
        <span class="k">return</span> <span class="n">change_word</span>

    <span class="k">def</span> <span class="nf">__get_thread_num</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Get current SUT core numbers</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  Yes: return core numbers</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Get current SUT core numbers</span>
<span class="sd">                        __get_core_num()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;lscpu&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
            <span class="n">word_list</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">word_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;CPU(s):&#39;</span><span class="p">:</span>
                <span class="n">thread_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">word_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">thread_num</span>

    <span class="k">def</span> <span class="nf">__load_driver</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;kill -HUP $(cat /var/run/vmware/vmkdevmgr.pid)&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;kill vmkdevmgr fail&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;kill vmkdevmgr fail&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Case</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__qat_asym_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Modify QAT asymmetric encrypted files config</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Raises:</span>
<span class="sd">                  RuntimeError: If any errors</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Modify QAT asym metric encrypted files config</span>
<span class="sd">                        __qat_asym_config()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cpu_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_num</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cpu_num</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_device_num</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sed -i &quot;s/ServicesEnabled.*/ServicesEnabled = asym;dc/g&quot; /etc/4xxx_dev</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.conf&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qat_service_restart</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__qat_sym_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Modify QAT symmetric encrypted files config</span>
<span class="sd">              Args:No</span>
<span class="sd">              Returns:No</span>
<span class="sd">              Raises: RuntimeError: If any errors</span>
<span class="sd">              Example: __qat_sym_config()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cpu_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_num</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cpu_num</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_device_num</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sed -i &quot;s/ServicesEnabled.*/ServicesEnabled = sym;dc/g&quot; /etc/4xxx_dev</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.conf&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sed -i &quot;s/NumberAdis = 0/NumberAdis = 16/g&quot; /etc/4xxx_dev</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.conf&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qat_service_restart</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__qat_asym_config_clr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Clear QAT asymmetric encrypted config files</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Clear QAT asymmetric encrypted config files</span>
<span class="sd">                        __qat_asym_config_clr()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cpu_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_num</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cpu_num</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_device_num</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sed -i &quot;s/ServicesEnabled = asym;dc/ServicesEnabled = sym;dc/g&quot; /etc/4xxx_dev</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.conf&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qat_service_restart</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__qat_mdev_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Modify QAT SIOV config files</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Modify QAT SIOV config files</span>
<span class="sd">                        __qat_mdev_config()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cpu_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_num</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cpu_num</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_device_num</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sed -i &quot;s/NumberAdis = 0/NumberAdis = 16/g&quot; /etc/4xxx_dev</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.conf&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qat_service_stop_start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__qat_mdev_config_clr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Clear QAT SIOV config files</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Clear QAT SIOV config files</span>
<span class="sd">                        __qat_mdev_config_clr()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cpu_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_num</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cpu_num</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_device_num</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sed -i &quot;s/NumberAdis = 16/NumberAdis = 0/g&quot; /etc/4xxx_dev</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.conf&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qat_service_restart</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__qat_service_restart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;service qat_service restart&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;Unit qat_service.service not found&quot;</span> <span class="ow">in</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="s1">&#39;qat_service restart&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">__qat_shim_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Modify QAT SSL config files</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Modify QAT SSL config files</span>
<span class="sd">                        __qat_shim_config()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cpu_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_num</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cpu_num</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_device_num</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sed -i &quot;s/\[SSL\]/\[SHIM\]/g&quot; /etc/4xxx_dev</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.conf&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sed -i &quot;s/NumberCyInstances = 3/NumberCyInstances = 1/g&quot; /etc/4xxx_dev</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.conf&#39;</span><span class="p">,</span>
                                  <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sed -i &quot;s/NumberDcInstances = 2/NumberDcInstances = 1/g&quot; /etc/4xxx_dev</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.conf&#39;</span><span class="p">,</span>
                                  <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sed -i &quot;s/NumProcesses = 1/NumProcesses = 16/g&quot; /etc/4xxx_dev</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.conf&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sed -i &quot;s/LimitDevAccess = 0/LimitDevAccess = 1/g&quot; /etc/4xxx_dev</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.conf&#39;</span><span class="p">,</span>
                                  <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qat_service_restart</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__qat_shim_config_clr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              Purpose: Clear QAT SSL config files</span>
<span class="sd">              Args:</span>
<span class="sd">                  No</span>
<span class="sd">              Returns:</span>
<span class="sd">                  No</span>
<span class="sd">              Example:</span>
<span class="sd">                  Simplest usage: Clear QAT SSL config files</span>
<span class="sd">                        __qat_shim_config_clr()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cpu_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cpu_num</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cpu_num</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">qat_device_num</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sed -i &quot;s/\[SHIM\]/\[SSL\]/g&quot; /etc/4xxx_dev</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.conf&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sed -i &quot;s/NumberCyInstances = 1/NumberCyInstances = 3/g&quot; /etc/4xxx_dev</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.conf&#39;</span><span class="p">,</span>
                                  <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sed -i &quot;s/NumberDcInstances = 1/NumberDcInstances = 2/g&quot; /etc/4xxx_dev</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.conf&#39;</span><span class="p">,</span>
                                  <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sed -i &quot;s/NumProcesses*/NumProcesses = 1/g&quot; /etc/4xxx_dev</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.conf&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_shell_cmd</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sed -i &quot;s/LimitDevAccess = 1/LimitDevAccess = 0/g&quot; /etc/4xxx_dev</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.conf&#39;</span><span class="p">,</span>
                                  <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qat_service_restart</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__usb_device_detact</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sut</span><span class="o">.</span><span class="n">execute_uefi_cmd</span><span class="p">(</span><span class="s1">&#39;map -r&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;FS&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;USB&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Fang
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/scripts/furo.js?v=32e29ea5"></script>
    </body>
</html>